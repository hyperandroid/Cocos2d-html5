"use strict";var cc;!function(){!function(){console.log("%c","padding:140px 150px;line-height:300px;background:url(http://files.cocos2d-x.org/images/orgsite/logo.png) no-repeat;")}(),function(){var frameTime=1e3/60,lastTime=(new Date).getTime(),stTime=function(callback){var currTime=(new Date).getTime(),timeToCall=Math.max(0,frameTime-(currTime-lastTime)),id=window.setTimeout(function(){callback()},timeToCall);return lastTime=currTime+timeToCall,id},ctTime=function(id){clearTimeout(id)},win=window;win.requestAnimFrame=win.requestAnimationFrame||win.webkitRequestAnimationFrame||win.mozRequestAnimationFrame||win.oRequestAnimationFrame||win.msRequestAnimationFrame||stTime,win.cancelAnimationFrame=win.cancelAnimationFrame||win.cancelRequestAnimationFrame||win.msCancelRequestAnimationFrame||win.mozCancelRequestAnimationFrame||win.oCancelRequestAnimationFrame||win.webkitCancelRequestAnimationFrame||win.msCancelAnimationFrame||win.mozCancelAnimationFrame||win.webkitCancelAnimationFrame||win.oCancelAnimationFrame||ctTime}()}(cc||(cc={}));var cc;!function(cc){var Debug;!function(Debug){function debug(level,msg,rest){if(console.log("%c%s:%c %s",__consoleDecoration[level],DebugLevel[level],__defaultDecoration,msg),rest.length&&console.log(rest),2===level&&0===Debug.DEBUG_LEVEL)throw msg}function error(msg){for(var rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments[_i];cc.Debug.debug(2,msg,rest)}function warn(msg){for(var rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments[_i];cc.Debug.debug(1,msg,rest)}function info(msg){for(var rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments[_i];cc.Debug.debug(0,msg,rest)}!function(RuntimeDebugLevel){RuntimeDebugLevel[RuntimeDebugLevel.DEBUG=0]="DEBUG",RuntimeDebugLevel[RuntimeDebugLevel.RELEASE=1]="RELEASE"}(Debug.RuntimeDebugLevel||(Debug.RuntimeDebugLevel={}));Debug.RuntimeDebugLevel;Debug.DEBUG_LEVEL=0,function(DebugLevel){DebugLevel[DebugLevel.Info=0]="Info",DebugLevel[DebugLevel.Warning=1]="Warning",DebugLevel[DebugLevel.Error=2]="Error"}(Debug.DebugLevel||(Debug.DebugLevel={}));var DebugLevel=Debug.DebugLevel,__consoleDecoration=["","background: orange; color: #000","background: #a00; color: #fff"],__defaultDecoration="background: #fff; color: #000";Debug.debug=debug,Debug.error=error,Debug.warn=warn,Debug.info=info}(Debug=cc.Debug||(cc.Debug={}))}(cc||(cc={}));var cc;!function(cc){var locale;!function(locale){locale.NODE_WARN_REMOVEFROMPARENT_WITH_NO_PARENT="Calling removeFromParent and the Node has no parent.",locale.ERR_NODE_NAME_INVALID="Node name invalid. Must match [A-Za-z0-9_]+",locale.MSG_WRONG_ENUMERATE_PATTERN="Wrongly defined search pattern path",locale.MSG_ENUMERATE_UNDERFLOW="Enumerate path underflow. Trying to go above root node.",locale.MSG_ERROR_NODE_WITH_PARENT="A node added as child has already a parent.",locale.ERR_RUNNING_ALREADY_EXISTING_SCENE="runScene trying to run already existing Scene.",locale.ERR_DIRECTOR_POPSCENE_UNDERFLOW="Director popScene underflow.",locale.WARN_START_ANIMATION_ON_RUNNING_DIRECTOR="Starting animation on a running director.",locale.WARN_NODE_ATTRIBUTE_DOES_NOT_EXIST="Attribute does not exist in Node object.",locale.WARN_DEPRECATED_SETBLENDFUNC="Deprecated call. Use setCompositeOperation instead.",locale.WARN_TRACER_EMPTY="Path not initialized so no current trace position. Defaulting to (0,0).",locale.WARN_TRACE_ON_CLOSED_SUBPATH="Tracing on a closed SubPath.",locale.WARN_CLOSE_EMPTY_SUBPATH="Closing empty SubPath.",locale.WARN_MOVETO_IN_NON_EMPTY_SUBPATH="MoveTo in non empty SubPath.",locale.ERR_SUBPATH_NOT_STARTED="getStartingPoint called in an empty path.",locale.ERR_SPRITE_FRAME_NO_TEXTURE="SpriteFrame w/o Texture.",locale.ERR_SPRITE_CONSTRUCTOR_PARAM_ERROR="No suitable SpriteInitializer to Sprite constructor.",locale.WARN_SPRITE_CONSTRUCTOR_DEPRECATED_CALL="Sprite constructor call deprecated.",locale.WARN_SPRITEFRAME_CREATING_SUBFRAME_WITH_EXISTING_NAME="Adding a SpriteFrame with existing name in cache.",locale.SPRITEFRAME_WARN_TEXTURE_NOT_WEBGL_INITIALIZED="Lazily initializing a webgl texture (at draw time).",locale.WARN_RESOURCE_OF_UNKNOWN_TYPE="Loaded resource of unkown type.",locale.ASSETMANAGER_WARN_SPRITEFRAME_NOT_FOUND="SpriteFrame with id not found.",locale.ERR_FONT_GLYPTH_NOT_IN_FRAME="A glitph definition is not in Atlas Spriteframe area.",locale.INPUT_WARN_WRONG_ROOT_NODE="Adding a path to the wrong root node.",locale.LOADER_JSON_PARSE_ERROR="JSON parse error while loading resource.",locale.WARN_FULLSCREEN_ERROR="Full screen mode error.",locale.ERR_SOUND_POOL_EMPTY="Can't play, sound pool is empty."}(locale=cc.locale||(cc.locale={}))}(cc||(cc={}));var cc;!function(cc){var math;!function(math){var Color=function(){function Color(r,g,b,a){void 0===r&&(r=1),void 0===g&&(g=1),void 0===b&&(b=1),void 0===a&&(a=1),this._dirty=!0,this._dirtyHex=!0,this._color=new Float32Array(4),this._color[0]=r,this._color[1]=g,this._color[2]=b,this._color[3]=a}return Color.prototype.getHexRGB=function(){return this._dirtyHex&&this.__calculateHexStyle(),this._hexRGB},Color.prototype.getHexRGBA=function(){return this._dirtyHex&&this.__calculateHexStyle(),this._hexRGBA},Color.prototype.__calculateHexStyle=function(){var r=(255*this._color[0]>>0).toString(16).toUpperCase(),g=(255*this._color[1]>>0).toString(16).toUpperCase(),b=(255*this._color[2]>>0).toString(16).toUpperCase();this._hexRGB="#"+(r.length<2?"0":"")+r+(g.length<2?"0":"")+g+(b.length<2?"0":"")+b;var a=(255*this._color[3]>>0).toString(16).toUpperCase();this._hexRGBA=this._hexRGB+(a.length<2?"0":"")+a},Color.prototype.__calculateFillStyle=function(){this._fillStyle="rgba("+(255*this._color[0]>>0)+","+(255*this._color[1]>>0)+","+(255*this._color[2]>>0)+","+this._color[3]+")",this._dirty=!1},Color.prototype.getFillStyle=function(){return this._dirty&&this.__calculateFillStyle(),this._fillStyle},Object.defineProperty(Color.prototype,"r",{get:function(){return this._color[0]},set:function(v){this._color[0]=v,this._dirty=!0,this._dirtyHex=!0},enumerable:!0,configurable:!0}),Object.defineProperty(Color.prototype,"g",{get:function(){return this._color[1]},set:function(v){this._color[1]=v,this._dirty=!0,this._dirtyHex=!0},enumerable:!0,configurable:!0}),Object.defineProperty(Color.prototype,"b",{get:function(){return this._color[2]},set:function(v){this._color[2]=v,this._dirty=!0,this._dirtyHex=!0},enumerable:!0,configurable:!0}),Object.defineProperty(Color.prototype,"a",{get:function(){return this._color[3]},set:function(v){this._color[3]=v,this._dirty=!0,this._dirtyHex=!0},enumerable:!0,configurable:!0}),Color.createFromRGBA=function(r,g,b,a){if("object"==typeof r){var c=r;return new Color(c.r/255,c.g/255,c.b/255,c.a/255)}return"number"==typeof r?new Color(r/255,g/255,b/255,a/255):"string"==typeof r?Color.fromStringToColor(r):Color.WHITE},Color.fromRGBStringToColor=function(color){color=color.toLowerCase();var skip=4;0===color.indexOf("rgba")&&(skip=5),color=color.substring(skip,color.length-1);var c,colors=color.split(",");return c=3===colors.length?new Color(parseInt(colors[0])/255,parseInt(colors[1])/255,parseInt(colors[2])/255):new Color(parseInt(colors[0])/255,parseInt(colors[1])/255,parseInt(colors[2])/255,parseInt(colors[3]))},Color.fromStringToColor=function(hex){if(hex=hex.toLowerCase(),0===hex.indexOf("rgb")||0===hex.indexOf("rgba"))return Color.fromRGBStringToColor(hex);if("#"===hex.charAt(0)&&(hex=hex.substring(1)),3!==hex.length&&4!==hex.length&&6!==hex.length&&8!==hex.length)return Color.MAGENTA;var r,g,b,a;return hex.length<6?(r=parseInt(hex.charAt(0),16),g=parseInt(hex.charAt(1),16),b=parseInt(hex.charAt(2),16),a=4===hex.length?parseInt(hex.charAt(3),16):15,new Color(r/15,g/15,b/15,a/15)):(r=parseInt(hex.substring(0,2),16),g=parseInt(hex.substring(2,4),16),b=parseInt(hex.substring(4,6),16),a=8===hex.length?parseInt(hex.substring(6,8),16):255,new Color(r/255,g/255,b/255,a/255))},Color.HSV=function(c,H,S,V){var VSU=V*S*Math.cos(H*Math.PI/180),VSW=V*S*Math.sin(H*Math.PI/180),r=(.299*V+.701*VSU+.168*VSW)*c.r+(.587*V-.587*VSU+.33*VSW)*c.g+(.114*V-.114*VSU-.497*VSW)*c.b,g=(.299*V-.299*VSU-.328*VSW)*c.r+(.587*V+.413*VSU+.035*VSW)*c.g+(.114*V-.114*VSU+.292*VSW)*c.b,b=(.299*V-.3*VSU+1.25*VSW)*c.r+(.587*V-.588*VSU-1.05*VSW)*c.g+(.114*V+.886*VSU-.203*VSW)*c.b;return c.r=r,c.g=g,c.b=b,c},Color.TRANSPARENT_BLACK=new Color(0,0,0,0),Color.BLACK=new Color(0,0,0,1),Color.RED=new Color(1,0,0,1),Color.GREEN=new Color(0,1,0,1),Color.BLUE=new Color(0,0,1,1),Color.WHITE=new Color(1,1,1,1),Color.MAGENTA=new Color(1,0,1,1),Color.YELLOW=new Color(1,1,0,1),Color.CYAN=new Color(0,1,1,1),Color}();math.Color=Color}(math=cc.math||(cc.math={}))}(cc||(cc={}));var cc;!function(cc){var math;!function(math){var __m0=new Float32Array([1,0,0,0,1,0,0,0,1]),Matrix3=function(){function Matrix3(){}return Matrix3.create=function(){var matrix=new Float32Array(9);return Matrix3.identity(matrix),matrix},Matrix3.identity=function(matrix){matrix[0]=1,matrix[1]=0,matrix[2]=0,matrix[3]=0,matrix[4]=1,matrix[5]=0,matrix[6]=0,matrix[7]=0,matrix[8]=1},Matrix3.translateBy=function(matrix,dtx,dty){var a=matrix[0],b=matrix[1],c=matrix[3],d=matrix[4],tx=matrix[2],ty=matrix[5];matrix[2]=a*dtx+b*dty+tx,matrix[5]=c*dtx+d*dty+ty},Matrix3.scaleBy=function(matrix,sx,sy){matrix[0]*=sx,matrix[1]*=sy,matrix[3]*=sx,matrix[4]*=sy},Matrix3.rotateBy=function(matrix,angle){cc.math.Matrix3.setRotate(__m0,angle),cc.math.Matrix3.multiply(matrix,__m0)},Matrix3.copy=function(source,destination){destination.set(source)},Matrix3.setTransformAll=function(mm,node){var c,s,_m00,_m01,_m10,_m11,m00,m01,m02,m10,m11,m12;m00=1,m01=0,m10=0,m11=1;var cs=node._contentSize;m02=node.x-node._positionAnchor.x*cs.width,m12=node.y-node._positionAnchor.y*cs.height;var rx=node._transformationAnchor.x*cs.width,ry=node._transformationAnchor.y*cs.height;m02+=m00*rx+m01*ry,m12+=m10*rx+m11*ry;var angle=-node.rotationAngle*Math.PI/180;c=Math.cos(angle),s=Math.sin(angle),_m00=m00,_m01=m01,_m10=m10,_m11=m11,m00=_m00*c+_m01*s,m01=-_m00*s+_m01*c,m10=_m10*c+_m11*s,m11=-_m10*s+_m11*c,m00*=node.scaleX,m01*=node.scaleY,m10*=node.scaleX,m11*=node.scaleY,m02+=-m00*rx-m01*ry,m12+=-m10*rx-m11*ry,mm[0]=m00,mm[1]=m01,mm[3]=m10,mm[4]=m11,mm[2]=m02,mm[5]=m12},Matrix3.setTransformScale=function(mm,node){var m00,m01,m02,m10,m11,m12;m00=1,m01=0,m10=0,m11=1;var cs=node._contentSize;m02=node.x-node._positionAnchor.x*cs.width,m12=node.y-node._positionAnchor.y*cs.height;var rx=node._transformationAnchor.x*cs.width,ry=node._transformationAnchor.y*cs.height;m02+=m00*rx+m01*ry,m12+=m10*rx+m11*ry,m00*=node.scaleX,m01*=node.scaleY,m10*=node.scaleX,m11*=node.scaleY,m02+=-m00*rx-m01*ry,m12+=-m10*rx-m11*ry,mm[0]=m00,mm[1]=m01,mm[3]=m10,mm[4]=m11,mm[2]=m02,mm[5]=m12},Matrix3.setTransformTranslate=function(mm,node){var pa=node._positionAnchor,cs=node._contentSize,x=node.x-pa.x*cs.width,y=node.y-pa.y*cs.height;mm[2]=x,mm[5]=y,mm[0]=1,mm[1]=0,mm[3]=0,mm[4]=1,mm[6]=0,mm[7]=0,mm[8]=1},Matrix3.multiply=function(m0,m1){var mm0=m1[0],mm1=m1[1],mm2=m1[2],mm3=m1[3],mm4=m1[4],mm5=m1[5],tm0=m0[0],tm1=m0[1],tm2=m0[2];m0[0]=tm0*mm0+tm1*mm3,m0[1]=tm0*mm1+tm1*mm4,m0[2]=tm0*mm2+tm1*mm5+tm2;var tm3=m0[3],tm4=m0[4],tm5=m0[5];m0[3]=tm3*mm0+tm4*mm3,m0[4]=tm3*mm1+tm4*mm4,m0[5]=tm3*mm2+tm4*mm5+tm5,m0[6]=0,m0[7]=0,m0[8]=1},Matrix3.premultiply=function(m1,m0){var mm0=m1[0],mm1=m1[1],mm2=m1[2],mm3=m1[3],mm4=m1[4],mm5=m1[5],tm0=m0[0],tm1=m0[1],tm2=m0[2];__m0[0]=tm0*mm0+tm1*mm3,__m0[1]=tm0*mm1+tm1*mm4,__m0[2]=tm0*mm2+tm1*mm5+tm2;var tm3=m0[3],tm4=m0[4],tm5=m0[5];__m0[3]=tm3*mm0+tm4*mm3,__m0[4]=tm3*mm1+tm4*mm4,__m0[5]=tm3*mm2+tm4*mm5+tm5,__m0[6]=0,__m0[7]=0,__m0[8]=1,cc.math.Matrix3.copy(__m0,m1)},Matrix3.transformPoint=function(tm,point){var x,y;return x=point.x,y=point.y,point.x=x*tm[0]+y*tm[1]+tm[2],point.y=x*tm[3]+y*tm[4]+tm[5],point},Matrix3.setRenderingContextTransform=function(mm,ctx){ctx.setTransform(mm[0],mm[3],mm[1],mm[4],mm[2],mm[5])},Matrix3.setTransform=function(matrix,a,b,c,d,tx,ty){matrix[0]=a,matrix[3]=b,matrix[1]=c,matrix[4]=d,matrix[2]=tx,matrix[5]=ty,matrix[6]=0,matrix[7]=0,matrix[8]=1},Matrix3.transform=function(matrix,a,b,c,d,tx,ty){Matrix3.setTransform(_workingMatrix,a,b,c,d,tx,ty),Matrix3.multiply(matrix,_workingMatrix)},Matrix3.setTranslate=function(matrix,x,y){Matrix3.identity(matrix),matrix[2]=x,matrix[5]=y},Matrix3.setRotate=function(matrix,angle){Matrix3.identity(matrix),matrix[0]=Math.cos(angle),matrix[1]=-Math.sin(angle),matrix[3]=Math.sin(angle),matrix[4]=Math.cos(angle)},Matrix3.setScale=function(matrix,x,y){Matrix3.identity(matrix),matrix[0]=x,matrix[4]=y},Matrix3.inverse=function(matrix,res){var m00=matrix[0],m01=matrix[1],m02=matrix[2],m10=matrix[3],m11=matrix[4],m12=matrix[5],m20=matrix[6],m21=matrix[7],m22=matrix[8],determinant=m00*(m11*m22-m21*m12)-m10*(m01*m22-m21*m02)+m20*(m01*m12-m11*m02);return 0===determinant?Matrix3.identity(Matrix3.IDENTITY):(determinant=1/determinant,res[0]=(m11*m22-m12*m21)*determinant,res[1]=(m02*m21-m01*m22)*determinant,res[2]=(m01*m12-m02*m11)*determinant,res[3]=(m12*m20-m10*m22)*determinant,res[4]=(m00*m22-m02*m20)*determinant,res[5]=(m02*m10-m00*m12)*determinant,res[6]=(m10*m21-m11*m20)*determinant,res[7]=(m01*m20-m00*m21)*determinant,void(res[8]=(m00*m11-m01*m10)*determinant))},Matrix3.IDENTITY=Matrix3.create(),Matrix3}();math.Matrix3=Matrix3;var _workingMatrix=cc.math.Matrix3.create()}(math=cc.math||(cc.math={}))}(cc||(cc={}));var cc;!function(cc){var math;!function(math){var Matrix4=function(){function Matrix4(){this._matrix=new Float32Array(16)}return Matrix4}();math.Matrix4=Matrix4}(math=cc.math||(cc.math={}))}(cc||(cc={}));var cc;!function(cc){var math;!function(math){var Vector=function(){function Vector(x,y,z){void 0===x&&(x=0),void 0===y&&(y=0),void 0===z&&(z=0),this.x=x,this.y=y,this.z=z}return Vector.prototype.set=function(x,y){return this.x=x,this.y=y,this.z=0,this},Vector.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},Vector.prototype.angle=function(){return Math.atan2(this.y,this.x)},Vector.prototype.normalize=function(){var l=this.length();return this.x/=l,this.y/=l,this},Vector.prototype.distance=function(v){return Vector.distance(this,v)},Vector.prototype.sub=function(v){return this.x-=v.x,this.y-=v.y,this},Vector.prototype.add=function(v){return this.x+=v.x,this.y+=v.y,this},Vector.prototype.mult=function(v){return this.x*=v,this.y*=v,this.z*=v,this},Vector.add=function(v0,v1){return(new Vector).set(v1.x+v0.x,v1.y+v0.y)},Vector.sub=function(v0,v1){return(new Vector).set(v1.x-v0.x,v1.y-v0.y)},Vector.distance=function(v0,v1){var dx=v1.x-v0.x,dy=v1.y-v0.y;return Math.sqrt(dx*dx+dy*dy)},Vector.angleWith=function(p0,p1){var x=p1.x-p0.x,y=p1.y-p0.y;return Math.atan2(y,x)},Vector.prototype.equals=function(v){return this.x===v.x&&this.y===v.y},Vector.prototype.clone=function(){return new Vector(this.x,this.y,this.z)},Vector}();math.Vector=Vector}(math=cc.math||(cc.math={}))}(cc||(cc={}));var cc;!function(cc){var math;!function(math){var Rectangle=function(){function Rectangle(x,y,w,h){void 0===x&&(x=0),void 0===y&&(y=0),void 0===w&&(w=0),void 0===h&&(h=0),this.x=x,this.y=y,this.w=w,this.h=h,this.x1=0,this.y1=0,this.set(x,y,w,h)}return Rectangle.prototype.set=function(x,y,w,h){return this.x=x,this.y=y,this.w=w,this.h=h,this.x1=x+w,this.y1=y+h,this},Rectangle.prototype.intersectsWith=function(r){return this.intersects(r.x,r.y,r.w,r.h)},Rectangle.prototype.intersects=function(x,y,w,h){return this.x1<x?!1:this.y1<y?!1:this.x>=x+w?!1:this.y>=y+h?!1:!0},Rectangle.prototype.normalizeBy=function(w,h){return this.x/=w,this.y/=h,this.x1/=w,this.y1/=h,this.w/=w,this.h/=h,this},Rectangle.prototype.setEmpty=function(){this.x=0,this.y=0,this.x1=0,this.y1=0,this.w=0,this.h=0},Rectangle.prototype.translate=function(x,y){return this.x+=x,this.y+=y,this.x1+=x,this.y1+=y,this},Rectangle.prototype.isEmpty=function(){return 0===this.w||0===this.h},Rectangle.prototype.intersectWith=function(r){return this.intersectsWith(r)?(this.x<r.x&&(this.w-=r.x-this.x,this.x=r.x),this.y<r.y&&(this.h-=r.y-this.y,this.y=r.y),this.w>r.w&&(this.w=r.w),this.h>r.h&&(this.h=r.h),this.x1=this.x+this.w,this.y1=this.y+this.h):this.setEmpty(),this},Rectangle.prototype.contains=function(x,y){var tx,ty;if("number"!=typeof x){var v=x;tx=v.x,ty=v.y}else tx=x,ty=y;return tx>=this.x&&ty>=this.y&&tx<this.x1&&ty<this.y1},Object.defineProperty(Rectangle.prototype,"width",{get:function(){return this.w},set:function(w){this.w=w},enumerable:!0,configurable:!0}),Object.defineProperty(Rectangle.prototype,"height",{get:function(){return this.h},set:function(h){this.h=h},enumerable:!0,configurable:!0}),Rectangle}();math.Rectangle=Rectangle}(math=cc.math||(cc.math={}))}(cc||(cc={}));var cc;!function(cc){var math;!function(math){var Dimension=function(){function Dimension(width,height){void 0===width&&(width=0),void 0===height&&(height=0),this.width=width,this.height=height}return Dimension.prototype.set=function(w,h){if("number"==typeof w)this.width=w,this.height=h;else{var d=w;this.width=d.width,this.height=d.height}return this},Dimension.prototype.clone=function(){return new Dimension(this.width,this.height)},Dimension}();math.Dimension=Dimension}(math=cc.math||(cc.math={}))}(cc||(cc={}));var cc;!function(cc){var math;!function(math){var path;!function(path){function getDistanceVector(distance,matrix){return __v0.set(0,0),__v1.set(distance,0),matrix&&(Matrix3.transformPoint(matrix,__v0),Matrix3.transformPoint(matrix,__v1)),__v1.sub(__v0)}var Vector=cc.math.Vector,Matrix3=cc.math.Matrix3;path.DEFAULT_TRACE_LENGTH=50;var __v0=new Vector,__v1=new Vector;path.getDistanceVector=getDistanceVector}(path=math.path||(math.path={}))}(math=cc.math||(cc.math={}))}(cc||(cc={}));var cc;!function(cc){var math;!function(math){var path;!function(path){var Vector=cc.math.Vector,__v=new Vector,SegmentLine=function(){function SegmentLine(data){this._parent=null,this._length=0,this._dirty=!0,data&&this.initialize(data.start,data.end)}return SegmentLine.prototype.getParent=function(){return this._parent},SegmentLine.prototype.setParent=function(s){this._parent=s},SegmentLine.prototype.initialize=function(start,end){this._start=new Vector(start.x,start.y),this._end=new Vector(end.x,end.y),this._length=Math.sqrt((this._start.x-this._end.x)*(this._start.x-this._end.x)+(this._start.y-this._end.y)*(this._start.y-this._end.y))},SegmentLine.prototype.getLength=function(){return this._length},SegmentLine.prototype.trace=function(numPoints,dstArray){return dstArray=dstArray||[],dstArray.push(this._start),dstArray.push(this._end),dstArray},SegmentLine.prototype.getValueAt=function(normalizedPos,out){return out=out||__v,out.x=(this._end.x-this._start.x)*normalizedPos+this._start.x,out.y=(this._end.y-this._start.y)*normalizedPos+this._start.y,out},SegmentLine.prototype.getStartingPoint=function(){return this._start},SegmentLine.prototype.getEndingPoint=function(){return this._end},SegmentLine.prototype.clone=function(){var sl=new SegmentLine({start:{x:this._start.x,y:this._start.y},end:{x:this._end.x,y:this._end.y}});return sl._length=this._length,this},SegmentLine.prototype.getControlPoints=function(arr){return arr=arr||[],arr.push(this._start),arr.push(this._end),arr},SegmentLine.prototype.setDirty=function(){this._dirty=!0;for(var p=this._parent;p;)p.setDirty(),p=p._parent},SegmentLine.prototype.paint=function(){},SegmentLine}();path.SegmentLine=SegmentLine}(path=math.path||(math.path={}))}(math=cc.math||(cc.math={}))}(cc||(cc={}));var cc;!function(cc){var math;!function(math){var path;!function(path){function __recursive_bezier(points,x1,y1,x2,y2,x3,y3,x4,y4,level){if(!(level>curve_recursion_limit)){var x12=(x1+x2)/2,y12=(y1+y2)/2,x23=(x2+x3)/2,y23=(y2+y3)/2,x34=(x3+x4)/2,y34=(y3+y4)/2,x123=(x12+x23)/2,y123=(y12+y23)/2,x234=(x23+x34)/2,y234=(y23+y34)/2,x1234=(x123+x234)/2,y1234=(y123+y234)/2;if(level>0){var da1,da2,dx=x4-x1,dy=y4-y1,d2=Math.abs((x2-x4)*dy-(y2-y4)*dx),d3=Math.abs((x3-x4)*dy-(y3-y4)*dx);if(d2>curve_collinearity_epsilon&&d3>curve_collinearity_epsilon){if(m_distance_tolerance*(dx*dx+dy*dy)>=(d2+d3)*(d2+d3)){if(curve_angle_tolerance_epsilon>m_angle_tolerance)return void points.push(new Vector(x1234,y1234));var a23=Math.atan2(y3-y2,x3-x2);if(da1=Math.abs(a23-Math.atan2(y2-y1,x2-x1)),da2=Math.abs(Math.atan2(y4-y3,x4-x3)-a23),da1>=Math.PI&&(da1=2*Math.PI-da1),da2>=Math.PI&&(da2=2*Math.PI-da2),m_angle_tolerance>da1+da2)return void points.push(new Vector(x1234,y1234));if(0!==m_cusp_limit){if(da1>m_cusp_limit)return void points.push(new Vector(x2,y2));if(da2>m_cusp_limit)return void points.push(new Vector(x3,y3))}}}else if(d2>curve_collinearity_epsilon){if(m_distance_tolerance*(dx*dx+dy*dy)>=d2*d2){if(curve_angle_tolerance_epsilon>m_angle_tolerance)return void points.push(new Vector(x1234,y1234));if(da1=Math.abs(Math.atan2(y3-y2,x3-x2)-Math.atan2(y2-y1,x2-x1)),da1>=Math.PI&&(da1=2*Math.PI-da1),m_angle_tolerance>da1)return points.push(new Vector(x2,y2)),void points.push(new Vector(x3,y3));if(0!==m_cusp_limit&&da1>m_cusp_limit)return void points.push(new Vector(x2,y2))}}else if(d3>curve_collinearity_epsilon){if(m_distance_tolerance*(dx*dx+dy*dy)>=d3*d3){if(curve_angle_tolerance_epsilon>m_angle_tolerance)return void points.push(new Vector(x1234,y1234));if(da1=Math.abs(Math.atan2(y4-y3,x4-x3)-Math.atan2(y3-y2,x3-x2)),da1>=Math.PI&&(da1=2*Math.PI-da1),m_angle_tolerance>da1)return points.push(new Vector(x2,y2)),void points.push(new Vector(x3,y3));if(0!==m_cusp_limit&&da1>m_cusp_limit)return void points.push(new Vector(x3,y3))}}else if(dx=x1234-(x1+x4)/2,dy=y1234-(y1+y4)/2,m_distance_tolerance>=dx*dx+dy*dy)return void points.push(new Vector(x1234,y1234))}__recursive_bezier(points,x1,y1,x12,y12,x123,y123,x1234,y1234,level+1),__recursive_bezier(points,x1234,y1234,x234,y234,x34,y34,x4,y4,level+1)}}function traceBezier(p0,cp0,cp1,p1,m_points){var x1=p0.x,y1=p0.y,x2=cp0.x,y2=cp0.y,x3=cp1.x,y3=cp1.y,x4=p1.x,y4=p1.y,m_points=m_points||[];return m_distance_tolerance=.5/m_approximation_scale,m_distance_tolerance*=m_distance_tolerance,m_points.push(new Vector(x1,y1)),__recursive_bezier(m_points,x1,y1,x2,y2,x3,y3,x4,y4,0),m_points.push(new Vector(x4,y4)),m_points}function traceQuadratic(p0,cp0,p1,m_points){var x1=p0.x,y1=p0.y,x2=cp0.x,y2=cp0.y,x3=p1.x,y3=p1.y;return m_points=m_points||[],m_distance_tolerance=.5/m_approximation_scale,m_distance_tolerance*=m_distance_tolerance,m_points.push(new Vector(x1,y1)),__recursive_quadratic(m_points,x1,y1,x2,y2,x3,y3,0),m_points.push(new Vector(x3,y3)),m_points}function __recursive_quadratic(points,x1,y1,x2,y2,x3,y3,level){if(!(level>curve_recursion_limit)){var x12=(x1+x2)/2,y12=(y1+y2)/2,x23=(x2+x3)/2,y23=(y2+y3)/2,x123=(x12+x23)/2,y123=(y12+y23)/2,dx=x3-x1,dy=y3-y1,d=Math.abs((x2-x3)*dy-(y2-y3)*dx);if(d>curve_collinearity_epsilon){if(m_distance_tolerance*(dx*dx+dy*dy)>=d*d){if(curve_angle_tolerance_epsilon>m_angle_tolerance)return void points.push(new Vector(x123,y123));var da=Math.abs(Math.atan2(y3-y2,x3-x2)-Math.atan2(y2-y1,x2-x1));if(da>=Math.PI&&(da=2*Math.PI-da),m_angle_tolerance>da)return void points.push(new Vector(x123,y123))}}else if(dx=x123-(x1+x3)/2,dy=y123-(y1+y3)/2,m_distance_tolerance>=dx*dx+dy*dy)return void points.push(new Vector(x123,y123));__recursive_quadratic(points,x1,y1,x12,y12,x123,y123,level+1),__recursive_quadratic(points,x123,y123,x23,y23,x3,y3,level+1)}}var Vector=cc.math.Vector,curve_recursion_limit=8,m_angle_tolerance=.2,m_cusp_limit=15*Math.PI/180,m_approximation_scale=1,curve_collinearity_epsilon=.001,curve_angle_tolerance_epsilon=0,m_distance_tolerance=1e-4;path.traceBezier=traceBezier,path.traceQuadratic=traceQuadratic}(path=math.path||(math.path={}))}(math=cc.math||(cc.math={}))}(cc||(cc={}));var cc;!function(cc){var math;!function(math){var path;!function(_path){var Vector=cc.math.Vector,__v0=new Vector,SegmentQuadratic=function(){function SegmentQuadratic(data){this._p0=null,this._cp0=null,this._p1=null,this._dirty=!0,this._parent=null,this._length=0,this._flattened=!1,this._cachedContourPoints=null,data&&this.initialize(data.p0,data.p1,data.p2)}return SegmentQuadratic.prototype.initialize=function(p0,p1,p2){this._p0=new Vector(p0.x,p0.y),this._cp0=new Vector(p1.x,p1.y),this._p1=new Vector(p2.x,p2.y),this.__update(),this._dirty=!1},SegmentQuadratic.prototype.flatten=function(numPoints){if(this._dirty||!this._flattened||numPoints!==this._cachedContourPoints.length){var points=cc.math.path.traceQuadratic(this._p0,this._cp0,this._p1);numPoints=numPoints||2*points.length;var path=cc.math.Path.createFromPoints(points);return points=[],path.trace(numPoints,points),this._flattened=!0,this._cachedContourPoints=points,this.__calculateLength(),this._dirty=!1,this}},SegmentQuadratic.prototype.__update=function(numPoints){if(this._dirty=!1,numPoints=numPoints||this._cachedContourPoints&&this._cachedContourPoints.length||cc.math.path.DEFAULT_TRACE_LENGTH,this._flattened)this.flatten();else{this._cachedContourPoints=[];for(var i=0;numPoints>=i;i++)this._cachedContourPoints.push(this.getValueAt(i/numPoints,new Vector))}this.__calculateLength()},SegmentQuadratic.prototype.__calculateLength=function(){var points=this._cachedContourPoints;this._length=0;for(var i=0;i<points.length-1;i++)this._length+=points[i].distance(points[i+1])},SegmentQuadratic.prototype.getParent=function(){return this._parent},SegmentQuadratic.prototype.setParent=function(s){this._parent=s},SegmentQuadratic.prototype.getLength=function(){return this._dirty&&this.__update(),this._length},SegmentQuadratic.prototype.trace=function(numPoints,dstArray){if(this._dirty&&this.__update(numPoints),dstArray=dstArray||[],this._cachedContourPoints!==dstArray)for(var i=0;i<this._cachedContourPoints.length;i++)dstArray.push(this._cachedContourPoints[i]);return dstArray},SegmentQuadratic.prototype.getValueAt=function(normalizedPos,out){if(this._dirty&&this.__update(),out=out||__v0,(normalizedPos>1||-1>normalizedPos)&&(normalizedPos%=1),0>normalizedPos&&(normalizedPos+=1),this._flattened){var fp=this._cachedContourPoints,segment=normalizedPos*fp.length-1;normalizedPos=(segment-(0|segment))/(1/(fp.length-1)),segment|=0,out.x=fp[segment].x+(fp[segment+1].x-fp[segment].x)*normalizedPos,out.y=fp[segment].y+(fp[segment+1].y-fp[segment].y)*normalizedPos}else if(1===normalizedPos)out.set(this._p1.x,this._p1.y);else if(0===normalizedPos)out.set(this._p0.x,this._p0.y);else{var t1=(this._p0,this._cp0,this._p1,1-normalizedPos),t=normalizedPos;out.x=SegmentQuadratic.solve(this._p0.x,this._cp0.x,this._p1.x,t,t1),out.y=SegmentQuadratic.solve(this._p0.y,this._cp0.y,this._p1.y,t,t1)}return out},SegmentQuadratic.solve=function(v0,cv0,v1,t,t1){return t1*t1*v0+2*t1*t*cv0+t*t*v1},SegmentQuadratic.prototype.getStartingPoint=function(){return this._p0},SegmentQuadratic.prototype.getEndingPoint=function(){return this._p1},SegmentQuadratic.prototype.clone=function(){var segment=new SegmentQuadratic({p0:{x:this._p0.x,y:this._p0.y},p1:{x:this._cp0.x,y:this._cp0.y},p2:{x:this._p1.x,y:this._p1.y}});return this._flattened&&segment.flatten(this._cachedContourPoints.length),segment._length=this._length,segment},SegmentQuadratic.prototype.getControlPoints=function(arr){return arr=arr||[],arr.push(this._p0),arr.push(this._cp0),arr.push(this._p1),arr},SegmentQuadratic.prototype.setDirty=function(){this._dirty=!0;for(var p=this._parent;p;)p.setDirty(),p=p._parent},SegmentQuadratic.prototype.paint=function(){},SegmentQuadratic}();_path.SegmentQuadratic=SegmentQuadratic}(path=math.path||(math.path={}))}(math=cc.math||(cc.math={}))}(cc||(cc={}));var cc;!function(cc){var math;!function(math){var path;!function(_path){var Vector=cc.math.Vector,__v0=new Vector,SegmentBezier=function(){function SegmentBezier(data){this._p0=null,this._cp0=null,this._cp1=null,this._p1=null,this._dirty=!0,this._parent=null,this._length=0,this._flattened=!1,this._cachedContourPoints=null,data&&this.initialize(data.p0,data.p1,data.p2,data.p3)}return SegmentBezier.prototype.initialize=function(p0,p1,p2,p3){this._p0=new Vector(p0.x,p0.y),this._cp0=new Vector(p1.x,p1.y),this._cp1=new Vector(p2.x,p2.y),this._p1=new Vector(p3.x,p3.y),this.__update(),this._dirty=!1},SegmentBezier.prototype.flatten=function(numPoints){if(this._dirty||!this._flattened||numPoints!==this._cachedContourPoints.length){var points=cc.math.path.traceBezier(this._p0,this._cp0,this._cp1,this._p1);numPoints=numPoints||2*points.length;var path=cc.math.Path.createFromPoints(points);return points=[],path.trace(numPoints,points),this._flattened=!0,this._cachedContourPoints=points,this.__calculateLength(),this._dirty=!1,this}},SegmentBezier.prototype.__update=function(numPoints){if(this._dirty=!1,numPoints=numPoints||this._cachedContourPoints&&this._cachedContourPoints.length||cc.math.path.DEFAULT_TRACE_LENGTH,this._flattened)this.flatten();else{this._cachedContourPoints=[];for(var i=0;numPoints>=i;i++)this._cachedContourPoints.push(this.getValueAt(i/numPoints,new Vector))}this.__calculateLength()},SegmentBezier.prototype.__calculateLength=function(){var points=this._cachedContourPoints;this._length=0;for(var i=0;i<points.length-1;i++)this._length+=points[i].distance(points[i+1])},SegmentBezier.prototype.getParent=function(){return this._parent},SegmentBezier.prototype.setParent=function(s){this._parent=s},SegmentBezier.prototype.getLength=function(){return this._dirty&&this.__update(),this._length},SegmentBezier.prototype.trace=function(numPoints,dstArray){if(this._dirty&&this.__update(numPoints),dstArray=dstArray||[],this._cachedContourPoints!==dstArray)for(var i=0;i<this._cachedContourPoints.length;i++)dstArray.push(this._cachedContourPoints[i]);return dstArray},SegmentBezier.prototype.getValueAt=function(normalizedPos,out){if(this._dirty&&this.__update(),out=out||__v0,(normalizedPos>1||-1>normalizedPos)&&(normalizedPos%=1),0>normalizedPos&&(normalizedPos+=1),this._flattened){var fp=this._cachedContourPoints,segment=normalizedPos*(fp.length-1);normalizedPos=(segment-(0|segment))/(1/(fp.length-1)),segment|=0,out.x=fp[segment].x+(fp[segment+1].x-fp[segment].x)*normalizedPos,out.y=fp[segment].y+(fp[segment+1].y-fp[segment].y)*normalizedPos}else if(1===normalizedPos)out.set(this._p1.x,this._p1.y);else if(0===normalizedPos)out.set(this._p0.x,this._p0.y);else{var t=normalizedPos,t2=t*t,t3=t*t2;out.x=SegmentBezier.solve(this._p0.x,this._cp0.x,this._cp1.x,this._p1.x,t,t2,t3),out.y=SegmentBezier.solve(this._p0.y,this._cp0.y,this._cp1.y,this._p1.y,t,t2,t3)}return out},SegmentBezier.solve=function(v0,vc0,cv1,v1,t,t2,t3){return v0+t*(3*-v0+t*(3*v0-v0*t))+t*(3*vc0+t*(-6*vc0+3*vc0*t))+t2*(3*cv1-3*cv1*t)+t3*v1},SegmentBezier.prototype.getStartingPoint=function(){return this._p0},SegmentBezier.prototype.getEndingPoint=function(){return this._p1},SegmentBezier.prototype.clone=function(){var segment=new SegmentBezier({p0:{x:this._p0.x,y:this._p0.y},p1:{x:this._cp0.x,y:this._cp0.y},p2:{x:this._cp1.x,y:this._cp1.y},p3:{x:this._p1.x,y:this._p1.y}});return this._flattened&&segment.flatten(this._cachedContourPoints.length),segment._length=this._length,segment},SegmentBezier.prototype.getControlPoints=function(arr){return arr=arr||[],arr.push(this._p0),arr.push(this._cp0),arr.push(this._cp1),arr.push(this._p1),arr},SegmentBezier.prototype.setDirty=function(){this._dirty=!0;for(var p=this._parent;p;)p.setDirty(),p=p._parent},SegmentBezier.prototype.paint=function(){},SegmentBezier}();_path.SegmentBezier=SegmentBezier}(path=math.path||(math.path={}))}(math=cc.math||(cc.math={}))}(cc||(cc={}));var cc;!function(cc){var math;!function(math){var path;!function(path){var Vector=cc.math.Vector,__v0=new Vector,SegmentArc=function(){function SegmentArc(data){this._dirty=!0,this._startingPoint=null,this._endingPoint=null,this._length=0,this.initialize(data)}return SegmentArc.prototype.initialize=function(data){this._x=data.x,this._y=data.y,this._radius=data.radius,this._startAngle=data.startAngle,this._endAngle=data.endAngle,this._ccw=data.ccw,!this._ccw&&this._endAngle<=this._startAngle?this._endAngle+=2*Math.PI:this._ccw&&this._startAngle<=this._endAngle&&(this._startAngle+=2*Math.PI);
var s=this.getValueAt(0);this._startingPoint=new Vector,this._startingPoint.x=s.x,this._startingPoint.y=s.y,s=this.getValueAt(1),this._endingPoint=new Vector,this._endingPoint.x=s.x,this._endingPoint.y=s.y,this._length=Math.abs(this._radius*(this._endAngle-this._startAngle))},SegmentArc.prototype.getStartingPoint=function(){return this._startingPoint},SegmentArc.prototype.getEndingPoint=function(){return this._endingPoint},SegmentArc.prototype.getLength=function(){return this._length},SegmentArc.prototype.getValueAt=function(v,out){var diffAngle=(this._endAngle-this._startAngle)*v;return out=out||__v0,out.x=this._x+this._radius*Math.cos(this._startAngle+diffAngle),out.y=this._y+this._radius*Math.sin(this._startAngle+diffAngle),out},SegmentArc.prototype.trace=function(numPoints,dstArray){if(numPoints=numPoints||cc.math.path.DEFAULT_TRACE_LENGTH,dstArray=dstArray||[],this._startAngle===this._endAngle||0===this._radius)return dstArray;for(var i=0;numPoints>i;i++)dstArray.push(this.getValueAt(i/numPoints,new Vector));return dstArray},SegmentArc.prototype.getParent=function(){return this._parent},SegmentArc.prototype.setParent=function(s){this._parent=s},SegmentArc.prototype.clone=function(){return new SegmentArc({x:this._x,y:this._y,radius:this._radius,startAngle:this._startAngle,endAngle:this._endAngle,ccw:this._ccw})},SegmentArc.prototype.getControlPoints=function(arr){return arr=arr||[]},SegmentArc.prototype.setDirty=function(){this._dirty=!0;for(var p=this._parent;p;)p.setDirty(),p=p._parent},SegmentArc.prototype.paint=function(){},SegmentArc}();path.SegmentArc=SegmentArc}(path=math.path||(math.path={}))}(math=cc.math||(cc.math={}))}(cc||(cc={}));var cc;!function(cc){var math;!function(math){var path;!function(_path){var Vector=cc.math.Vector,__v0=new Vector,SegmentCardinalSpline=function(){function SegmentCardinalSpline(data){this._p0=null,this._cp0=null,this._cp1=null,this._p1=null,this._tension=.5,this._dirty=!0,this._parent=null,this._length=0,this._flattened=!1,this._cachedContourPoints=null,data&&this.initialize(data.p0,data.cp0,data.cp1,data.p1,data.tension)}return SegmentCardinalSpline.prototype.initialize=function(p0,cp0,cp1,p1,tension){this._tension="undefined"==typeof tension?.5:tension,this._p0=new Vector(p0.x,p0.y),this._cp0=new Vector(cp0.x,cp0.y),this._cp1=new Vector(cp1.x,cp1.y),this._p1=new Vector(p1.x,p1.y),this.__update(),this._dirty=!1},SegmentCardinalSpline.prototype.setTension=function(t){t!==this._tension&&(this._tension=t,this.setDirty())},SegmentCardinalSpline.prototype.flatten=function(numPoints){if(this._dirty||!this._flattened||numPoints!==this._cachedContourPoints.length){numPoints=numPoints||cc.math.path.DEFAULT_TRACE_LENGTH;var points=this.__trace(null,numPoints);numPoints=numPoints||2*points.length;var path=cc.math.Path.createFromPoints(points);return points=[],path.trace(numPoints,points),this._flattened=!0,this._cachedContourPoints=points,this.__calculateLength(),this._dirty=!1,this}},SegmentCardinalSpline.prototype.__trace=function(points,numPoints){points=points||[];for(var i=0;numPoints>=i;i++)points.push(this.getValueAt(i/numPoints,new Vector));return points},SegmentCardinalSpline.prototype.__update=function(numPoints){this._dirty=!1,numPoints=numPoints||this._cachedContourPoints&&this._cachedContourPoints.length||cc.math.path.DEFAULT_TRACE_LENGTH,this._flattened?this.flatten():(this._cachedContourPoints=[],this.__trace(this._cachedContourPoints,numPoints)),this.__calculateLength()},SegmentCardinalSpline.prototype.__calculateLength=function(){var points=this._cachedContourPoints;this._length=0;for(var i=0;i<points.length-1;i++)this._length+=points[i].distance(points[i+1])},SegmentCardinalSpline.prototype.getParent=function(){return this._parent},SegmentCardinalSpline.prototype.setParent=function(s){this._parent=s},SegmentCardinalSpline.prototype.getLength=function(){return this._dirty&&this.__update(),this._length},SegmentCardinalSpline.prototype.trace=function(numPoints,dstArray){if(this._dirty&&this._flattened&&this.__update(numPoints),dstArray=dstArray||[],this._cachedContourPoints!==dstArray)for(var i=0;i<this._cachedContourPoints.length;i++)dstArray.push(this._cachedContourPoints[i]);return dstArray},SegmentCardinalSpline.prototype.getValueAt=function(normalizedPos,out){if(this._dirty&&this.__update(),out=out||__v0,(normalizedPos>1||-1>normalizedPos)&&(normalizedPos%=1),0>normalizedPos&&(normalizedPos+=1),this._flattened){var fp=this._cachedContourPoints,segment=normalizedPos*fp.length-1;normalizedPos=(segment-(0|segment))/(1/(fp.length-1)),segment|=0,out.x=fp[segment].x+(fp[segment+1].x-fp[segment].x)*normalizedPos,out.y=fp[segment].y+(fp[segment+1].y-fp[segment].y)*normalizedPos}else if(1===normalizedPos){var lp=this.getEndingPoint();out.set(lp.x,lp.y)}else if(0===normalizedPos){var fp_=this.getStartingPoint();out.set(fp_.x,fp_.y)}else{var t=normalizedPos,t2=t*t,t3=t2*t,s=(1-this._tension)/2,b1=s*(-t3+2*t2-t),b2=s*(-t3+t2)+(2*t3-3*t2+1),b3=s*(t3-2*t2+t)+(-2*t3+3*t2),b4=s*(t3-t2);out.x=this._p0.x*b1+this._cp0.x*b2+this._cp1.x*b3+this._p1.x*b4,out.y=this._p0.y*b1+this._cp0.y*b2+this._cp1.y*b3+this._p1.y*b4}return out},SegmentCardinalSpline.prototype.getStartingPoint=function(){return this._cp0},SegmentCardinalSpline.prototype.getEndingPoint=function(){return this._cp1},SegmentCardinalSpline.prototype.clone=function(){var segment=new SegmentCardinalSpline({p0:this._p0,cp0:this._cp0,cp1:this._cp1,p1:this._p1,tension:this._tension});return this._flattened&&segment.flatten(this._cachedContourPoints.length),segment._length=this._length,segment},SegmentCardinalSpline.prototype.getControlPoints=function(arr){return arr=arr||[],arr.push(this._p0),arr.push(this._cp0),arr.push(this._cp1),arr.push(this._p1),arr},SegmentCardinalSpline.prototype.setDirty=function(){this._dirty=!0;for(var p=this._parent;p;)p.setDirty(),p=p._parent},SegmentCardinalSpline.prototype.paint=function(ctx){ctx.beginPath(),ctx.moveTo(this._cachedContourPoints[0].x,this._cachedContourPoints[0].y);for(var i=1;i<this._cachedContourPoints.length;i++)ctx.lineTo(this._cachedContourPoints[i].x,this._cachedContourPoints[i].y);ctx.stroke()},SegmentCardinalSpline}();_path.SegmentCardinalSpline=SegmentCardinalSpline}(path=math.path||(math.path={}))}(math=cc.math||(cc.math={}))}(cc||(cc={}));var cc;!function(cc){var math;!function(math){var path;!function(path){var __v0=new math.Vector,ContainerSegment=function(){function ContainerSegment(){this._parent=null,this._length=0,this._segments=[],this._dirty=!0}return ContainerSegment.prototype.getLength=function(){return this._dirty&&this.__calculateLength(),this._length},ContainerSegment.prototype.__calculateLength=function(){for(var length=0,i=0;i<this._segments.length;i++)length+=this._segments[i].getLength();return this._dirty=!1,this._length=length,this._length},ContainerSegment.prototype.getValueAt=function(normalizedPos,out){this._dirty&&(this.__calculateLength(),this._dirty=!1),out=out||__v0;for(var pos=normalizedPos*this._length,search=0,i=0;i<this._segments.length;i++){if(pos>=search&&pos<search+this._segments[i].getLength())return search=pos-search,search/=this._segments[i].getLength(),this._segments[i].getValueAt(search,out);search+=this._segments[i].getLength()}var ep=this.getEndingPoint();return out.set(ep.x,ep.y)},ContainerSegment.prototype.trace=function(numPoints,dstArray){dstArray=dstArray||[],numPoints=numPoints||cc.math.path.DEFAULT_TRACE_LENGTH;for(var i=0;numPoints>=i;i++)dstArray.push(this.getValueAt(i/numPoints,new math.Vector));return dstArray},ContainerSegment.prototype.getStartingPoint=function(){return null},ContainerSegment.prototype.getEndingPoint=function(){return null},ContainerSegment.prototype.getParent=function(){return this._parent},ContainerSegment.prototype.setParent=function(s){this._parent=s},ContainerSegment.prototype.clone=function(){throw"ContainerSegments can't clone."},ContainerSegment.prototype.getControlPoints=function(arr){arr=arr||[];for(var i=0;i<this._segments.length;i++)this._segments[i].getControlPoints(arr);return arr},ContainerSegment.prototype.setDirty=function(){this._dirty=!0;for(var p=this._parent;p;)p.setDirty(),p=p._parent},ContainerSegment.prototype.paint=function(){},ContainerSegment}();path.ContainerSegment=ContainerSegment}(path=math.path||(math.path={}))}(math=cc.math||(cc.math={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var math;!function(math){var path;!function(path){var Vector=cc.math.Vector,SegmentLine=cc.math.path.SegmentLine,SegmentArc=cc.math.path.SegmentArc,ContainerSegment=cc.math.path.ContainerSegment,SubPath=function(_super){function SubPath(){_super.call(this),this._currentPoint=null,this._closed=!1}return __extends(SubPath,_super),SubPath.prototype.isClosed=function(){return this._closed},SubPath.prototype.isEmpty=function(){return null===this._currentPoint},SubPath.prototype.numSegments=function(){return this._segments.length},SubPath.prototype.addSegment=function(s){s.setParent(this),this._segments.push(s)},SubPath.prototype.beginPath=function(){return this._segments=[],this._length=0,this._currentPoint=null,this._closed=!1,this},SubPath.prototype.moveTo=function(x,y){return this._closed?void cc.Debug.warn(cc.locale.WARN_MOVETO_IN_NON_EMPTY_SUBPATH):(null===this._currentPoint&&(this._currentPoint=new Vector),0===this.numSegments()&&(this._currentPoint.x=x,this._currentPoint.y=y),this)},SubPath.prototype.lineTo=function(x,y){return this._closed?void cc.Debug.warn(cc.locale.WARN_TRACE_ON_CLOSED_SUBPATH,"lineTo"):(this.isEmpty()?this._currentPoint=new Vector:this.addSegment(new SegmentLine({start:{x:this._currentPoint.x,y:this._currentPoint.y},end:{x:x,y:y}})),this._currentPoint.x=x,this._currentPoint.y=y,this)},SubPath.prototype.arc=function(x,y,radius,startAngle,endAngle,anticlockwise,addLineTo){if(this._closed)return void cc.Debug.warn(cc.locale.WARN_TRACE_ON_CLOSED_SUBPATH,"ClosePath");var segment=new SegmentArc({x:x,y:y,radius:radius,startAngle:startAngle,endAngle:endAngle,ccw:anticlockwise});if(addLineTo){var sp=segment.getStartingPoint();this.addSegment(new SegmentLine({start:{x:this._currentPoint.x,y:this._currentPoint.y},end:{x:sp.x,y:sp.y}}))}this.addSegment(segment);var fp=segment.getEndingPoint();return this._currentPoint.set(fp.x,fp.y),this._dirty=!0,this},SubPath.prototype.closePath=function(){if(this._closed)return void cc.Debug.warn(cc.locale.WARN_TRACE_ON_CLOSED_SUBPATH,"ClosePath");if(this.isEmpty())return void cc.Debug.warn(cc.locale.WARN_CLOSE_EMPTY_SUBPATH,"ClosePath");var p=this.getStartingPoint(),segment=new SegmentLine({start:{x:this._currentPoint.x,y:this._currentPoint.y},end:{x:p.x,y:p.y}});return this.addSegment(segment),this._currentPoint=segment.getEndingPoint(),this._closed=!0,this._dirty=!0,this},SubPath.prototype.getStartingPoint=function(){return this.isEmpty()?void cc.Debug.error(cc.locale.ERR_SUBPATH_NOT_STARTED,"getStartingPoint"):this._segments.length?this._segments[0].getStartingPoint():this._currentPoint},SubPath.prototype.getEndingPoint=function(){return this.isEmpty()?void cc.Debug.error(cc.locale.ERR_SUBPATH_NOT_STARTED,"getEndingPoint"):this._segments.length?this._segments[this._segments.length-1].getEndingPoint():this._currentPoint},SubPath.prototype.clone=function(){var sp=new SubPath;sp._closed=this._closed;for(var i=0;i<this._segments.length;i++)sp._segments.push(this._segments[i].clone());return sp._length=this._length,sp._currentPoint=this._currentPoint.clone(),sp},SubPath.prototype.quadraticTo=function(x0,y0,x1,y1){return this._closed?(cc.Debug.warn(cc.locale.WARN_TRACE_ON_CLOSED_SUBPATH,"lineTo"),this):(this.addSegment(new cc.math.path.SegmentQuadratic({p0:{x:this._currentPoint.x,y:this._currentPoint.y},p1:{x:x0,y:y0},p2:{x:x1,y:y1}})),this._currentPoint.x=x1,this._currentPoint.y=y1,this)},SubPath.prototype.bezierTo=function(x0,y0,x1,y1,x2,y2){return this._closed?(cc.Debug.warn(cc.locale.WARN_TRACE_ON_CLOSED_SUBPATH,"lineTo"),this):(this.addSegment(new cc.math.path.SegmentBezier({p0:{x:this._currentPoint.x,y:this._currentPoint.y},p1:{x:x0,y:y0},p2:{x:x1,y:y1},p3:{x:x2,y:y2}})),this._currentPoint.x=x2,this._currentPoint.y=y2,this)},SubPath.prototype.catmullRomTo=function(x0,y0,x1,y1,x2,y2,tension){return this._closed?(cc.Debug.warn(cc.locale.WARN_TRACE_ON_CLOSED_SUBPATH,"lineTo"),this):(this.addSegment(new cc.math.path.SegmentCardinalSpline({p0:{x:this._currentPoint.x,y:this._currentPoint.y},cp0:{x:x0,y:y0},cp1:{x:x1,y:y1},p1:{x:x2,y:y2},tension:tension})),this._currentPoint.x=x0,this._currentPoint.y=y0,this)},SubPath.prototype.paint=function(ctx){ctx.beginPath();for(var i=0;i<this._segments.length;i++)this._segments[i].paint(ctx);ctx.stroke()},SubPath}(ContainerSegment);path.SubPath=SubPath}(path=math.path||(math.path={}))}(math=cc.math||(cc.math={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var math;!function(math){var SubPath=cc.math.path.SubPath,ContainerSegment=cc.math.path.ContainerSegment,Vector=cc.math.Vector,Matrix3=cc.math.Matrix3,__v0=new Vector,__v1=new Vector,__v2=new Vector,__v3=new Vector,__m0=new Float32Array([1,0,0,0,1,0,0,0,1]),__m1=new Float32Array([1,0,0,0,1,0,0,0,1]),Path=function(_super){function Path(){_super.call(this),this._currentSubPath=null}return __extends(Path,_super),Path.prototype.numSubPaths=function(){return this._segments.length},Path.prototype.__newSubPath=function(){var subpath=new SubPath;this._segments.push(subpath),subpath._parent=this,this._currentSubPath=subpath},Path.prototype.isEmpty=function(){return 0===this._segments.length},Path.prototype.__ensureSubPath=function(x,y){void 0===x&&(x=0),void 0===y&&(y=0),this.isEmpty()&&(this.__newSubPath(),this._currentSubPath.moveTo(x,y))},Path.prototype.__chainSubPathIfCurrentIsClosed=function(){if(this._currentSubPath.isClosed()){var pt=this._currentSubPath._currentPoint;this.__newSubPath(),this._currentSubPath.moveTo(pt.x,pt.y)}},Path.prototype.getCurrentTracePosition=function(){return null===this._currentSubPath?(cc.Debug.warn(cc.locale.WARN_TRACER_EMPTY,"getCurrentTracePosition"),{x:0,y:0}):this._currentSubPath._currentPoint},Path.prototype.getStartingPoint=function(){return null===this._currentSubPath?(cc.Debug.warn(cc.locale.WARN_TRACER_EMPTY,"getStartingPoint"),__v0.set(0,0)):this._currentSubPath.getStartingPoint()},Path.prototype.getEndingPoint=function(){return null===this._currentSubPath?(cc.Debug.warn(cc.locale.WARN_TRACER_EMPTY,"getEndingPoint"),__v0.set(0,0)):this._segments[this._segments.length-1].getEndingPoint()},Path.createFromPoints=function(points){if(!points||0===points.length)return null;var closedPath=points[0].equals(points[points.length-1]),path=new Path;path.beginPath(),path.moveTo(points[0].x,points[0].y);for(var i=1;i<(closedPath?points.length-1:points.length);i++)path.lineTo(points[i].x,points[i].y);return closedPath&&path.closePath(),path},Path.prototype.beginPath=function(){return this._segments=[],this._length=0,this._currentSubPath=null,this._dirty=!0,this},Path.prototype.quadraticTo=function(x1,y1,x2,y2,matrix){return __v0.set(x1,y1),__v1.set(x2,y2),matrix&&(Matrix3.transformPoint(matrix,__v0),Matrix3.transformPoint(matrix,__v1)),this.__ensureSubPath(),this._currentSubPath.quadraticTo(__v0.x,__v0.y,__v1.x,__v1.y),this},Path.prototype.bezierTo=function(x0,y0,x1,y1,x2,y2,matrix){return __v0.set(x0,y0),__v1.set(x1,y1),__v2.set(x2,y2),matrix&&(Matrix3.transformPoint(matrix,__v0),Matrix3.transformPoint(matrix,__v1),Matrix3.transformPoint(matrix,__v2)),this.__ensureSubPath(),this._currentSubPath.bezierTo(__v0.x,__v0.y,__v1.x,__v1.y,__v2.x,__v2.y),this},Path.prototype.catmullRomTo=function(p0){for(var rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments[_i];if("number "==typeof p0){if(arguments.length<6)return;this.__catmullRomTo(p0,rest[0],rest[1],rest[2],rest[3],rest[4],tension,arguments.length>6?rest[5]:null)}else if(Array.isArray(p0)){var points=p0,closed=rest[0],tension=rest[1],matrix=arguments.length>3?rest[2]:null;points=points.slice(0),closed?(points.unshift(points[points.length-1]),points.push(points[1]),points.push(points[2])):(points.unshift(points[0]),points.push(points[points.length-1])),this.moveTo(points[0].x,points[0].y,matrix);for(var i=1;i<points.length-2;i++)this.__catmullRomTo(points[i].x,points[i].y,points[i+1].x,points[i+1].y,points[i+2].x,points[i+2].y,tension,matrix)}else console.log("invalid signature Path.catmullRomTo");return this},Path.prototype.__catmullRomTo=function(cp0x,cp0y,cp1x,cp1y,p1x,p1y,tension,matrix){__v0.set(cp0x,cp0y),__v1.set(cp1x,cp1y),__v2.set(p1x,p1y),matrix&&(Matrix3.transformPoint(matrix,__v0),Matrix3.transformPoint(matrix,__v1),Matrix3.transformPoint(matrix,__v2)),this.__ensureSubPath(),this._currentSubPath.catmullRomTo(__v0.x,__v0.y,__v1.x,__v1.y,__v2.x,__v2.y,tension)},Path.prototype.closePath=function(){return this._currentSubPath.closePath(),this._dirty=!0,this},Path.prototype.moveTo=function(x,y,matrix){return matrix&&(__v0.set(x,y),Matrix3.transformPoint(matrix,__v0),x=__v0.x,y=__v0.y),this.__ensureSubPath(x,y),this._currentSubPath.moveTo(x,y),this},Path.prototype.lineTo=function(x,y,matrix){return matrix&&(__v0.set(x,y),Matrix3.transformPoint(matrix,__v0),x=__v0.x,y=__v0.y),this.__ensureSubPath(x,y),this.__chainSubPathIfCurrentIsClosed(),this._currentSubPath.lineTo(x,y),this._dirty=!0,this},Path.prototype.rect=function(x,y,w,h,matrix){return this.__ensureSubPath(),0!==this._currentSubPath.numSegments()&&this.__newSubPath(),__v0.set(x,y),__v1.set(x+w,y),__v2.set(x+w,y+h),__v3.set(x,y+h),matrix&&(Matrix3.transformPoint(matrix,__v0),Matrix3.transformPoint(matrix,__v1),Matrix3.transformPoint(matrix,__v2),Matrix3.transformPoint(matrix,__v3)),this.moveTo(__v0.x,__v0.y),this.lineTo(__v1.x,__v1.y),this.lineTo(__v2.x,__v2.y),this.lineTo(__v3.x,__v3.y),this.closePath(),this.__newSubPath(),this._currentSubPath.moveTo(__v0.x,__v0.y),this._dirty=!0,this},Path.prototype.arc=function(x,y,radius,startAngle,endAngle,anticlockwise,matrix){var addLine=!1;__v0.set(x,y),matrix&&Matrix3.transformPoint(matrix,__v0),x=__v0.x,y=__v0.y,this.__ensureSubPath(x,y),this._currentSubPath.numSegments()&&(addLine=!0);var diffAngle=endAngle-startAngle;return diffAngle>2*Math.PI?diffAngle=2*Math.PI:diffAngle<-2*Math.PI&&(diffAngle=-2*Math.PI),diffAngle>-1e-4&&1e-4>diffAngle?this:(this.__chainSubPathIfCurrentIsClosed(),radius=cc.math.path.getDistanceVector(radius,matrix).length(),.1>=radius?(this.__ensureSubPath(x,y),this):(matrix&&(Matrix3.copy(__m0,matrix),Matrix3.setRotate(__m1,startAngle),Matrix3.multiply(__m0,__m1),startAngle=cc.math.path.getDistanceVector(1,matrix).angle()),this._currentSubPath.arc(x,y,radius,startAngle,startAngle+diffAngle,anticlockwise,addLine),this._dirty=!0,this))},Path.prototype.clone=function(){for(var path=new Path,i=0;i<this._segments.length;i++)path._segments.push(this._segments[i].clone());return path._currentSubPath=path._segments[path._segments.length-1],path._length=this._length,path},Path.prototype.paint=function(ctx){ctx.setTransform(1,0,0,1,0,0);for(var i=0;i<this._segments.length;i++)this._segments[i].paint(ctx)},Path}(ContainerSegment);math.Path=Path}(math=cc.math||(cc.math={}))}(cc||(cc={}));var cc;!function(cc){var node;!function(_node){_node.DEFAULT_ANCHOR_POSITION=new cc.math.Vector(0,0),_node.DEFAULT_ANCHOR_TRANSFORMATION=new cc.math.Vector(.5,.5);{var Vector=cc.math.Vector,Rectangle=cc.math.Rectangle,Dimension=cc.math.Dimension,Matrix3=cc.math.Matrix3,Color=cc.math.Color;Math.PI/180}!function(NodeDirtyFlags){NodeDirtyFlags[NodeDirtyFlags.NONE=0]="NONE",NodeDirtyFlags[NodeDirtyFlags.CHILDREN_SORT=1]="CHILDREN_SORT",NodeDirtyFlags[NodeDirtyFlags.TRANSFORMATION_DIRTY=2]="TRANSFORMATION_DIRTY",NodeDirtyFlags[NodeDirtyFlags.REQUEST_TRANSFORM=4]="REQUEST_TRANSFORM",NodeDirtyFlags[NodeDirtyFlags.VISIBLE=8]="VISIBLE",NodeDirtyFlags[NodeDirtyFlags.INVERSE_MATRIX=16]="INVERSE_MATRIX",NodeDirtyFlags[NodeDirtyFlags.PAUSED=32]="PAUSED",NodeDirtyFlags[NodeDirtyFlags.EVENTS_ENABLED=64]="EVENTS_ENABLED",NodeDirtyFlags[NodeDirtyFlags.EVENTS_PRIORITY_ENABLED=128]="EVENTS_PRIORITY_ENABLED",NodeDirtyFlags[NodeDirtyFlags.COMPOSITE_ON=256]="COMPOSITE_ON",NodeDirtyFlags[NodeDirtyFlags.GLOBAL_ALPHA=512]="GLOBAL_ALPHA",NodeDirtyFlags[NodeDirtyFlags.AABB_DIRTY=1024]="AABB_DIRTY"}(_node.NodeDirtyFlags||(_node.NodeDirtyFlags={}));var _OrderOfArrival=(_node.NodeDirtyFlags,0),DEFAULT_COLOR=new Color(1,1,1,1),Node=(new cc.math.Vector,function(){function Node(){this._children=[],this._parent=null,this._position=new Vector,this._positionAnchor=_node.DEFAULT_ANCHOR_POSITION.clone(),this._rotation=new Vector(0,0),this._scale=new Vector(0,0),this._transformationAnchor=_node.DEFAULT_ANCHOR_TRANSFORMATION.clone(),this._modelViewMatrix=Matrix3.create(),this._worldModelViewMatrix=Matrix3.create(),this._worldModelViewMatrixI=Matrix3.create(),this._color=DEFAULT_COLOR,this._alpha=1,this._frameAlpha=1,this._contentSize=new Dimension,this._localZOrder=0,this._orderOfArrival=0,this._isAA=!1,this._AABB=new Rectangle,this._BBVertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],this._tag=null,this._name="",this._flags=0,this._scene=null,this._actionsToSchedule=[],this._tasksToSchedule=[],this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotationAngle=0,this._compositeOperation=0,this._inputEvents={},this._flags=1036,cc.__BACKWARDS_COMPATIBILITY__&&this._contentSize.set(1,1)}return Node.prototype.__childrenMustSort=function(){return this._children.length>1&&0!==(1&this._flags)},Node.prototype.__clearFlag=function(f){this._flags&=~f},Node.prototype.__setFlag=function(f){this._flags|=f},Node.prototype.__isFlagSet=function(f){return 0!==(this._flags&f)},Node.prototype.__setFlagValue=function(f,enable){enable?this._flags|=f:this._flags&=~f},Node.prototype.isGlobalAlpha=function(){return this.__isFlagSet(512)},Node.prototype.setGlobalAlpha=function(b){this.__setFlagValue(512,b)},Node.prototype.setCompositeOperation=function(o){null!==o?(this._compositeOperation=o,this.__setFlag(256)):this.__clearFlag(256)},Node.prototype.setPosition=function(x,y){return this.x=x,this.y=y,this},Node.prototype.setRotation=function(x){return this.rotationAngle=x,this},Node.prototype.setScale=function(x,y){return this.scaleX=x,this.scaleY="undefined"==typeof y?x:y,this},Node.prototype.setScaleX=function(s){return this.scaleX=s,this},Node.prototype.setScaleY=function(s){return this.scaleY=s,this},Node.prototype.getParent=function(){return this._parent},Node.prototype.__setParent=function(node){return this._parent=node,this.__setFlag(4),this},Node.prototype.setPositionAnchor=function(x,y){return this._positionAnchor.set(x,y),this.__setFlag(4),this},Node.prototype.setAnchorPoint=function(x,y){return this.__setFlag(4),this.setTransformationAnchor(x,y),this.setPositionAnchor(x,y)},Node.prototype.setTransformationAnchor=function(x,y){return this._transformationAnchor.set(x,y),this.__setFlag(4),this},Node.prototype.setTag=function(t){return this._tag=t,this},Node.prototype.setOpacity=function(v){return this.setAlpha(v/255),this},Object.defineProperty(Node.prototype,"alpha",{get:function(){return this.getAlpha()},set:function(a){this.setAlpha(a)},enumerable:!0,configurable:!0}),Object.defineProperty(Node.prototype,"opacity",{get:function(){return 255*this.getAlpha()|0},set:function(a){this.setOpacity(a)},enumerable:!0,configurable:!0}),Node.prototype.setAlpha=function(a){return this._alpha=a,this},Node.prototype.getAlpha=function(){return this._alpha},Node.prototype.setColor=function(r,g,b){return this._color===DEFAULT_COLOR?this._color=new Color(r,g,b):(this._color._color[0]=r,this._color._color[1]=g,this._color._color[2]=b),this},Node.prototype.setContentSize=function(w,h){return this._contentSize.width=w,this._contentSize.height=h,this.__setFlag(4),this},Node.prototype.__setTransform=function(){return this.__setLocalTransform(),this.__setWorldTransform(),this.__isFlagSet(2)&&(this.__setFlag(16),this.__setFlag(1024)),this},Node.prototype.__setLocalTransformRotate=function(){Matrix3.setTransformAll(this._modelViewMatrix,this),this.__setFlag(2),this._position.x=this.x,this._position.y=this.y,this._scale.x=this.scaleX,this._scale.y=this.scaleY,this._rotation.x=this.rotationAngle},Node.prototype.__setLocalTransformScale=function(){Matrix3.setTransformScale(this._modelViewMatrix,this),this.__setFlag(2),this._position.x=this.x,this._position.y=this.y,this._scale.x=this.scaleX,this._scale.y=this.scaleY},Node.prototype.__setLocalTransform=function(){if(this._rotation.x!==this.rotationAngle||this.rotationAngle%360!==0||this.__isFlagSet(4))this.__setLocalTransformRotate();else if(this.scaleX!==this._scale.x||this._scale.y!==this.scaleY||1!==this._scale.x||1!==this._scale.y)this.__setLocalTransformScale();else if(this.x!==this._position.x||this.y!==this._position.y){var mm=this._modelViewMatrix,pa=this._positionAnchor,cs=this._contentSize,x=this.x-pa.x*cs.width,y=this.y-pa.y*cs.height;mm[2]=x,mm[5]=y,mm[0]=1,mm[1]=0,mm[3]=0,mm[4]=1,mm[6]=0,mm[7]=0,mm[8]=1,this._position.x=this.x,this._position.y=this.y,this.__setFlag(2)}},Node.prototype.__setWorldTransformNotAA=function(){var mm,mmm=this._worldModelViewMatrix,pmm=this._parent._worldModelViewMatrix;mmm[0]=pmm[0],mmm[1]=pmm[1],mmm[2]=pmm[2],mmm[3]=pmm[3],mmm[4]=pmm[4],mmm[5]=pmm[5],this._isAA?(mm=this._modelViewMatrix,mmm[2]+=mm[2]*mmm[0],mmm[5]+=mm[5]*mmm[4]):Matrix3.multiply(this._worldModelViewMatrix,this._modelViewMatrix)},Node.prototype.__setWorldTransformAA=function(px,py){var wmm=this._worldModelViewMatrix,mmm=this._modelViewMatrix;wmm[0]=mmm[0],wmm[1]=mmm[1],wmm[2]=mmm[2]+px,wmm[3]=mmm[3],wmm[4]=mmm[4],wmm[5]=mmm[5]+py,this._isAA=this._rotation.x%360===0},Node.prototype.__setWorldTransform=function(){var condition=this.__isFlagSet(2),isAA=this._rotation.x%360===0,px=0,py=0;this._parent&&(condition=condition||this._parent.__isFlagSet(2),isAA=isAA&&this._parent._isAA),condition&&(this._isAA=isAA,this._parent&&(px=this._parent._worldModelViewMatrix[2],py=this._parent._worldModelViewMatrix[5]),isAA?this.__setWorldTransformAA(px,py):this.__setWorldTransformNotAA(),this.__setFlagValue(2,condition))},Node.prototype.getInverseWorldModelViewMatrix=function(){return this.__isFlagSet(16)&&(Matrix3.inverse(this._worldModelViewMatrix,this._worldModelViewMatrixI),this.__clearFlag(16)),this._worldModelViewMatrixI},Node.prototype.visit=function(ctx){if(this.isVisible()){this.__clearFlag(2),this.__setTransform(),this.__childrenMustSort()&&this.__sortChildren(),this.__setAlphaImpl();var index=0;for(index=0;index<this._children.length;index++){var child=this._children[index];if(!(child._localZOrder<0))break;child.visit(ctx)}for(this.__draw(ctx);index<this._children.length;index++){var child=this._children[index];child.visit(ctx)}this.__clearFlag(4)}},Node.prototype.__setAlphaImpl=function(){this._frameAlpha=this._parent?this._parent._frameAlpha*this._alpha:this._alpha},Node.prototype.__AABBIntersectsScreen=function(ctx){return this.calculateBoundingBox(),this._AABB.intersects(0,0,ctx.getWidth(),ctx.getHeight())},Node.prototype.__calculateNAABBVertices=function(){var vv=this._BBVertices,_w=this._contentSize.width,_h=this._contentSize.height,v=vv[0];v.x=0,v.y=0,this.convertToWorldSpace(v),v=vv[1],v.x=_w,v.y=0,this.convertToWorldSpace(v),v=vv[2],v.x=_w,v.y=_h,this.convertToWorldSpace(v),v=vv[3],v.x=0,v.y=_h,this.convertToWorldSpace(v)},Node.prototype.__calculateAABBVertices=function(){var x,y,w,h,vv=this._BBVertices,mm=this._worldModelViewMatrix;x=mm[2],y=mm[5],w=this._contentSize.width*mm[0],h=this._contentSize.height*mm[4];var v;v=vv[0],v.x=x,v.y=y,v=vv[1],v.x=x+w,v.y=y,v=vv[2],v.x=x+w,v.y=y+h,v=vv[3],v.x=x,v.y=y+h},Node.prototype.calculateBoundingBox=function(){if(!this.__isFlagSet(1024))return this._AABB;var verts=this._BBVertices;this._isAA?this.__calculateAABBVertices():this.__calculateNAABBVertices();var xmin=Number.MAX_VALUE,ymin=Number.MAX_VALUE,xmax=-Number.MAX_VALUE,ymax=-Number.MAX_VALUE,v=verts[0];v.x<xmin&&(xmin=v.x),v.x>xmax&&(xmax=v.x),v.y<ymin&&(ymin=v.y),v.y>ymax&&(ymax=v.y);var v=verts[1];v.x<xmin&&(xmin=v.x),v.x>xmax&&(xmax=v.x),v.y<ymin&&(ymin=v.y),v.y>ymax&&(ymax=v.y);var v=verts[2];v.x<xmin&&(xmin=v.x),v.x>xmax&&(xmax=v.x),v.y<ymin&&(ymin=v.y),v.y>ymax&&(ymax=v.y);var v=verts[3];v.x<xmin&&(xmin=v.x),v.x>xmax&&(xmax=v.x),v.y<ymin&&(ymin=v.y),v.y>ymax&&(ymax=v.y);var aa=this._AABB;return aa.x=xmin,aa.y=ymin,aa.w=xmax-xmin,aa.h=ymax-ymin,this.__clearFlag(1024),this._AABB},Node.prototype.convertToWorldSpace=function(p){Matrix3.transformPoint(this._worldModelViewMatrix,p)},Node.prototype.__draw=function(ctx){Matrix3.setRenderingContextTransform(this._worldModelViewMatrix,ctx);var compositeSet=this.__isFlagSet(256),prevComposite=ctx.getCompositeOperation();compositeSet=compositeSet&&this._compositeOperation!==prevComposite,compositeSet&&ctx.setCompositeOperation(this._compositeOperation),this.draw(ctx),compositeSet&&ctx.setCompositeOperation(prevComposite)},Node.prototype.getScene=function(){return this._scene},Node.prototype.getPathToRoot=function(){var node=this,ret=[];do ret.push(node),node=node.getParent();while(node);return ret},Node.prototype.addEventListener=function(event,callback){return this._inputEvents[event]=callback,this},Node.prototype.notifyEvent=function(e){var callback=this._inputEvents[e.type];return"touchstart"===e.type?callback||(callback=this._inputEvents.mousedown):"touchend"===e.type?callback||(callback=this._inputEvents.mouseup):"touchmove"===e.type?callback||(callback=this._inputEvents.mousedrag):"touchover"===e.type?callback||(callback=this._inputEvents.mouseover):"touchout"===e.type&&(callback||(callback=this._inputEvents.mouseout)),callback?callback(e):!1},Node.prototype.getScreenPointInLocalSpace=function(p){var matrix=this.getInverseWorldModelViewMatrix();cc.math.Matrix3.transformPoint(matrix,p)},Node.prototype.getLocalPointInScreenSpace=function(p){cc.math.Matrix3.transformPoint(this._worldModelViewMatrix,p)},Node.prototype.getLocalPointInNodeSpace=function(p,node){this.getLocalPointInScreenSpace(p),node.getScreenPointInLocalSpace(p)},Node.prototype.isScreenPointInNode=function(p){return this.isVisible()?(this.getScreenPointInLocalSpace(p),p.x>=0&&p.y>=0&&p.x<this._contentSize.width&&p.y<this._contentSize.height):!1},Node.prototype.addChild=function(node,localZOrder){return arguments.length>2?(this.__legacyAddChild.apply(this,Array.prototype.slice.call(arguments)),this):(node._parent&&cc.Debug.error(cc.locale.MSG_ERROR_NODE_WITH_PARENT),node._orderOfArrival=_OrderOfArrival++,node._parent=this,"undefined"!=typeof localZOrder&&(node._localZOrder=localZOrder),this._children.length>0?node._localZOrder<this._children[0]._localZOrder?this._children.unshift(node):node._localZOrder>=this._children[this._children.length-1]._localZOrder?this._children.push(node):(this.__setFlag(1),this._children.push(node)):this._children.push(node),null!==this.getScene()&&node.setScene(this.getScene()),this)},Node.prototype.__legacyAddChild=function(child,localZOrder,tag){localZOrder=void 0===localZOrder?child._localZOrder:localZOrder;var name,setTag=!1;"undefined"==typeof tag?(tag=void 0,name=child._name):"string"==typeof tag?(name=tag,tag=void 0):"number"==typeof tag&&(setTag=!0,name=""),this._children||(this._children=[]),this._children.push(child),child._localZOrder=localZOrder,setTag?child.setTag(tag):child.setName(name),child._parent=this,child._orderOfArrival=_OrderOfArrival++,null!==this.getScene()&&child.setScene(this.getScene()),this.__setFlag(1)},Node.prototype.reorderChild=function(node,localZOrder){this.__setFlag(1),node._orderOfArrival=_OrderOfArrival++,node._localZOrder=localZOrder},Node.prototype.__sortChildren=function(){this._children.sort(function(n0,n1){return n0._localZOrder<n1._localZOrder?-1:n0._localZOrder>n1._localZOrder?1:n0._orderOfArrival<n1._orderOfArrival?-1:1
}),this.__clearFlag(1)},Node.prototype.removeChild=function(node,cleanup){var index=this._children.indexOf(node);return index>=0&&(cleanup&&(this.stopAllActions(),this.unscheduleAllCallbacks()),this._children.splice(index,1),node._parent=null,node._scene=this._scene),this},Node.prototype.removeFromParent=function(cleanup){return this._parent?(this._parent.removeChild(this,cleanup),cleanup&&this.cleanup(),this):void cc.Debug.warn(cc.locale.NODE_WARN_REMOVEFROMPARENT_WITH_NO_PARENT)},Node.prototype.removeAllChildren=function(){for(var i=0;i<this._children.length;i++)this._children[i]._parent=null;return this._children=[],this},Node.prototype.getChildren=function(){return this._children},Node.prototype.getRootNode=function(){for(var node=this;node._parent;)node=node._parent;return node},Node.prototype.enumerateChildren=function(patternName,callback){if("string"==typeof patternName){var node=this,recursive=!1;for(0===patternName.indexOf("//")&&(recursive=!0,patternName=patternName.substr(2),node=this.getRootNode()),-1!==patternName.indexOf("//")&&cc.Debug.error(cc.locale.MSG_WRONG_ENUMERATE_PATTERN),patternName=cc.util.fromPosixRegularExpression(patternName);0===patternName.indexOf("/");)node=this.getRootNode(),patternName=patternName.substr(1);for(var orgPatternData=[],patterns=patternName.split("/"),i=0;i<patterns.length;i++){var pattern=patterns[i];"*"===pattern&&(pattern=".*"),orgPatternData.push(new RegExp(pattern))}node.__enumerateChildrenImpl(orgPatternData,orgPatternData,callback,recursive)}},Node.prototype.__enumerateChildrenImpl=function(orgPatternData,patternData,callback,recursive){if(!patternData.length)return callback(this),void(recursive&&this.__enumerateChildrenImpl(orgPatternData,orgPatternData,callback,recursive));if("/../"===patternData[0].toString())return void(this._parent?this._parent.__enumerateChildrenImpl(orgPatternData,patternData.slice(1,patternData.length),callback,recursive):cc.Debug.error(cc.locale.MSG_ENUMERATE_UNDERFLOW));for(var i=0;i<this._children.length;i++){var child=this._children[i];patternData[0].test(child._name)?child.__enumerateChildrenImpl(orgPatternData,patternData.slice(1,patternData.length),callback,recursive):recursive&&child.__enumerateChildrenImpl(orgPatternData,orgPatternData,callback,recursive)}},Node.prototype.draw=function(ctx){this._color!==DEFAULT_COLOR&&(ctx.globalAlpha=this._frameAlpha,ctx.setTintColor(cc.math.Color.WHITE),ctx.setFillStyleColor(this._color),ctx.fillRect(0,0,this._contentSize.width,this._contentSize.height))},Node.prototype.setName=function(name){return/[A-Za-z0-9_]+/.test(name)||cc.Debug.error(cc.locale.ERR_NODE_NAME_INVALID),this._name=name,this},Node.prototype.startActionChain=function(){return new cc.action.ActionChainContext(this)},Node.prototype.runAction=function(action){return this._scene?this._scene.scheduleActionForNode(this,action):this._actionsToSchedule.push(action),this},Node.prototype.stopActionByTag=function(tag){return this._scene&&this._scene.stopNodeActionByTag(this,tag),this},Node.prototype.stopAllActions=function(){return this._scene?this._scene.stopActionsForNode(this):this._actionsToSchedule=[],this},Node.prototype.setScene=function(scene){if(scene){this._scene=scene;for(var i=0;i<this._actionsToSchedule.length;i++)scene.scheduleActionForNode(this,this._actionsToSchedule[i]);this._actionsToSchedule=[];for(var i=0;i<this._tasksToSchedule.length;i++)scene.scheduleTask(this._tasksToSchedule[i]);this._tasksToSchedule=[],this.__isFlagSet(64)&&(this.__clearFlag(64),this._scene.enableEventsForNode(this)),this.__isFlagSet(128)&&(this.__clearFlag(128),this._scene.enablePriorityEventsForNode(this));for(var i=0;i<this._children.length;i++)this._children[i].setScene(scene)}},Node.prototype.enableEvents=function(){return this._scene?this._scene.enableEventsForNode(this):this.__setFlag(64),this},Node.prototype.enablePriorityEvents=function(enable,priority){return this._inputEvents.priorityEventValue=priority,this._scene?this._scene.enablePriorityEventsForNode(this):this.__setFlag(128),this},Node.prototype.getInputPriority=function(){return this._inputEvents.priorityEventValue},Node.prototype.setVisible=function(v){v!==this.__isFlagSet(8)&&(v?this.__setFlag(8):this.__clearFlag(8),this.__setFlag(2))},Node.prototype.isVisible=function(){return this.__isFlagSet(8)},Node.prototype.cleanup=function(){this.stopAllActions(),this.unscheduleAllCallbacks();for(var i=0;i<this._children.length;i++)this._children[i].cleanup()},Node.prototype.update=function(){},Node.prototype.scheduleUpdateWithPriority=function(priority){var task=cc.action.SchedulerQueue.createSchedulerTask(this,this.update,0,Number.MAX_VALUE,0);task._priority=priority,this.__scheduleImpl(task)},Node.prototype.scheduleUpdate=function(){var task=cc.action.SchedulerQueue.createSchedulerTask(this,this.update,0,Number.MAX_VALUE,0);this.__scheduleImpl(task)},Node.prototype.__scheduleImpl=function(task){this._scene?this._scene.scheduleTask(task):this._tasksToSchedule.push(task)},Node.prototype.unscheduleUpate=function(){this._scene&&this._scene.unscheduleCallbackForTarget(this,this.update)},Node.prototype.schedule=function(callback_fn,interval,repeat,delay){var task=cc.action.SchedulerQueue.createSchedulerTask(this,callback_fn,interval,repeat,delay);this._scene?this._scene.scheduleTask(task):this._tasksToSchedule.push(task)},Node.prototype.scheduleOnce=function(callback_fn,delay){this.schedule(callback_fn,0,0,delay)},Node.prototype.unschedule=function(callback_fn){callback_fn&&this._scene&&this._scene.unscheduleCallbackForTarget(this,callback_fn)},Node.prototype.unscheduleAllCallbacks=function(){this._scene?this._scene.unscheduleAllCallbacks(this):this._tasksToSchedule=[]},Node.prototype.resume=function(){this._scene&&this._scene.resumeTarget(this)},Node.prototype.pause=function(){this._scene&&this._scene.pauseTarget(this)},Node.prototype.setBlendFunc=function(src_o,dst){cc.Debug.warn(cc.locale.WARN_DEPRECATED_SETBLENDFUNC);var src;"undefined"==typeof dst?(dst=src_o.dst,src=src_o.src):src=src_o,this.setCompositeOperation(src===cc.SRC_ALPHA&&dst===cc.ONE?11:src===cc.ONE&&dst===cc.ONE?14:src===cc.ZERO&&dst===cc.SRC_ALPHA?5:src===cc.ZERO&&dst===cc.ONE_MINUS_SRC_ALPHA?6:0)},Node.prototype.attr=function(properties){for(var property in properties)if(properties.hasOwnProperty(property)){var value=properties[property];this[property]=value}return this},Object.defineProperty(Node.prototype,"width",{get:function(){return this._contentSize.width},set:function(v){this._contentSize.width=v,this.__setFlag(4)},enumerable:!0,configurable:!0}),Object.defineProperty(Node.prototype,"height",{get:function(){return this._contentSize.height},set:function(v){this._contentSize.height=v,this.__setFlag(4)},enumerable:!0,configurable:!0}),Object.defineProperty(Node.prototype,"color",{set:function(v){this.setColor(v._color[0],v._color[1],v._color[2])},enumerable:!0,configurable:!0}),Object.defineProperty(Node.prototype,"rotation",{get:function(){return this.rotationAngle},set:function(angle_in_deg){this.rotationAngle=angle_in_deg},enumerable:!0,configurable:!0}),Object.defineProperty(Node.prototype,"visible",{get:function(){return this.isVisible()},set:function(v){this.setVisible(v)},enumerable:!0,configurable:!0}),Object.defineProperty(Node.prototype,"anchorX",{set:function(a){this._positionAnchor.x=a,this._transformationAnchor.x=a,this.__setFlag(4)},enumerable:!0,configurable:!0}),Object.defineProperty(Node.prototype,"anchorY",{set:function(a){this._positionAnchor.y=a,this._transformationAnchor.y=a,this.__setFlag(4)},enumerable:!0,configurable:!0}),Object.defineProperty(Node.prototype,"scale",{set:function(s){this.scaleX=s,this.scaleY=s},enumerable:!0,configurable:!0}),Object.defineProperty(Node.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(Node.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Node}());_node.Node=Node}(node=cc.node||(cc.node={}))}(cc||(cc={}));var cc;!function(cc){var action;!function(_action){function setTimeReferenceInSeconds(){cc.action.TIMEUNITS=SECONDS}function setTimeReferenceInMillis(){cc.action.TIMEUNITS=MILLISECONDS}_action.TIMEUNITS=1e3;var SECONDS=1e3,MILLISECONDS=1;_action.setTimeReferenceInSeconds=setTimeReferenceInSeconds,_action.setTimeReferenceInMillis=setTimeReferenceInMillis,function(ActionStates){ActionStates[ActionStates.PAUSED=1]="PAUSED",ActionStates[ActionStates.RUNNING=2]="RUNNING",ActionStates[ActionStates.CREATED=3]="CREATED",ActionStates[ActionStates.ENDED=4]="ENDED",ActionStates[ActionStates.RESUMED=5]="RESUMED"}(_action.ActionStates||(_action.ActionStates={}));var Action=(_action.ActionStates,function(){function Action(initializer){this._startTime=0,this._duration=0,this._currentTime=0,this._repeatTimes=1,this._currentRepeatCount=0,this._speed=1,this._tag=Action.DEFAULT_TAG,this._status=3,this._onStart=null,this._onEnd=null,this._onRepeat=null,this._onApply=null,this._onPause=null,this._onResume=null,this._interpolator=null,this._fromValuesSet=!1,this._firstExecution=!0,this._delayAfterApplication=0,this._delayBeforeApplication=0,this._chainAction=null,this._relativeAction=!1,this._reversedTime=!1,this._parentSequence=null,this._reversed=!1,this._chainContext=null,initializer&&this.__createFromInitializer(initializer)}return Action.prototype.__createFromInitializer=function(initializer){"undefined"!=typeof initializer&&("undefined"!=typeof initializer.relative&&this.setRelative(initializer.relative),"undefined"!=typeof initializer.duration&&this.setDuration(initializer.duration),"undefined"!=typeof initializer.delayBefore&&this.setDelay(initializer.delayBefore),"undefined"!=typeof initializer.delayAfter&&this.setDelayAfterApplication(initializer.delayAfter),"undefined"!=typeof initializer.interpolator&&this.setInterpolator(cc.action.ParseInterpolator(initializer.interpolator)),"undefined"!=typeof initializer.from&&this.from&&this.from(initializer.from),"undefined"!=typeof initializer.to&&this.to&&this.to(initializer.to),"undefined"!=typeof initializer.repeatTimes&&this.setRepeatTimes(initializer.repeatTimes),"undefined"!=typeof initializer.reversed&&(this._reversed=initializer.reversed))},Action.prototype.setTag=function(tag){return this._tag=tag,this},Action.prototype.update=function(){},Action.prototype.setDuration=function(duration){return this._duration=duration*_action.TIMEUNITS,this.__updateDuration(),this},Action.prototype.setDelay=function(d){return this._delayBeforeApplication=d*_action.TIMEUNITS,this.__updateDuration(),this},Action.prototype.__updateDuration=function(){this._startTime=this._delayBeforeApplication+(this._chainAction?this._chainAction._startTime+this._chainAction.getDuration():0),this._parentSequence&&this._parentSequence.__updateDuration()},Action.prototype.restart=function(){return this._firstExecution=!0,this._currentRepeatCount=0,this._status=3,this._currentTime=0,this},Action.prototype.getStatus=function(){return this._status},Action.prototype.getSpeed=function(){return this._speed},Action.prototype.setSpeed=function(speed){return this._speed=speed,this},Action.prototype.setRepeatTimes=function(repeatTimes,obj){return this._repeatTimes=repeatTimes,this._delayAfterApplication=obj&&obj.withDelay*_action.TIMEUNITS||0,this},Action.prototype.setRepeatForever=function(obj){return this.setRepeatTimes(Number.MAX_VALUE,obj)},Action.prototype.repeatForever=function(){return this.setRepeatForever()},Action.prototype.onStart=function(callback){return this._onStart=callback,this},Action.prototype.onEnd=function(callback){return this._onEnd=callback,this},Action.prototype.onRepeat=function(callback){return this._onRepeat=callback,this},Action.prototype.onApply=function(callback){return this._onApply=callback,this},Action.prototype.onPause=function(callback){return this._onPause=callback,this},Action.prototype.onResume=function(callback){return this._onResume=callback,this},Action.prototype.pause=function(target){return this._status=1,this._onPause&&this._onPause(this,target),this},Action.prototype.resume=function(){return 1===this._status&&(this._status=5),this},Action.prototype.getDelayAfterApplication=function(){return this._delayAfterApplication},Action.prototype.setDelayAfterApplication=function(d){return this._delayAfterApplication=d*_action.TIMEUNITS,this},Action.prototype.getDelay=function(){return this._startTime},Action.prototype.setInterpolator=function(interpolator){return this._interpolator=interpolator,this},Action.prototype.__normalizeTime=function(time){return time<this._startTime?time=0:(time-=this._startTime,time>=this.getDuration()?time=1:(time%=this.getOneRepetitionDuration(),time<this._duration?time/=this._duration:time=1)),this._reversedTime&&(time=1-time),this._interpolator?this._interpolator(time):time},Action.prototype.getDuration=function(){return this.getOneRepetitionDuration()*this._repeatTimes},Action.prototype.getOneRepetitionDuration=function(){return this._duration+this._delayAfterApplication},Action.prototype.__isActionApplicable=function(time){return 1===this._status||4===this._status?!1:this._repeatTimes===Number.MAX_VALUE||time>=this._startTime&&time<this._startTime+this.getDuration()},Action.prototype.step=function(delta,target){delta*=cc.action.TIMEUNITS,this._currentTime+=delta*this._speed,this.__stepImpl(delta,this._currentTime,target)},Action.prototype.__stepImpl=function(delta,time,target){4!==this._status&&(5===this._status&&this._onResume&&this._onResume(this,target),this.__isActionApplicable(time)?this.__actionApply(time,target):time>=this._startTime+this.getDuration()&&(this.__actionApply(time,target),this.stop(target)))},Action.prototype.__actionApply=function(time,target){this._firstExecution&&(this._onStart&&this._onStart(this,target),this._firstExecution=!1,this.initWithTarget(target)),this._status=2;var ntime=this.__normalizeTime(time),v=this.update(ntime,target);this._onApply&&this._onApply(this,target,v),this.__checkRepetition(time,target)},Action.prototype.__checkRepetition=function(time,target){if(1!==this._repeatTimes){var repeatIndex=(time-this._startTime)/this.getOneRepetitionDuration()>>0;repeatIndex!==this._currentRepeatCount&&(repeatIndex>this._repeatTimes&&(repeatIndex=this._repeatTimes),this._currentRepeatCount=repeatIndex,this._onRepeat&&this._onRepeat(this,target,repeatIndex))}},Action.prototype.initWithTarget=function(){},Action.prototype.solveInitialValues=function(){},Action.prototype.stop=function(target){this._status=4,this._onEnd&&this._onEnd(this,target)},Action.prototype.isFinished=function(){return 4===this._status},Action.prototype.isPaused=function(){return 1===this._status},Action.prototype.from=function(){return this._fromValuesSet=!0,this},Action.prototype.to=function(){return this},Action.prototype.timeInfo=function(delay,duration,interpolator){return this._duration=duration*_action.TIMEUNITS,this.setDelay(delay),"undefined"!=typeof interpolator&&(this._interpolator=interpolator),this},Action.prototype.setRelative=function(relative){return this._relativeAction=relative,this},Action.prototype.reverse=function(){return this.createReversed()},Action.prototype.createReversed=function(){var action=this.clone();return action.setReversed()},Action.prototype.setReversed=function(){return this._reversed=!this._reversed,this._interpolator=this._interpolator?this._interpolator.reverse():_action.Interpolator.Linear(!0,!1),this},Action.prototype.__cloneImpl=function(){var copy=new Action;return this.__genericCloneProperties(copy),copy},Action.prototype.clone=function(){return this.__cloneImpl()},Action.prototype.isRelative=function(){return this._relativeAction},Action.prototype.__genericCloneProperties=function(copy){copy.setInterpolator(this._interpolator).setReversedTime(this._reversedTime).setSpeed(this.getSpeed()).setRepeatTimes(this._repeatTimes).setRelative(this._relativeAction),copy._startTime=this._startTime,copy._duration=this._duration,copy._delayAfterApplication=this._delayAfterApplication,copy._onStart=this._onStart,copy._onEnd=this._onEnd,copy._onApply=this._onApply,copy._onRepeat=this._onRepeat,copy._onPause=this._onPause,copy._onResume=this._onResume,copy._reversed=this._reversed},Action.prototype.easing=function(i){return this.setInterpolator(i),this},Action.prototype.speed=function(speed){return this._speed*=speed,this},Action.prototype.isReversedTime=function(){return this._reversedTime},Action.prototype.setReversedTime=function(b){return this._reversedTime=b,this},Action.prototype.__recursivelySetCreatedStatus=function(target){4!==this._status&&this.update(this._reversed?0:1,target),this._currentTime=0,this._status=3,this._firstExecution=!0},Action.prototype.pingpong=function(){this.setInterpolator(cc.action.Interpolator.Linear(this._reversed,!0))},Action.prototype.getInitializer=function(){var obj={};return this._delayBeforeApplication&&(obj.delayBefore=this._delayBeforeApplication/cc.action.TIMEUNITS),this._delayAfterApplication&&(obj.delayAfter=this._delayAfterApplication/cc.action.TIMEUNITS),obj.duration=this._duration/cc.action.TIMEUNITS,obj.relative=this._relativeAction,1!==this._repeatTimes&&(obj.repeatTimes=this._repeatTimes),this._interpolator&&(obj.interpolator=this._interpolator.getInitializer()),obj.reversed=this._reversed,obj},Action.DEFAULT_TAG="",Action}());_action.Action=Action}(action=cc.action||(cc.action={}))}(cc||(cc={}));var cc;!function(cc){var action;!function(action){function ParseInterpolator(ii){return"EaseIn"===ii.type||"EaseOut"===ii.type||"EaseInOut"===ii.type?cc.action.Interpolator[ii.type](ii.exponent,ii.inverse,ii.pingpong):"ElasticIn"===ii.type||"ElasticOut"===ii.type||"ElasticInOut"===ii.type?cc.action.Interpolator[ii.type](ii.period,ii.inverse,ii.pingpong):cc.action.Interpolator[ii.type](ii.inverse,ii.pingpong)}function calcTime(time,inverse,pingpong){return pingpong&&(.5>time?time*=2:time=1-2*(time-.5)),inverse&&(time=1-time),time}function bounceTime(time1){return 1/2.75>time1?7.5625*time1*time1:2/2.75>time1?(time1-=1.5/2.75,7.5625*time1*time1+.75):2.5/2.75>time1?(time1-=2.25/2.75,7.5625*time1*time1+.9375):(time1-=2.625/2.75,7.5625*time1*time1+.984375)}action.ParseInterpolator=ParseInterpolator;var Interpolator=function(){function Interpolator(){}return Interpolator.Linear=function(inverse,pingpong){var fn=function(time){return calcTime(time,inverse,pingpong)};return fn.reverse=function(){return Interpolator.Linear(!inverse,pingpong)},fn.getInitializer=function(){return{type:"Linear",inverse:inverse,pingpong:pingpong}},fn},Interpolator.EaseIn=function(exponent,inverse,pingpong){var fn=function(time){return Math.pow(calcTime(time,inverse,pingpong),exponent)};return fn.reverse=function(){return Interpolator.EaseIn(exponent,!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseIn",inverse:inverse,pingpong:pingpong,exponent:exponent}},fn},Interpolator.EaseOut=function(exponent,inverse,pingpong){var fn=function(time){return 1-Math.pow(1-calcTime(time,inverse,pingpong),exponent)};return fn.reverse=function(){return Interpolator.EaseOut(exponent,!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseOut",inverse:inverse,pingpong:pingpong,exponent:exponent}},fn},Interpolator.EaseInOut=function(exponent,inverse,pingpong){var fn=function(time){return time=calcTime(time,inverse,pingpong),1>2*time?Math.pow(2*time,exponent)/2:1-Math.abs(Math.pow(2*time-2,exponent))/2};return fn.reverse=function(){return Interpolator.EaseInOut(exponent,!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseInOut",inverse:inverse,pingpong:pingpong,exponent:exponent}},fn},Interpolator.EaseExponentialIn=function(inverse,pingpong){var fn=function(time){return time=calcTime(time,inverse,pingpong),0===time?0:Math.pow(2,10*(time-1))};return fn.reverse=function(){return Interpolator.EaseExponentialIn(!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseExponentialIn",inverse:inverse,pingpong:pingpong}},fn},Interpolator.EaseExponentialOut=function(inverse,pingpong){var fn=function(time){return time=calcTime(time,inverse,pingpong),1===time?1:1-Math.pow(2,-10*time)};return fn.reverse=function(){return Interpolator.EaseExponentialOut(!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseExponentialOut",inverse:inverse,pingpong:pingpong}},fn},Interpolator.EaseExponentialInOut=function(inverse,pingpong){var fn=function(time){var dt=calcTime(time,inverse,pingpong);return dt*=2,1>dt?.5*Math.pow(2,10*(dt-1)):.5*(-Math.pow(2,-10*(dt-1))+2)};return fn.reverse=function(){return Interpolator.EaseExponentialInOut(!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseExponentialInOut",inverse:inverse,pingpong:pingpong}},fn},Interpolator.EaseSineIn=function(inverse,pingpong){var fn=function(time){return time=calcTime(time,inverse,pingpong),0===time||1===time?time:1-Math.cos(time*Math.PI/2)};return fn.reverse=function(){return Interpolator.EaseSineIn(!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseSineIn",inverse:inverse,pingpong:pingpong}},fn},Interpolator.EaseSineOut=function(inverse,pingpong){var fn=function(time){return time=calcTime(time,inverse,pingpong),1===time||0===time?time:Math.sin(time*Math.PI/2)};return fn.reverse=function(){return Interpolator.EaseSineOut(!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseSineOut",inverse:inverse,pingpong:pingpong}},fn},Interpolator.EaseSineInOut=function(inverse,pingpong){var fn=function(time){var dt=calcTime(time,inverse,pingpong);return 0===dt||1===dt?dt:-.5*(Math.cos(Math.PI*dt)-1)};return fn.reverse=function(){return Interpolator.EaseSineInOut(!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseSineInOut",inverse:inverse,pingpong:pingpong}},fn},Interpolator.EaseElasticIn=function(period,inverse,pingpong){var fn=function(time){period="undefined"==typeof period?.3:period;var dt=calcTime(time,inverse,pingpong);if(0===dt||1===dt)return dt;var s=period/4;return dt-=1,-Math.pow(2,10*dt)*Math.sin((dt-s)*Math.PI*2/period)};return fn.reverse=function(){return Interpolator.EaseElasticIn(period,!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseElasticIn",inverse:inverse,pingpong:pingpong,period:period}},fn},Interpolator.EaseElasticOut=function(period,inverse,pingpong){var fn=function(time){period="undefined"==typeof period?.3:period;var dt=calcTime(time,inverse,pingpong);if(0===dt||1==dt)return dt;var s=period/4;return Math.pow(2,-10*dt)*Math.sin((dt-s)*Math.PI*2/period)+1};return fn.reverse=function(){return Interpolator.EaseElasticOut(period,!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseElasticOut",inverse:inverse,pingpong:pingpong,period:period}},fn},Interpolator.EaseElasticInOut=function(period,inverse,pingpong){var fn=function(time){period="undefined"==typeof period?.3:period;var dt=calcTime(time,inverse,pingpong);if(0===dt||1==dt)return dt;dt=2*dt;var s=period/4;return dt-=1,0>dt?-.5*Math.pow(2,10*dt)*Math.sin((dt-s)*Math.PI*2/period):Math.pow(2,-10*dt)*Math.sin((dt-s)*Math.PI*2/period)*.5+1};return fn.reverse=function(){return Interpolator.EaseElasticInOut(period,!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseElasticInOut",inverse:inverse,pingpong:pingpong,period:period}},fn},Interpolator.EaseBounceIn=function(inverse,pingpong){var fn=function(time){var dt=calcTime(time,inverse,pingpong);return 1-bounceTime(1-dt)};return fn.reverse=function(){return Interpolator.EaseBounceIn(!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseBounceIn",inverse:inverse,pingpong:pingpong}},fn},Interpolator.EaseBounceOut=function(inverse,pingpong){var fn=function(time){return bounceTime(calcTime(time,inverse,pingpong))};return fn.reverse=function(){return Interpolator.EaseBounceOut(!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseBounceOut",inverse:inverse,pingpong:pingpong}},fn},Interpolator.EaseBounceInOut=function(inverse,pingpong){var fn=function(time){var dt=calcTime(time,inverse,pingpong);return.5>dt?(dt=2*dt,.5*(1-bounceTime(1-dt))):.5*bounceTime(2*dt-1)+.5};return fn.reverse=function(){return Interpolator.EaseBounceInOut(!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseBounceInOut",inverse:inverse,pingpong:pingpong}},fn},Interpolator.EaseBackIn=function(inverse,pingpong){var fn=function(time){var dt=calcTime(time,inverse,pingpong),overshoot=1.70158;return 0===dt||1===dt?dt:dt*dt*((overshoot+1)*dt-overshoot)};return fn.reverse=function(){return Interpolator.EaseBackIn(!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseBackIn",inverse:inverse,pingpong:pingpong}},fn},Interpolator.EaseBackOut=function(inverse,pingpong){var fn=function(time){var dt=calcTime(time,inverse,pingpong),overshoot=1.70158;return dt-=1,1+dt*dt*((overshoot+1)*dt+overshoot)};return fn.reverse=function(){return Interpolator.EaseBackOut(!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseBackOut",inverse:inverse,pingpong:pingpong}},fn},Interpolator.EaseBackInOut=function(inverse,pingpong){var fn=function(time){var dt=calcTime(time,inverse,pingpong),overshoot=1.70158;return dt=2*dt,1>dt?dt*dt*((overshoot+1)*dt-overshoot)/2:(dt-=2,1+dt*dt*((overshoot+1)*dt+overshoot)/2)};return fn.reverse=function(){return Interpolator.EaseBackInOut(!inverse,pingpong)},fn.getInitializer=function(){return{type:"EaseBackInOut",inverse:inverse,pingpong:pingpong}},fn},Interpolator}();action.Interpolator=Interpolator}(action=cc.action||(cc.action={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var action;!function(action){var Action=cc.action.Action,AlphaAction=function(_super){function AlphaAction(data){_super.call(this),this._originalAlpha=0,this._startAlpha=0,this._endAlpha=0,data&&this.__createFromInitializer(data)}return __extends(AlphaAction,_super),AlphaAction.prototype.__createFromInitializer=function(data){_super.prototype.__createFromInitializer.call(this,data),"undefined"!=typeof data&&(this._startAlpha=data.to,this._endAlpha=data.from)},AlphaAction.prototype.update=function(delta,node){var r=this._startAlpha+delta*(this._endAlpha-this._startAlpha);return this._relativeAction&&(r+=this._originalAlpha,this._reversed&&(r-=this._endAlpha)),node._alpha=r,r},AlphaAction.prototype.solveInitialValues=function(node){this._relativeAction&&!this._fromValuesSet?this._startAlpha=0:this._fromValuesSet||(this._startAlpha=node._alpha)},AlphaAction.prototype.initWithTarget=function(node){this._originalAlpha=node._alpha,this.solveInitialValues(node)},AlphaAction.prototype.from=function(alpha){return _super.prototype.from.call(this,alpha),this._startAlpha=alpha,this},AlphaAction.prototype.to=function(alpha){return this._endAlpha=alpha,this},AlphaAction.prototype.__cloneImpl=function(){var copy=new AlphaAction;return copy.to(this._endAlpha),this._fromValuesSet&&copy.from(this._startAlpha),copy._originalAlpha=this._originalAlpha,this.__genericCloneProperties(copy),copy},AlphaAction.prototype.getInitializer=function(){var init=_super.prototype.getInitializer.call(this);return this._fromValuesSet&&(init.from=this._startAlpha),init.to=this._endAlpha,init.type="AlphaAction",init},AlphaAction}(Action);action.AlphaAction=AlphaAction}(action=cc.action||(cc.action={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var action;!function(action){var Action=cc.action.Action,__moveActionUpdateValue={x:0,y:0},MoveAction=function(_super){function MoveAction(data){_super.call(this),this._originalX=0,this._originalY=0,this._x0=0,this._y0=0,this._x1=0,this._y1=0,data&&this.__createFromInitializer(data)}return __extends(MoveAction,_super),MoveAction.prototype.__createFromInitializer=function(initializer){_super.prototype.__createFromInitializer.call(this,initializer)},MoveAction.prototype.update=function(delta,node){var x=this._x0+delta*(this._x1-this._x0),y=this._y0+delta*(this._y1-this._y0);return this._relativeAction&&(x+=this._originalX,y+=this._originalY,this._reversed&&(x-=this._x1,y-=this._y1)),node.setPosition(x,y),__moveActionUpdateValue.x=x,__moveActionUpdateValue.y=y,__moveActionUpdateValue},MoveAction.prototype.solveInitialValues=function(node){this._relativeAction&&!this._fromValuesSet?(this._x0=0,this._y0=0):this._fromValuesSet||(this._x0=node.x,this._y0=node.y)},MoveAction.prototype.initWithTarget=function(node){this._originalX=node.x,this._originalY=node.y,this.solveInitialValues(node)},MoveAction.prototype.from=function(point){return _super.prototype.from.call(this,point),this._x0=point.x,this._y0=point.y,this},MoveAction.prototype.to=function(point){return this._x1=point.x,this._y1=point.y,this},MoveAction.prototype.__cloneImpl=function(){var copy=(new MoveAction).to({x:this._x1,y:this._y1});return this._fromValuesSet&&copy.from({x:this._x0,y:this._y0}),this.__genericCloneProperties(copy),copy},MoveAction.prototype.getInitializer=function(){var init=_super.prototype.getInitializer.call(this);return this._fromValuesSet&&(init.from={x:this._x0,y:this._y0}),init.to={x:this._x1,y:this._y1},init.type="MoveAction",init},MoveAction}(Action);action.MoveAction=MoveAction}(action=cc.action||(cc.action={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var action;!function(action){var Action=cc.action.Action,PropertyInfo=function(){function PropertyInfo(_property,_start,_end){this._property=_property,this._start=_start,this._end=_end,this._units="",this._nested=!1,this._nested=-1!==_property.indexOf("."),this._propertyPath=_property.split(".")}return PropertyInfo.prototype.setTargetValue=function(target,v){for(var cursor=target,i=0;i<this._propertyPath.length-1;i++){if("undefined"==typeof cursor[this._propertyPath[i]])return;cursor=cursor[this._propertyPath[i]]}cursor[this._propertyPath[i]]=v},PropertyInfo.prototype.getTargetValue=function(target){for(var cursor=target,i=0;i<this._propertyPath.length;i++){if("undefined"==typeof cursor[this._propertyPath[i]])return null;cursor=cursor[this._propertyPath[i]]}return cursor},PropertyInfo.prototype.setOriginal=function(n){return this._original=n,this},PropertyInfo.prototype.getOriginal=function(){return this._original},PropertyInfo.prototype.clone=function(){return new PropertyInfo(this._property,this._start,this._end)},PropertyInfo.prototype.getPath=function(){return this._propertyPath},PropertyInfo}();action.PropertyInfo=PropertyInfo;var PropertyAction=function(_super){function PropertyAction(data){_super.call(this),this._propertiesInfo=[],data&&this.__createFromInitializer(data)}return __extends(PropertyAction,_super),PropertyAction.prototype.__createFromInitializer=function(initializer){_super.prototype.__createFromInitializer.call(this,initializer)},PropertyAction.prototype.initWithTarget=function(node){this.solveInitialValues(node)},PropertyAction.prototype.update=function(delta,node){for(var ret={},i=0;i<this._propertiesInfo.length;i++){var pr=this._propertiesInfo[i],v=pr._start+delta*(pr._end-pr._start);this.isRelative()&&(v+=pr.getOriginal()),pr.setTargetValue(node,v),this._onApply&&(ret[pr._property]=v)}return ret},PropertyAction.prototype.solveInitialValues=function(node){for(var i=0;i<this._propertiesInfo.length;i++){var pr=this._propertiesInfo[i];"undefined"==typeof pr._start&&(pr._start=pr.getTargetValue(node)),"undefined"==typeof pr._end&&(pr._end=pr.getTargetValue(node)),pr._original=pr.getTargetValue(node)}},PropertyAction.prototype.from=function(props){if(this._from=props,props)for(var pr in props)if(props.hasOwnProperty(pr)){var propertyInfo=new PropertyInfo(pr,props[pr]);this._propertiesInfo.push(propertyInfo)}return this},PropertyAction.prototype.to=function(props){this._to=props;
var i;for(var pr in props)if(props.hasOwnProperty(pr)){var property=null;for(i=0;i<this._propertiesInfo.length;i++)if(this._propertiesInfo[i]._property===pr){property=this._propertiesInfo[i];break}property||(property=new PropertyInfo(pr),this._propertiesInfo.push(property)),property._end=props[pr]}return this},PropertyAction.prototype.__cloneProperties=function(){for(var pr=[],i=0;i<this._propertiesInfo.length;i++)pr.push(this._propertiesInfo[i].clone());return pr},PropertyAction.prototype.__cloneImpl=function(){var copy=(new PropertyAction).to(this.__cloneProperties());return this.__genericCloneProperties(copy),copy},PropertyAction.prototype.getInitializer=function(){var init=_super.prototype.getInitializer.call(this);return this._fromValuesSet&&(init.from=this._from),init.to=this._to,init.type="PropertyAction",init},PropertyAction}(Action);action.PropertyAction=PropertyAction}(action=cc.action||(cc.action={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var action;!function(action){var Action=cc.action.Action,RotateAction=function(_super){function RotateAction(data){_super.call(this),this._originalAngle=0,this._startAngle=0,this._endAngle=360,data&&this.__createFromInitializer(data)}return __extends(RotateAction,_super),RotateAction.prototype.__createFromInitializer=function(initializer){_super.prototype.__createFromInitializer.call(this,initializer)},RotateAction.prototype.update=function(delta,node){var r=this._startAngle+delta*(this._endAngle-this._startAngle);return this._relativeAction&&(r+=this._originalAngle,this._reversed&&(r-=this._endAngle)),node.rotationAngle=r,r},RotateAction.prototype.solveInitialValues=function(node){this._relativeAction&&!this._fromValuesSet?(this._startAngle=0,this._startAngle===this._endAngle&&(this._startAngle=this._originalAngle,this._originalAngle=0)):this._fromValuesSet||(this._startAngle=node.rotationAngle)},RotateAction.prototype.initWithTarget=function(node){this._originalAngle=node.rotationAngle,this.solveInitialValues(node)},RotateAction.prototype.from=function(angle){return _super.prototype.from.call(this,angle),this._startAngle=angle,this},RotateAction.prototype.to=function(angle){return this._endAngle=angle,this},RotateAction.prototype.__cloneImpl=function(){var copy=(new RotateAction).to(this._endAngle);return this._fromValuesSet&&copy.from(this._startAngle),this.__genericCloneProperties(copy),copy},RotateAction.prototype.getInitializer=function(){var init=_super.prototype.getInitializer.call(this);return this._fromValuesSet&&(init.from=this._startAngle),init.to=this._endAngle,init.type="RotateAction",init},RotateAction}(Action);action.RotateAction=RotateAction}(action=cc.action||(cc.action={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var action;!function(action){var Vector=cc.math.Vector,Action=cc.action.Action,__scaleActionUpdateValue=new Vector,ScaleAction=function(_super){function ScaleAction(data){_super.call(this),this._originalScaleX=1,this._originalScaleY=1,this._scaleX0=1,this._scaleY0=1,this._scaleX1=1,this._scaleY1=1,data&&this.__createFromInitializer(data)}return __extends(ScaleAction,_super),ScaleAction.prototype.__createFromInitializer=function(initializer){_super.prototype.__createFromInitializer.call(this,initializer)},ScaleAction.prototype.update=function(delta,node){var x=this._scaleX0+delta*(this._scaleX1-this._scaleX0),y=this._scaleY0+delta*(this._scaleY1-this._scaleY0);return this._relativeAction&&(x+=this._originalScaleX,y+=this._originalScaleY,this._reversed&&(x-=this._scaleX1,y-=this._scaleY1)),node.setScale(x,y),__scaleActionUpdateValue.set(x,y)},ScaleAction.prototype.solveInitialValues=function(node){this._relativeAction&&!this._fromValuesSet?(this._scaleX0=0,this._scaleY0=0):this._fromValuesSet||(this._scaleX0=node.scaleX,this._scaleY0=node.scaleY)},ScaleAction.prototype.initWithTarget=function(node){this._originalScaleX=node.scaleX,this._originalScaleY=node.scaleY,this.solveInitialValues(node)},ScaleAction.prototype.from=function(point){return _super.prototype.from.call(this,point),this._scaleX0=point.x,this._scaleY0=point.y,this},ScaleAction.prototype.to=function(point){return this._scaleX1=point.x,this._scaleY1=point.y,this},ScaleAction.prototype.__cloneImpl=function(){var copy=(new ScaleAction).to({x:this._scaleX1,y:this._scaleY1});return this._fromValuesSet&&copy.from({x:this._scaleX0,y:this._scaleY0}),this.__genericCloneProperties(copy),copy},ScaleAction.prototype.getInitializer=function(){var init=_super.prototype.getInitializer.call(this);return this._fromValuesSet&&(init.from={x:this._scaleX0,y:this._scaleY0}),init.to={x:this._scaleX1,y:this._scaleY1},init.type="ScaleAction",init},ScaleAction}(Action);action.ScaleAction=ScaleAction}(action=cc.action||(cc.action={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var action;!function(_action){var Action=cc.action.Action,SequenceAction=function(_super){function SequenceAction(data){_super.call(this),this._actions=[],this._sequential=!0,this._prevOnRepeat=null,"undefined"!=typeof data&&this.__createFromInitializer(data)}return __extends(SequenceAction,_super),SequenceAction.prototype.__createFromInitializer=function(data){if(_super.prototype.__createFromInitializer.call(this,data),"undefined"!=typeof data.sequential&&(this._sequential=data.sequential),data.actions)for(var i=0;i<data.actions.length;i++)this.addAction(cc.action.ParseAction(data.actions[i]));this._onRepeat=function(action,target,repetitionCount){var seq=action;seq.recursivelySetCreatedStatus(target),seq._prevOnRepeat&&seq._prevOnRepeat(action,target,repetitionCount)}},SequenceAction.prototype.onRepeat=function(callback){return this._prevOnRepeat=callback,this},SequenceAction.prototype.recursivelySetCreatedStatus=function(target){for(var i=0;i<this._actions.length;i++)this._actions[i].__recursivelySetCreatedStatus(target)},SequenceAction.prototype.getLastAction=function(){return 0===this._actions.length?null:this._actions[this._actions.length-1]},SequenceAction.prototype.__recursivelySetCreatedStatus=function(target){for(var i=0;i<this._actions.length;i++)this._actions[i].__recursivelySetCreatedStatus(target);_super.prototype.__recursivelySetCreatedStatus.call(this,target)},SequenceAction.prototype.__updateDuration=function(){if(this._actions){var duration=0;this.__sequentializeStartAndDuration();for(var i=0;i<this._actions.length;i++){var nd=this._actions[i]._startTime+this._actions[i].getDuration();nd>duration&&(duration=nd)}this._duration=duration,_super.prototype.__updateDuration.call(this)}},SequenceAction.prototype.__sequentializeStartAndDuration=function(){var actions=this._actions;if(this._sequential)for(var i=0;i<actions.length;i++){var curr=actions[i];if(i>0){var prev=actions[i-1];curr._startTime=prev.getDuration()+prev._startTime}else curr._startTime=0}},SequenceAction.prototype.addAction=function(a){return this._actions.push(a),a._chainContext=this._chainContext,a._parentSequence=this,this.__updateDuration(),this},SequenceAction.prototype.__stepImpl=function(delta,time,node){if(4!==this._status)if(this.__isActionApplicable(time)){for(var ntime=(time-this._startTime)%this.getOneRepetitionDuration(),i=0;i<this._actions.length;i++){var caction=this._actions[i];caction._currentTime=(caction._currentTime+caction._speed*delta)%this.getOneRepetitionDuration(),caction.__stepImpl(delta,ntime,node)}_super.prototype.__actionApply.call(this,time,node)}else if(time>=this._startTime+this.getDuration()){this._status=4;for(var i=0;i<this._actions.length;i++)this._actions[i]._currentTime=this._actions[i]._currentTime+delta,this._actions[i].__stepImpl(1/cc.action.TIMEUNITS,time,node);this.__actionApply(time,node),this._onEnd&&this._onEnd(this,node)}},SequenceAction.prototype.__actionApply=function(){},SequenceAction.prototype.__cloneImpl=function(){var action=new SequenceAction({sequential:this._sequential});this.__genericCloneProperties(action),action._prevOnRepeat=this._prevOnRepeat,action._duration=0;for(var i=0;i<this._actions.length;i++)action.addAction(this._actions[i].clone());return action},SequenceAction.prototype.getNumActions=function(){return this._actions.length},SequenceAction.prototype.getAction=function(i){return this._actions[i]},SequenceAction.prototype.setReversed=function(){_super.prototype.setReversed.call(this),this._actions=this._actions.reverse();for(var i=0;i<this._actions.length;i++)this._actions[i].setReversed();return this.__sequentializeStartAndDuration(),this},SequenceAction.prototype.setSequential=function(b){this._sequential=b},SequenceAction.prototype.getInitializer=function(){var init=_super.prototype.getInitializer.call(this);init.type="SequenceAction",init.sequential=this._sequential,init.actions=[];for(var i=0;i<this._actions.length;i++)init.actions.push(this._actions[i].getInitializer());return init},SequenceAction}(Action);_action.SequenceAction=SequenceAction}(action=cc.action||(cc.action={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var action;!function(action){var Action=cc.action.Action,__updateRGB={r:1,g:1,b:1},TintAction=function(_super){function TintAction(data){_super.call(this),this._originalColor={r:1,g:1,b:1},this._startColor={r:1,g:1,b:1},this._endColor={r:1,g:1,b:1},data&&this.__createFromInitializer(data)}return __extends(TintAction,_super),TintAction.prototype.__createFromInitializer=function(initializer){_super.prototype.__createFromInitializer.call(this,initializer)},TintAction.prototype.update=function(delta,node){var r=this._startColor.r+delta*(this._endColor.r-this._startColor.r),g=this._startColor.g+delta*(this._endColor.g-this._startColor.g),b=this._startColor.b+delta*(this._endColor.b-this._startColor.b);return this._relativeAction&&(r+=this._originalColor.r,g+=this._originalColor.g,b+=this._originalColor.b,this._reversed&&(r-=this._endColor.r,g-=this._endColor.g,b-=this._endColor.b)),node.setColor(r,g,b),this._onApply&&(__updateRGB.r=r,__updateRGB.g=g,__updateRGB.b=b),__updateRGB},TintAction.prototype.solveInitialValues=function(node){if(this._relativeAction&&!this._fromValuesSet)this._startColor.r=0,this._startColor.g=0,this._startColor.b=0;else{var color=node._color._color;this._startColor.r=color[0],this._startColor.g=color[1],this._startColor.b=color[2]}},TintAction.prototype.initWithTarget=function(node){var color=node._color._color;this._originalColor.r=color[0],this._originalColor.g=color[1],this._originalColor.b=color[2],this.solveInitialValues(node)},TintAction.prototype.from=function(color){return _super.prototype.from.call(this,color),this._startColor={r:color.r,g:color.g,b:color.b},this},TintAction.prototype.to=function(color){return this._endColor={r:color.r,g:color.g,b:color.b},this},TintAction.prototype.__cloneImpl=function(){var copy=new TintAction;return copy.to({r:this._endColor.r,g:this._endColor.g,b:this._endColor.b}),this._fromValuesSet&&copy.from({r:this._startColor.r,g:this._startColor.g,b:this._startColor.b}),this.__genericCloneProperties(copy),copy},TintAction.prototype.getInitializer=function(){var init=_super.prototype.getInitializer.call(this);return this._fromValuesSet&&(init.from={r:this._startColor.r,g:this._startColor.g,b:this._startColor.b}),init.to={r:this._endColor.r,g:this._endColor.g,b:this._endColor.b},init.type="TintAction",init},TintAction}(Action);action.TintAction=TintAction}(action=cc.action||(cc.action={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var action;!function(action){var Action=cc.action.Action,AnimateAction=function(_super){function AnimateAction(data){_super.call(this),this._originalSpriteFrame=null,this._animation=null,data&&(data instanceof cc.node.sprite.Animation?this.setAnimation(data):this.__createFromInitializer(data))}return __extends(AnimateAction,_super),AnimateAction.prototype.__createFromInitializer=function(data){_super.prototype.__createFromInitializer.call(this,data),this.setAnimation(cc.plugin.asset.AssetManager.getAnimationById(data.animationName))},AnimateAction.prototype.setAnimation=function(data){return this._animation=data,this.setDuration(0),this.setRepeatTimes(data._loops),this},AnimateAction.prototype.setDuration=function(){return this._animation&&_super.prototype.setDuration.call(this,this._animation.getDuration()),this},AnimateAction.prototype.update=function(normalizedTime,target){var index=(normalizedTime*this._animation.getSize()|0)%this._animation.getSize();return index>=0&&index<this._animation.getSize()&&target.setSpriteFrame(this._animation.getSpriteFrameAtIndex(index)),index},AnimateAction.prototype.getOneRepetitionDuration=function(){return(this._animation.getDuration()+this._delayAfterApplication)*this._speed*cc.action.TIMEUNITS},AnimateAction.prototype.solveInitialValues=function(){},AnimateAction.prototype.initWithTarget=function(node){this._originalSpriteFrame=node._spriteFrame,this.solveInitialValues(node)},AnimateAction.prototype.to=function(a){return this.setAnimation(a),this},AnimateAction.prototype.__cloneImpl=function(){var copy=new AnimateAction;return copy.to(this._animation.clone()),copy._originalSpriteFrame=this._originalSpriteFrame,this.__genericCloneProperties(copy),copy},AnimateAction.prototype.stop=function(node){_super.prototype.stop.call(this,node),this._animation._restoreOriginalFrame&&node.setSpriteFrame(this._originalSpriteFrame)},AnimateAction.prototype.getInitializer=function(){var init=_super.prototype.getInitializer.call(this);return init.type="AnimateAction",init.animationName=this._animation._name,init},AnimateAction}(Action);action.AnimateAction=AnimateAction}(action=cc.action||(cc.action={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var action;!function(action){var Action=cc.action.Action,__PathActionUpdateValue={x:0,y:0},PathAction=function(_super){function PathAction(data){_super.call(this),this._originalX=0,this._originalY=0,this._segment=null,this._pathAdjusted=!1,this._adjustTangentialRotation=!1,this._tangentialRotationFullAngle=!1,this._spriteOrientationLR=!0,"undefined"!=typeof data&&this.__createFromInitializer(data)}return __extends(PathAction,_super),PathAction.prototype.__createFromInitializer=function(data){_super.prototype.__createFromInitializer.call(this,data),console.log("Path initializer not yet implemented."),this._segment=data.segment},PathAction.prototype.update=function(delta,node){var pos=this._segment.getValueAt(delta),x=pos.x,xx=x,y=pos.y,yy=y;if(x+=this._originalX,y+=this._originalY,this._reversed){var fp=this._segment.getEndingPoint();x-=fp.x,y-=fp.y}if(node.setPosition(x,y),__PathActionUpdateValue.x=x,__PathActionUpdateValue.y=y,node.setFlippedX&&this._adjustTangentialRotation){var delta2=delta-.001;if(delta2>=0){var pos2=this._segment.getValueAt(delta2),angle=Math.PI-Math.atan2(pos2.y-yy,pos2.x-xx);node.rotationAngle=this.__getTangentialAngle(node,xx>pos2.x,angle)}}return __PathActionUpdateValue},PathAction.prototype.__getTangentialAngle=function(node,lefttoright,angle){return this._tangentialRotationFullAngle||(this._spriteOrientationLR?lefttoright?node.setFlippedX(!1):(node.setFlippedX(!0),angle+=Math.PI):lefttoright?(node.setFlippedX(!0),angle-=Math.PI):node.setFlippedX(!1)),180*angle/Math.PI},PathAction.prototype.restart=function(){return _super.prototype.restart.call(this),this._pathAdjusted=!1,this},PathAction.prototype.solveInitialValues=function(node){if(!this.isRelative()&&!this._pathAdjusted){this._pathAdjusted=!0;{this._segment.getControlPoints()}if(this._segment.setDirty(),this._segment.getLength(),this._adjustTangentialRotation&&node.setFlippedX){var pos=this._segment.getValueAt(.001),xx=pos.x,yy=pos.y;pos=this._segment.getValueAt(0);var angle=Math.PI-Math.atan2(pos.y-yy,pos.x-xx);node.rotationAngle=this.__getTangentialAngle(node,xx>pos.x,angle)}}},PathAction.prototype.initWithTarget=function(node){if(this.isRelative())this._originalX=node.x,this._originalY=node.y;else{this._originalX=0,this._originalY=0;var points=this._segment.getControlPoints();points[0].x=node.x,points[0].y=node.y}this.solveInitialValues(node)},PathAction.prototype.from=function(segment){return _super.prototype.from.call(this,segment),this._segment=segment,this},PathAction.prototype.to=function(){return this},PathAction.prototype.__cloneImpl=function(){var copy=new PathAction;return copy._segment=this._segment.clone(),this.__genericCloneProperties(copy),copy},PathAction.prototype.adjustRotation=function(a,fullAngles){return this._adjustTangentialRotation=a,this._tangentialRotationFullAngle="undefined"!=typeof fullAngles?fullAngles:!1,this},PathAction.prototype.setSpriteOrientationIsLeftToRight=function(v){return this._spriteOrientationLR=v,this},PathAction.prototype.getInitializer=function(){var init=_super.prototype.getInitializer.call(this);return init.type="PathAction",init},PathAction}(Action);action.PathAction=PathAction}(action=cc.action||(cc.action={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var action;!function(action){var Action=cc.action.Action,Vector=cc.math.Vector,__v0=new Vector,JumpAction=function(_super){function JumpAction(data){_super.call(this),this._originalX=0,this._originalY=0,this._amplitude=80,this._jumps=1,this._jumpTo=null,data&&this.__createFromInitializer(data)}return __extends(JumpAction,_super),JumpAction.prototype.__createFromInitializer=function(data){_super.prototype.__createFromInitializer.call(this,data),"undefined"!=typeof data&&(this._amplitude=data.amplitude,this._jumps=data.jumps,this._jumpTo=new Vector(data.position.x,data.position.y))},JumpAction.prototype.update=function(delta,node){var frac=delta*this._jumps%1,y=4*this._amplitude*frac*(1-frac);y+=this._jumpTo.y*delta;var x=this._jumpTo.x*delta;return x+=this._originalX,y+=this._originalY,this._relativeAction&&this._reversed&&(x-=this._jumpTo.x,y-=this._jumpTo.y),node.setPosition(x,y),__v0.set(x,y)},JumpAction.prototype.solveInitialValues=function(){},JumpAction.prototype.initWithTarget=function(node){this._originalX=node.x,this._originalY=node.y,this._relativeAction||(this._jumpTo.x-=this._originalX,this._jumpTo.y-=this._originalY),this.solveInitialValues(node)},JumpAction.prototype.__cloneImpl=function(){var copy=new JumpAction;return copy._amplitude=this._amplitude,copy._jumps=this._jumps,copy._jumpTo=new Vector(this._jumpTo.x,this._jumpTo.y),this.__genericCloneProperties(copy),copy},JumpAction.prototype.getInitializer=function(){var init=_super.prototype.getInitializer.call(this);return init.type="JumpAction",init.jumps=this._jumps,init.amplitude=this._amplitude,init.position={x:this._jumpTo.x,y:this._jumpTo.y},init},JumpAction}(Action);action.JumpAction=JumpAction}(action=cc.action||(cc.action={}))}(cc||(cc={}));var cc;!function(cc){var action;!function(__action){var __index=0,ActionInfo=function(){function ActionInfo(_actionManager,_target,_action){this._actionManager=_actionManager,this._target=_target,this._action=_action,this._chain=null}return ActionInfo.prototype.__action=function(bh){return null!==this._chain&&(bh._chainAction=this._chain._action),this._action=bh,bh.setTag("tag"+__index++),bh},ActionInfo.prototype.action=function(action){var a=this.__action(action);return a.setDelay(a._startTime/cc.action.TIMEUNITS),a},ActionInfo.prototype.step=function(elapsedTime){this._action.step(elapsedTime,this._target)},ActionInfo.prototype.isFinished=function(){return this._action.isFinished()},ActionInfo.prototype.pause=function(){this._action.pause(this._target)},ActionInfo.prototype.resume=function(){this._action.resume()},ActionInfo.prototype.setChain=function(actionInfo){this._chain=actionInfo},ActionInfo.prototype.stop=function(){this._action.stop(this._target)},ActionInfo}();__action.ActionInfo=ActionInfo;var ActionManager=function(){function ActionManager(){this._actionInfos=[],this._scheduler=null,this._scheduler=new __action.SchedulerQueue,this.scheduleActionForNode(null,this._scheduler)}return ActionManager.prototype.getScheduler=function(){return this._scheduler},ActionManager.prototype.scheduleActionForNode=function(target,action){var tw=new ActionInfo(this,target);return tw.action(action),this._actionInfos.push(tw),this},ActionManager.prototype.stopNodeActionByTag=function(target,tag){for(var i=0;i<this._actionInfos.length;i++)this._actionInfos[i]._target===target&&this._actionInfos[i]._action._tag===tag&&this._actionInfos[i].stop();return this},ActionManager.prototype.stopActionsForNode=function(target){for(var i=0;i<this._actionInfos.length;i++)this._actionInfos[i]._target===target&&this._actionInfos[i].stop();return this},ActionManager.prototype.__newActionInfo=function(){var ai=new ActionInfo(this,this._actionInfos[this._actionInfos.length-1]._target);return this._actionInfos.push(ai),ai},ActionManager.prototype.step=function(elapsedTime){var i,someActionsFinished=!1,len=this._actionInfos.length;for(i=0;len>i;i++)this._actionInfos[i].step(elapsedTime),this._actionInfos[i].isFinished()&&(someActionsFinished=!0);if(someActionsFinished){var actions=[];for(i=0;i<this._actionInfos.length;i++)this._actionInfos[i].isFinished()||actions.push(this._actionInfos[i]);this._actionInfos=actions}},ActionManager.prototype.pauseAll=function(){for(var i=0;i<this._actionInfos.length;i++)this._actionInfos[i].pause()},ActionManager.prototype.resumeAll=function(){for(var i=0;i<this._actionInfos.length;i++)this._actionInfos[i].resume()},ActionManager.prototype.getNumActions=function(){return this._actionInfos.length},ActionManager.prototype.getNumActionsForTarget=function(target){for(var count=0,i=0;i<this._actionInfos.length;i++)this._actionInfos[i]._target===target&&count++;return count},ActionManager.prototype.getNumActionsForNode=function(node){return this.getNumActionsForTarget(node)},ActionManager}();__action.ActionManager=ActionManager}(action=cc.action||(cc.action={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var action;!function(action){var Action=cc.action.Action;!function(SchedulerQueueTaskStatus){SchedulerQueueTaskStatus[SchedulerQueueTaskStatus.RUNNING=0]="RUNNING",SchedulerQueueTaskStatus[SchedulerQueueTaskStatus.PAUSED=1]="PAUSED",SchedulerQueueTaskStatus[SchedulerQueueTaskStatus.ENDED=2]="ENDED"}(action.SchedulerQueueTaskStatus||(action.SchedulerQueueTaskStatus={}));var SchedulerQueueTask=(action.SchedulerQueueTaskStatus,function(){function SchedulerQueueTask(){this._startTime=0,this._interval=0,this._delay=0,this._status=null,this._prevCallbackNotificationTime=0,this._prevTime=0,this._priority=0}return SchedulerQueueTask.prototype.step=function(currentTime){2!==this._status&&1!==this._status&&currentTime>=this._startTime&&(this._repeat>0&&0!==this._interval?this.__stepForRepetition(currentTime):(this.__doCallback(currentTime-this._prevCallbackNotificationTime),this._prevCallbackNotificationTime=currentTime,this._repeat||this.end()))},SchedulerQueueTask.prototype.__stepForRepetition=function(currentTime){var shotIndex=(currentTime-this._startTime)/this._interval|0,prevshotIndex=(this._prevTime-this._startTime)/this._interval|0;shotIndex>prevshotIndex&&shotIndex>0&&(this.__doCallback(currentTime-this._prevCallbackNotificationTime),this._prevCallbackNotificationTime=currentTime),this._prevTime=currentTime,currentTime>=this._startTime+this._interval*this._repeat&&this.end()},SchedulerQueueTask.prototype.__doCallback=function(elapsedTime){null===this._target?this._callback(elapsedTime,this._target):this.__doCallCallback(elapsedTime)},SchedulerQueueTask.prototype.__doCallCallback=function(elapsedTime){this._callback.call(this._target,elapsedTime/cc.action.TIMEUNITS,this._target)},SchedulerQueueTask.prototype.pause=function(){this._status=1},SchedulerQueueTask.prototype.resume=function(){this._status=0},SchedulerQueueTask.prototype.end=function(){this._status=2},SchedulerQueueTask.prototype.isEnded=function(){return 2===this._status},SchedulerQueueTask.prototype.adjustTime=function(time){this._startTime=time+(this._delay||0),this._prevCallbackNotificationTime=this._startTime},SchedulerQueueTask}());action.SchedulerQueueTask=SchedulerQueueTask;var SchedulerQueue=function(_super){function SchedulerQueue(){_super.call(this),this._tasks=[],this._repeatTimes=Number.MAX_VALUE,this._duration=0,this._status=2,this._firstExecution=!1}return __extends(SchedulerQueue,_super),SchedulerQueue.prototype.setRepeatForever=function(){return this},SchedulerQueue.prototype.setRepeatTimes=function(){return this},SchedulerQueue.prototype.setDuration=function(){return this},SchedulerQueue.prototype.timeInfo=function(){return this},SchedulerQueue.createSchedulerTask=function(target,callback,interval,repeat,delay){var task=new SchedulerQueueTask;return task._target=target,task._delay=(delay||0)*cc.action.TIMEUNITS,task._callback=callback,task._interval=(interval||0)*cc.action.TIMEUNITS,task._repeat="undefined"!=typeof repeat?repeat:Number.MAX_VALUE,task._status=0,task},SchedulerQueue.prototype.scheduleTask=function(target,callback,interval,repeat,delay){var worktask=null,task=null;worktask=arguments.length>1?SchedulerQueue.createSchedulerTask(target,callback,interval,repeat,delay):target,task=this.__findTask(worktask._target,worktask._callback),null===task?(worktask.adjustTime(this._currentTime),this.insertTask(worktask)):(task._interval=worktask._interval,task._status=0)},SchedulerQueue.prototype.insertTask=function(task){if(0===this._tasks.length||task._priority>=this._tasks[this._tasks.length-1]._priority)return void this._tasks.push(task);for(var left=0,right=this._tasks.length-1;left!==right;){var middle=right+left>>1,midtask=this._tasks[middle];task._priority>midtask._priority?left=middle+1:task._priority<midtask._priority?right=middle-1:left+=1}this._tasks.splice(left,0,task)},SchedulerQueue.prototype.__findTask=function(target,method){for(var i=0;i<this._tasks.length;i++){var task=this._tasks[i];if(task._target===target&&task._callback===method)return task}return null},SchedulerQueue.prototype.pauseTarget=function(target){for(var i=0;i<this._tasks.length;i++){var task=this._tasks[i];task._target===target&&task.pause()}},SchedulerQueue.prototype.pauseTask=function(target,callback){for(var i=0;i<this._tasks.length;i++){var task=this._tasks[i];if(task._target===target&&task._callback===callback)return void task.pause()}},SchedulerQueue.prototype.endTask=function(target,callback){for(var i=0;i<this._tasks.length;i++){var task=this._tasks[i];if(task._target===target&&task._callback===callback)return void task.end()}},SchedulerQueue.prototype.resumeTask=function(target,callback){for(var i=0;i<this._tasks.length;i++){var task=this._tasks[i];if(task._target===target&&task._callback===callback)return void task.resume()}},SchedulerQueue.prototype.resumeTarget=function(target){for(var i=0;i<this._tasks.length;i++){var task=this._tasks[i];task._target===target&&task.resume()}},SchedulerQueue.prototype.unscheduleAllCallbacks=function(target){for(var i=0;i<this._tasks.length;i++){var task=this._tasks[i];task._target===target&&task.end()}},SchedulerQueue.prototype.unscheduleCallbackForTarget=function(target,callback){this.endTask(target,callback)},SchedulerQueue.prototype.update=function(){for(var len=this._tasks.length,i=0;len>i;i++)this._tasks[i].step(this._currentTime);for(var i=len-1;i>=0;i-=1)this._tasks[i].isEnded()&&this._tasks.splice(i,1)},SchedulerQueue}(Action);action.SchedulerQueue=SchedulerQueue}(action=cc.action||(cc.action={}))}(cc||(cc={}));var cc;!function(cc){var action;!function(_action){function ParseAction(actionDef){if("undefined"!==cc.action[actionDef.type]){var action=new cc.action[actionDef.type];return action.__createFromInitializer(actionDef),action}return console.log("Error, action initializer w/o type."),console.log(JSON.stringify(actionDef,null,2)),null}_action.ParseAction=ParseAction;var ActionChainContext=function(){function ActionChainContext(_target){this._target=_target,this._chainAction=null,this._currentAction=null,this._sequenceStack=[],this._currentSequence=null}return ActionChainContext.prototype.__action=function(ctor){return this.action(new ctor),ctor===cc.action.SequenceAction&&(this._sequenceStack.push(this._currentAction),this._currentSequence=this._currentAction),this},ActionChainContext.prototype.action=function(_currentAction){var currentAction;return currentAction=_currentAction instanceof cc.action.Action?_currentAction:cc.action.ParseAction(_currentAction),this._currentSequence?this._currentSequence.addAction(currentAction):this._target.runAction(currentAction),this._chainAction&&(currentAction._chainAction=this._chainAction,this._chainAction=null),this._currentAction=currentAction,currentAction.__updateDuration(),this},ActionChainContext.prototype.actionPath=function(){return this.__action(cc.action.PathAction)},ActionChainContext.prototype.actionMove=function(){return this.__action(cc.action.MoveAction)},ActionChainContext.prototype.actionRotate=function(){return this.__action(cc.action.RotateAction)},ActionChainContext.prototype.actionProperty=function(){return this.__action(cc.action.PropertyAction)},ActionChainContext.prototype.actionAlpha=function(){return this.__action(cc.action.AlphaAction)},ActionChainContext.prototype.actionTint=function(){return this.__action(cc.action.TintAction)},ActionChainContext.prototype.actionScale=function(){return this.__action(cc.action.ScaleAction)},ActionChainContext.prototype.actionSequence=function(){return this.__action(cc.action.SequenceAction)},ActionChainContext.prototype.endSequence=function(){return this._sequenceStack.length&&(this._sequenceStack.pop(),this._currentSequence=this._sequenceStack.length?this._sequenceStack[this._sequenceStack.length-1]:null,this._currentAction=this._currentSequence),this},ActionChainContext.prototype.from=function(obj){return this._currentAction&&this._currentAction.from(obj),this},ActionChainContext.prototype.to=function(obj){return this._currentAction&&this._currentAction.to(obj),this},ActionChainContext.prototype.setInterpolator=function(i){return this._currentAction&&this._currentAction.setInterpolator(i),this},ActionChainContext.prototype.setRelative=function(b){return this._currentAction&&this._currentAction.setRelative(b),this},ActionChainContext.prototype.setDuration=function(d){return this._currentAction&&this._currentAction.setDuration(d),this},ActionChainContext.prototype.setRepeatForever=function(obj){return this._currentAction&&this._currentAction.setRepeatForever(obj),this},ActionChainContext.prototype.setRepeatTimes=function(n){return this._currentAction&&this._currentAction.setRepeatTimes(n),this},ActionChainContext.prototype.then=function(){return this._chainAction=this._currentAction,this},ActionChainContext.prototype.timeInfo=function(delay,duration,interpolator){return this._currentAction.timeInfo(delay,duration,interpolator),this},ActionChainContext.prototype.onEnd=function(f){return this._currentAction&&this._currentAction.onEnd(f),this
},ActionChainContext.prototype.onStart=function(f){return this._currentAction&&this._currentAction.onStart(f),this},ActionChainContext.prototype.onRepeat=function(f){return this._currentAction&&this._currentAction.onRepeat(f),this},ActionChainContext.prototype.onPause=function(f){return this._currentAction&&this._currentAction.onPause(f),this},ActionChainContext.prototype.onResume=function(f){return this._currentAction&&this._currentAction.onResume(f),this},ActionChainContext.prototype.onApply=function(f){return this._currentAction&&this._currentAction.onApply(f),this},ActionChainContext.prototype.setSequential=function(b){return this._currentAction.setSequential&&this._currentAction.setSequential(b),this},ActionChainContext}();_action.ActionChainContext=ActionChainContext}(action=cc.action||(cc.action={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var Performance;!function(_Performance){function __startPerformance(){return performance.now()}function __startTime(){return(new Date).getTime()}var _units="undefined"!=typeof performance?1e3:1,__start="undefined"!=typeof performance?__startPerformance:__startTime,MEASURE_CACHE_SIZE=500,Measure=function(){function Measure(name){this._prevValues=[],this._accumulatedValue=0,this._name=null,this._value=0,this._start=0,this._name=name}return Measure.prototype.increment=function(){this._value++},Measure.prototype.clear=function(){this._start=0,this._value=0,this._accumulatedValue=0},Measure.prototype.clearCache=function(){this._prevValues=[]},Measure.prototype.setValue=function(v){this._value=v,this._accumulatedValue+=v},Measure.prototype.getValue=function(){return this._value},Measure.prototype.start=function(){this._start=__start()},Measure.prototype.end=function(){this._value+=__start()-this._start},Measure.prototype.save=function(){this._prevValues.length>MEASURE_CACHE_SIZE&&this._prevValues.shift(),this._prevValues.push(this.getValue())},Measure}();_Performance.Measure=Measure;var TimeMeasure=function(_super){function TimeMeasure(name){_super.call(this,name)}return __extends(TimeMeasure,_super),TimeMeasure.prototype.getValue=function(){return this._value/_units},TimeMeasure}(Measure);_Performance.TimeMeasure=TimeMeasure;var Performance=function(){function Performance(){this._measures={draws:new Measure("draws"),loop:new TimeMeasure("loop")}}return Performance.prototype.start=function(id){this._measures[id].start()},Performance.prototype.end=function(id){this._measures[id].end()},Performance.prototype.increment=function(id){this._measures[id].increment()},Performance.prototype.setValue=function(id,v){this._measures[id].setValue(v)},Performance.prototype.clear=function(){for(var id in this._measures)this._measures.hasOwnProperty(id)&&this._measures[id].clear()},Performance.prototype.clearCache=function(){for(var id in this._measures)this._measures.hasOwnProperty(id)&&this._measures[id].clearCache()},Performance.prototype.save=function(){for(var id in this._measures)this._measures.hasOwnProperty(id)&&this._measures[id].save()},Performance}();_Performance.Performance=Performance}(Performance=cc.Performance||(cc.Performance={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var node;!function(_node){var Node=cc.node.Node,ActionManager=cc.action.ActionManager,Scene=function(_super){function Scene(){_super.call(this),this._actionManager=new ActionManager,this._onEnter=null,this._onExit=null,this._onEnterTransitionDidFinish=null,this._onExitTransitionDidStart=null,this._scheduler=null,this._sceneGraphPriorityTree=null,this._priorityTree=null,this._scheduler=this._actionManager.getScheduler(),this._sceneGraphPriorityTree=new cc.input.SceneGraphInputTreeNode(this),this._priorityTree=[],this.setGlobalAlpha(!0),this.setPositionAnchor(0,0)}return __extends(Scene,_super),Scene.prototype.enableEvents=function(enable){return _super.prototype.enableEvents.call(this,enable),this.enableEventsForNode(this),this},Scene.prototype.enablePriorityEvents=function(enable,priority){return _super.prototype.enablePriorityEvents.call(this,enable,priority),this.enableEventsForNode(this),this},Scene.prototype.enableEventsForNode=function(node){return this._sceneGraphPriorityTree.insert(node.getPathToRoot()),this},Scene.prototype.enablePriorityEventsForNode=function(node){for(var pin,pinIndex=-1,i=0;i<this._priorityTree.length;i++)if(this._priorityTree[i].node===node){pinIndex=i;break}if(-1!==pinIndex){if(pin=this._priorityTree[pinIndex],pin.priority===node.getInputPriority())return}else this._priorityTree.push(new cc.input.PriorityInputNode(node,node.getInputPriority()));return this._priorityTree.sort(function(n0,n1){return n0.priority<n1.priority?-1:n0.priority>n1.priority?1:0}),this},Scene.prototype.findNodeAtScreenPoint=function(p,callback){var pp=new cc.math.Vector;pp.set(p.x,p.y);for(var i=0;i<this._priorityTree.length;i++){var node=this._priorityTree[i].node;if(p.set(pp.x,pp.y),node.isScreenPointInNode(p)){if(!callback)return node;if(!callback(node))return node}}return p.set(pp.x,pp.y),this._sceneGraphPriorityTree.findNodeAtScreenPoint(p,callback)},Scene.prototype.step=function(delta,ctx){this._actionManager.step(delta),this.visit(ctx)},Scene.prototype.onEnter=function(c){return this._onEnter=c,this},Scene.prototype.onExit=function(c){return this._onExit=c,this},Scene.prototype.onExitTransitionDidStart=function(c){return this._onExitTransitionDidStart=c,this},Scene.prototype.onEnterTransitionDidFinish=function(c){return this._onEnterTransitionDidFinish=c,this},Scene.prototype.callOnEnterTransitionDidFinish=function(){this._onEnterTransitionDidFinish&&this._onEnterTransitionDidFinish(this)},Scene.prototype.callOnExitTransitionDidStart=function(){this._onExitTransitionDidStart&&this._onExitTransitionDidStart(this)},Scene.prototype.callOnEnter=function(){var scene=this;this.enumerateChildren("//*",function(node){node.setScene(scene)}),this._onEnter&&this._onEnter(this),this.resetScene()},Scene.prototype.callOnExit=function(){this._onExit&&this._onExit(this)},Scene.prototype.setScene=function(){},Scene.prototype.setParent=function(){return this},Scene.prototype.resetScene=function(){return this.alpha=1,this.setScale(1,1),this.setPositionAnchor(0,0),this.setTransformationAnchor(.5,.5),this.__setFlag(8),this},Scene.prototype.scheduleActionForNode=function(node,action){return this._actionManager.scheduleActionForNode(node,action),this},Scene.prototype.clear=function(){this.removeAllChildren()},Scene.prototype.runAction=function(action){return this.scheduleActionForNode(this,action),this},Scene.prototype.stopNodeActionByTag=function(node,tag){return this._actionManager.stopNodeActionByTag(node,tag),this},Scene.prototype.stopActionsForNode=function(node){this._actionManager.stopActionsForNode(node)},Scene.prototype.getScheduler=function(){return this._scheduler},Scene.prototype.getScene=function(){return this},Scene.prototype.scheduleTask=function(task){this._scheduler.scheduleTask(task)},Scene.prototype.scheduleUpdateWithPriority=function(priority){var task=cc.action.SchedulerQueue.createSchedulerTask(this,this.update,0,Number.MAX_VALUE,0);task._priority=priority,this._scheduler.scheduleTask(task)},Scene.prototype.scheduleUpdate=function(){var task=cc.action.SchedulerQueue.createSchedulerTask(this,this.update,0,Number.MAX_VALUE,0);this._scheduler.scheduleTask(task)},Scene.prototype.unscheduleUpate=function(){this._scheduler.unscheduleCallbackForTarget(this,this.update)},Scene.prototype.schedule=function(callback_fn,interval,repeat,delay){var task=cc.action.SchedulerQueue.createSchedulerTask(this,callback_fn,interval,repeat,delay);this._scheduler.scheduleTask(task)},Scene.prototype.scheduleOnce=function(callback_fn,delay){this.schedule(callback_fn,0,0,delay)},Scene.prototype.unschedule=function(callback_fn){callback_fn&&this._scheduler.unscheduleCallbackForTarget(this,callback_fn)},Scene.prototype.unscheduleCallbackForTarget=function(target,task){this._scheduler.unscheduleCallbackForTarget(target,task)},Scene.prototype.unscheduleAllCallbacks=function(target){this._scheduler.unscheduleAllCallbacks(target?target:this)},Scene.prototype.resume=function(){this._scheduler.resumeTarget(this)},Scene.prototype.pause=function(){this._scheduler.pauseTarget(this)},Scene.prototype.pauseTarget=function(target){this._scheduler.pauseTarget(target)},Scene.prototype.resumeTarget=function(target){this._scheduler.resumeTarget(target)},Scene}(Node);_node.Scene=Scene}(node=cc.node||(cc.node={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var node;!function(node){var Node=cc.node.Node,Scene=cc.node.Scene,Debug=cc.Debug,Locale=cc.locale,ActionManager=cc.action.ActionManager;!function(DirectorStatus){DirectorStatus[DirectorStatus.CREATED=0]="CREATED",DirectorStatus[DirectorStatus.RUNNING=1]="RUNNING",DirectorStatus[DirectorStatus.PAUSED=2]="PAUSED",DirectorStatus[DirectorStatus.STOPPED=3]="STOPPED"}(node.DirectorStatus||(node.DirectorStatus={}));var __window=(node.DirectorStatus,window),Director=function(_super){function Director(){_super.call(this),this._status=0,this._renderer=null,this._scenes=[],this._animFrame=null,this._animationInterval=1e3/60,this._currentScene=null,this._exitingScene=null,this._scenesActionManager=null,this._prevPerf=0,this._inputManager=null,this._scheduler=null,this._scenesActionManager=new ActionManager,this._scheduler=this._scenesActionManager.getScheduler(),this._inputManager=new cc.input.InputManager,cc.director=this}return __extends(Director,_super),Director.prototype.getRenderer=function(){return this._renderer},Director.prototype.setRenderer=function(renderer){this._renderer=renderer,this._contentSize.set(renderer.getContentSize()),this._modelViewMatrix=this._renderer.getScaleContentMatrix(),this._worldModelViewMatrix=this._renderer.getScaleContentMatrix(),this._inputManager.enable(renderer._surface);var me=this;return renderer.onContentScaled(function(unitsWidth,unitsHeight,preferredUnitsWidth,preferredUnitsHeight,canvasWidth,canvasHeight,sceneHint){if(me.setContentSize(canvasWidth,canvasHeight),16&sceneHint)me._currentScene.setContentSize(unitsWidth,unitsHeight),me._currentScene.setPosition((preferredUnitsWidth-unitsWidth)/2,(preferredUnitsHeight-unitsHeight)/2);else if(32&sceneHint)me._currentScene.setContentSize(preferredUnitsWidth,preferredUnitsHeight),me._currentScene.setPosition(0,0);else{var x=0,y=0;8&sceneHint&&(x=preferredUnitsWidth-unitsWidth),(cc.render.RENDER_ORIGIN===cc.render.ORIGIN_TOP&&4&sceneHint||cc.render.RENDER_ORIGIN===cc.render.ORIGIN_BOTTOM&&1&sceneHint)&&(y=preferredUnitsHeight-unitsHeight),me._currentScene.setContentSize(unitsWidth,unitsHeight),me._currentScene.setPosition(x,y)}}),this},Director.prototype.__setTransform=function(){return this},Director.prototype.__setLocalTransform=function(){},Director.prototype.__setWorldTransform=function(){},Director.prototype.getInputManager=function(){return this._inputManager},Director.prototype.pause=function(){2!==this._status&&(this.stopAnimation(),this._status=2)},Director.prototype.resume=function(){2===this._status&&this.startAnimation()},Director.prototype.addToDOM=function(){this._renderer.addToDOM()},Director.prototype.__sceneExitedDirector=function(scene){scene&&(scene.callOnExit(),scene.cleanup(),scene._parent=null)},Director.prototype.runScene=function(scene_or_transition,transition){var scene,_this=this;if(scene_or_transition instanceof Scene)scene=scene_or_transition;else{if(!(scene_or_transition instanceof cc.transition.Transition))throw"Director.runScene with wrong object type.";if(transition=scene_or_transition,scene=transition._sceneIn,!scene)throw"director.runAction(transition) has no scene set."}if(0===scene.width||0===scene.height){var pw=this.getRenderer()._preferredUnits;scene.setContentSize(pw.width,pw.height)}scene._parent=this,this.addToDOM(),"undefined"!=typeof transition?(this._exitingScene=this._currentScene,transition.initialize(scene,this._currentScene).onDirectorTransitionEnd(function(){_this._exitingScene=null})):(this._currentScene&&this.__sceneExitedDirector(this._currentScene),scene.callOnEnter()),this._currentScene=scene,cc.input.MouseInputManager.enableInputForScene(scene),this._renderer.checkOrientation(),1!==this._status&&this.startAnimation()},Director.prototype.pushScene=function(scene){return-1!==this._scenes.indexOf(scene)?void Debug.error(Locale.ERR_RUNNING_ALREADY_EXISTING_SCENE):(this._scenes.push(scene),void this.runScene(scene))},Director.prototype.popScene=function(){if(0===this._scenes.length)return void Debug.error(Locale.ERR_DIRECTOR_POPSCENE_UNDERFLOW);var exitScene=this._scenes.pop();this.__sceneExitedDirector(exitScene),this._scenes.length>0&&(this._currentScene=this._scenes[this._scenes.length-1],this._currentScene.callOnEnter())},Director.prototype.popToRootScene=function(){this.popToSceneStackLevel(1)},Director.prototype.popToSceneStackLevel=function(level){if(level=this._scenes.length-level,0>=level)return void Debug.error(Locale.ERR_DIRECTOR_POPSCENE_UNDERFLOW);for(;level;)this.popScene(),level--},Director.prototype.startAnimation=function(){function raf(perf){fn(perf),me._animFrame=__window.requestAnimFrame(raf)}if(1===this._status)return void Debug.warn(Locale.WARN_START_ANIMATION_ON_RUNNING_DIRECTOR);this._status=1;var fn=this.mainLoop.bind(this),me=this;this._animFrame=__window.requestAnimFrame(raf),this._currentScene&&cc.input.MouseInputManager.enableInputForScene(this._currentScene)},Director.prototype.stopAnimation=function(){1===this._status&&(this._status=3,null!==this._animFrame&&(__window.cancelAnimationFrame(this._animFrame),this._animFrame=null),this._currentScene&&cc.input.MouseInputManager.disableInputForScene())},Director.prototype.setAnimationInterval=function(interval){this._animationInterval=interval},Director.prototype.mainLoop=function(perf){if(1===this._status){var deltaTime;"undefined"==typeof perf&&(perf=(new Date).getTime()),deltaTime=perf-this._prevPerf,deltaTime>250&&(deltaTime=250),this._prevPerf=perf;var ctx=this._renderer.getRenderingContext();ctx.clear(),this.visit(ctx),this._scenesActionManager.step(deltaTime/cc.action.TIMEUNITS),this._exitingScene&&this._exitingScene.step(deltaTime/cc.action.TIMEUNITS,ctx),this._currentScene.step(deltaTime/cc.action.TIMEUNITS,ctx),this._renderer.flush&&this._renderer.flush()}},Director.prototype.createScene=function(){var scene=new Scene;return scene.setContentSize(this._contentSize.width,this._contentSize.height),scene},Director.prototype.getWinSize=function(){return this._contentSize.clone()},Director.prototype.scheduleTask=function(task){this._scheduler.scheduleTask(task)},Director.prototype.schedule=function(callback_fn,interval,repeat,delay){var task=cc.action.SchedulerQueue.createSchedulerTask(this,callback_fn,interval,repeat,delay);this._scheduler.scheduleTask(task)},Director.prototype.scheduleOnce=function(callback_fn,delay){this.schedule(callback_fn,0,0,delay)},Director.prototype.unschedule=function(callback_fn){callback_fn&&this._scheduler.unscheduleCallbackForTarget(this,callback_fn)},Director.prototype.unscheduleAllCallbacks=function(target){this._scheduler.unscheduleAllCallbacks(target?target:this)},Director}(Node);node.Director=Director}(node=cc.node||(cc.node={}))}(cc||(cc={}));var cc;!function(cc){var render;!function(render){var Texture2D=function(){function Texture2D(el,name){this._name=null,this._webglState=null,this._glId=null,this._textureWidth=0,this._textureHeight=0,this._image=null,this._hasMipmaps=!1,this._u0=0,this._v0=0,this._u1=0,this._v1=0,this._offsetX=0,this._offsetY=0,this._imageWidth=0,this._imageHeight=0,this._isLoaded=!1,this._invertedY=!1,el&&(this.initWithElement(el),this._name=name)}return Texture2D.prototype.initWithElement=function(el){function POT(v){for(var current=1;v>current;)current<<=1;return current}if("string"==typeof el){var image=new Image;image.onload=function(me){return function(e){me.initWithElement(e.target)}}(this),image.src=el}else this._image=el,this._imageWidth=el.width,this._imageHeight=el.height,this._image._textureInfo=this,this._isLoaded=!0;this._textureWidth=POT(this._image.width),this._textureHeight=POT(this._image.height),this._u1=this._imageWidth/this._textureWidth,this._v1=this._imageHeight/this._textureHeight},Object.defineProperty(Texture2D.prototype,"width",{get:function(){return this.getPixelsWide()},enumerable:!0,configurable:!0}),Object.defineProperty(Texture2D.prototype,"height",{get:function(){return this.getPixelsHigh()},enumerable:!0,configurable:!0}),Texture2D.prototype.getPixelsWide=function(){return this._imageWidth},Texture2D.prototype.getPixelsHigh=function(){return this._imageHeight},Texture2D.prototype.getImage=function(){return this._glId?this._glId:this._image},Texture2D.prototype.isWebGLEnabled=function(){return null!==this._glId},Texture2D.prototype.release=function(){this._glId&&this._webglState&&(this._webglState._gl.deleteTexture(this._glId),this._glId=null)},Texture2D.prototype.__setAsGLTexture=function(webglstate){if(!webglstate||this.isWebGLEnabled())return this;var gl=webglstate._gl;return this._webglState=webglstate,this._glId=gl.createTexture(),webglstate.bindTexture(gl.TEXTURE_2D,this._glId),webglstate.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),cc.render.RENDER_ORIGIN===cc.render.ORIGIN_BOTTOM&&(this._invertedY=!0,gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,1)),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this._textureWidth,this._textureHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,null),gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,gl.RGBA,gl.UNSIGNED_BYTE,this._image),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),this._image=null,this},Texture2D.prototype.setTexParameters=function(texParams,magFilter,wrapS,wrapT){if(this._webglState){var minFilter,gl=this._webglState._gl;"undefined"==typeof magFilter?(magFilter=texParams.magFilter,wrapS=texParams.wrapS,wrapT=texParams.wrapT,minFilter=texParams.minFilter):minFilter=texParams,this._webglState.bindTexture(gl.TEXTURE_2D,this._glId),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,minFilter),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,magFilter),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,wrapS),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,wrapT)}},Texture2D.prototype.setAntiAliasTexParameters=function(){if(this._webglState){var gl=this._webglState._gl;this._webglState.bindTexture(gl.TEXTURE_2D,this._glId),this._hasMipmaps?gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST):gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST)}},Texture2D.prototype.setAliasTexParameters=function(){if(this._webglState){var gl=this._webglState._gl;this._webglState.bindTexture(gl.TEXTURE_2D,this._glId),this._hasMipmaps?gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST_MIPMAP_NEAREST):gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST)}},Texture2D.prototype.generateMipmap=function(){if(this._webglState&&!this._hasMipmaps){var gl=this._webglState._gl;this._webglState.bindTexture(gl.TEXTURE_2D,this._glId),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST),gl.generateMipmap(gl.TEXTURE_2D),this._hasMipmaps=!0}},Texture2D}();render.Texture2D=Texture2D}(render=cc.render||(cc.render={}))}(cc||(cc={}));var cc;!function(cc){var node;!function(node){var sprite;!function(sprite){function __createSpriteFrame(from,x,y,w,h,name,rotated,offsetx,offsety){var frame=from.createSubSpriteFrame(parseFloat(x),parseFloat(y),parseFloat(w),parseFloat(h),name,offsetx,offsety);return frame.rotated=rotated,frame}var Vector=cc.math.Vector,Rectangle=cc.math.Rectangle,SpriteFrame=function(){function SpriteFrame(_texture,rect){this._texture=_texture,this._parent=null,this._offset=new Vector,this._offsetFromCenter=null,this._rotated=!1,this._rect=null,this._normalizedRect=new Rectangle,this._name=null,this._rect=rect?rect:null!==_texture?new Rectangle(0,0,_texture._imageWidth,_texture._imageHeight):new Rectangle,this.__calculateNormalizedRect(),this._name=_texture&&_texture._name?_texture._name:"root"}return SpriteFrame.prototype.getWidth=function(){return this._rect.w},SpriteFrame.prototype.getHeight=function(){return this._rect.h},SpriteFrame.prototype.getX=function(){return this._rect.x},SpriteFrame.prototype.getY=function(){return this._rect.y},Object.defineProperty(SpriteFrame.prototype,"x",{get:function(){return this._rect.x},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteFrame.prototype,"y",{get:function(){return this._rect.y},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteFrame.prototype,"width",{get:function(){return this._rect.w},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteFrame.prototype,"height",{get:function(){return this._rect.h},enumerable:!0,configurable:!0}),SpriteFrame.prototype.createSubSpriteFrame=function(x,y,w,h,name,centerOffsetX,centerOffsetY){var newRect=new Rectangle(x,y,w,h);if(newRect.translate(this._rect.x,this._rect.y),this._rect.intersectsWith(newRect)){var sf=new SpriteFrame(this._texture,newRect);return sf._name=name,sf._parent=this,sf.setOffset(this._offset.x+this._rect.x,this._offset.y+this._rect.y),sf.setOffsetFromCenter(centerOffsetX||0,centerOffsetY||0),sf}return null},SpriteFrame.prototype.needsSpecialMatrix=function(){return null!==this._offsetFromCenter||this._rotated},SpriteFrame.prototype.setOffsetFromCenter=function(x,y){null===this._offsetFromCenter&&(this._offsetFromCenter=new Vector(0,0)),this._offsetFromCenter.set(x,y)},SpriteFrame.prototype.createSubSpriteFrames=function(rows,columns){for(var sfwidth=this._rect.w/columns,sfheight=this._rect.h/rows,frames=[],i=0;rows>i;i++)for(var j=0;columns>j;j++)frames.push(this.createSubSpriteFrame(j*sfwidth,i*sfheight,sfwidth,sfheight,this._name+(j+i*columns)));return frames},SpriteFrame.prototype.setOffset=function(x,y){this._texture||cc.Debug.error(cc.locale.ERR_SPRITE_FRAME_NO_TEXTURE,"setOffset"),this._offset.set(x,y),this.__calculateNormalizedRect()},Object.defineProperty(SpriteFrame.prototype,"rotated",{get:function(){return this._rotated},set:function(v){this._rotated=v},enumerable:!0,configurable:!0}),SpriteFrame.prototype.__calculateNormalizedRect=function(){cc.render.RENDER_ORIGIN===cc.render.ORIGIN_BOTTOM?this._normalizedRect.set(this._rect.x,this._texture._imageHeight-this._rect.y-this._rect.h,this._rect.w,this._rect.h).normalizeBy(this._texture._textureWidth,this._texture._textureHeight):this._normalizedRect.set(this._rect.x,this._rect.y,this._rect.w,this._rect.h).normalizeBy(this._texture._textureWidth,this._texture._textureHeight)},SpriteFrame.prototype.getTexture=function(){return this._texture},SpriteFrame.prototype.draw=function(ctx,w,h){"webgl"===ctx.type&&(this._texture.isWebGLEnabled()||(cc.Debug.warn(cc.locale.SPRITEFRAME_WARN_TEXTURE_NOT_WEBGL_INITIALIZED,"SpriteFrame.draw"),this._texture.__setAsGLTexture(ctx._webglState),this.__calculateNormalizedRect())),ctx.drawTexture(this._texture,this._rect.x,this._rect.y,this._rect.w,this._rect.h,0,0,w,h)},SpriteFrame.prototype.createSpriteFramesFromJSON=function(map,frames){frames=frames||[],map=map.frames||map;for(var element in map)if(map.hasOwnProperty(element)){var frameRect=map[element].frame;frames.push(__createSpriteFrame(this,frameRect.x,frameRect.y,frameRect.w,frameRect.h,element,map[element].rotated,0,0))}return frames},SpriteFrame.prototype.createSpriteFramesFromPLIST=function(obj){var ret=[],frames=obj[0].frames;for(var id in frames)if(frames.hasOwnProperty(id)){var frameInfo=frames[id];if(frameInfo.frame){var w,h,fi=frameInfo.frame.substring(1,frameInfo.frame.length-1),fis=fi.substring(1,fi.length-1).split("},{"),xy=fis[0].split(","),wh=fis[1].split(","),foffset=frameInfo.offset.substring(1,fi.length-1).split("},{"),offsetxy=foffset[0].split(",");w=parseFloat(frameInfo.rotated?wh[1]:wh[0]),h=parseFloat(frameInfo.rotated?wh[0]:wh[1]);var ox,oy;ox=parseFloat(offsetxy[0]),oy=parseFloat(offsetxy[1]),ret.push(__createSpriteFrame(this,parseFloat(xy[0]),parseFloat(xy[1]),w,h,id,frameInfo.rotated,ox,oy))}else ret.push(__createSpriteFrame(this,frameInfo.x,frameInfo.y,frameInfo.width,frameInfo.height,id,frameInfo.rotated,0,0))}return ret},SpriteFrame}();sprite.SpriteFrame=SpriteFrame}(sprite=node.sprite||(node.sprite={}))}(node=cc.node||(cc.node={}))}(cc||(cc={}));var cc;!function(cc){var node;!function(node){var sprite;!function(sprite){var Texture2D=cc.render.Texture2D,AnimationCache=function(){function AnimationCache(){this._animations={}}return AnimationCache.prototype.addAnimation=function(){},AnimationCache}();sprite.AnimationCache=AnimationCache;var __index=0,Animation=function(){function Animation(){this._frames=[],this._loops=1,this._restoreOriginalFrame=!1,this._delayPerUnit=150/cc.action.TIMEUNITS,this._name=null}return Animation.prototype.addFrame=function(f){return this._frames.push(f),this},Animation.prototype.addFrames=function(f){for(var i=0;i<f.length;i++)this.addFrame(f[i]);return this},Animation.prototype.setDelayPerUnit=function(d){return this._delayPerUnit=d,this},Animation.prototype.setLoops=function(l){return l=1>l?1:0|l,this._loops=l,this},Animation.prototype.setRestoreOriginalFrame=function(r){return this._restoreOriginalFrame=r,this},Animation.prototype.addSpriteFrameWithFile=function(f){var me=this,img=new Image;img.onload=function(){var t2d=new Texture2D(img,f),sf=new sprite.SpriteFrame(t2d);me.addFrame(sf)},img.src=f},Animation.prototype.getDuration=function(){return this._delayPerUnit*this._frames.length},Animation.prototype.getSize=function(){return this._frames.length},Animation.prototype.getSpriteFrameAtIndex=function(i){return this._frames[i]},Animation.prototype.setLoopForever=function(){return this._loops=Number.MAX_VALUE,this},Animation.prototype.clone=function(){var animation=new Animation;return animation._frames=Array.prototype.slice.call(this._frames),animation._delayPerUnit=this._delayPerUnit,animation._loops=this._loops,animation._restoreOriginalFrame=this._restoreOriginalFrame,animation._name=this._name+__index++,animation},Animation.prototype.reverse=function(){return this._frames=this._frames.reverse(),this},Animation}();sprite.Animation=Animation}(sprite=node.sprite||(node.sprite={}))}(node=cc.node||(cc.node={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var node;!function(node){var Node=cc.node.Node,Texture2D=cc.render.Texture2D,SpriteFrame=cc.node.sprite.SpriteFrame,Sprite=(new Float32Array([1,0,0,0,1,0,0,0,1]),function(_super){function Sprite(ddata,rect){_super.call(this),this._flippedX=!1,this._flippedY=!1,this._spriteFrame=null,this._resizeOnSpriteFrameSet=!0,this._spriteMatrix=new Float32Array([1,0,0,0,1,0,0,0,1]),this._spriteMatrixDirty=!1,this._spriteMatrixSet=!1,this.__init(ddata,rect)}return __extends(Sprite,_super),Sprite.create=function(d){return new cc.node.Sprite(d)},Sprite.prototype.__init=function(ddata,rect){if(ddata instanceof cc.node.sprite.SpriteFrame)this.setSpriteFrame(ddata),cc.Debug.warn(cc.locale.WARN_SPRITE_CONSTRUCTOR_DEPRECATED_CALL);else if(ddata instanceof cc.render.Texture2D)this.setSpriteFrame(new SpriteFrame(ddata,arguments[1])),cc.Debug.warn(cc.locale.WARN_SPRITE_CONSTRUCTOR_DEPRECATED_CALL);else if("string"==typeof ddata)"#"===ddata.charAt(0)?this.setSpriteFrame(cc.plugin.asset.AssetManager.getSpriteFrame(ddata.substr(1))):this.__createFromURL(ddata,rect),cc.Debug.warn(cc.locale.WARN_SPRITE_CONSTRUCTOR_DEPRECATED_CALL);else{var data=ddata;data&&(data.texture?this.setSpriteFrame(new SpriteFrame(data.texture,data.rect)):data.frame?this.setSpriteFrame(data.frame):data.frameName?this.setSpriteFrame(cc.plugin.asset.AssetManager.getSpriteFrame(data.frameName)):cc.Debug.warn(cc.locale.ERR_SPRITE_CONSTRUCTOR_PARAM_ERROR))}},Sprite.prototype.__createFromURL=function(url,rect){var resource=cc.plugin.asset.AssetManager._resources[url]||null;if(resource){cc.plugin.asset.AssetManager.getTexture(url)||cc.plugin.asset.AssetManager.addImage(resource,url);var mainSpriteFrame=cc.plugin.asset.AssetManager.getSpriteFrame(url);this.setSpriteFrame(rect?mainSpriteFrame.createSubSpriteFrame(rect.x,rect.y,rect.w,rect.h,url):mainSpriteFrame)}else{var me=this;new cc.plugin.loader.Loader({resources:[url]}).startLoading(function(resources){cc.plugin.asset.AssetManager.mergeResources(resources);var sf=new SpriteFrame(new Texture2D(resources[url],url));rect&&(sf=sf.createSubSpriteFrame(rect.x,rect.y,rect.w,rect.h,url)),me.setSpriteFrame(sf)})}},Sprite.prototype.draw=function(ctx){this._spriteFrame&&(ctx.globalAlpha=this._frameAlpha,ctx.setTintColor(this._color),this._spriteFrame.draw(ctx,this.width,this.height))},Sprite.prototype.setSpriteFrame=function(s){s!==this._spriteFrame&&(this._spriteFrame=s,this._resizeOnSpriteFrameSet&&this.setContentSize(s._rect.w,s._rect.h),this._spriteMatrixDirty=!0)},Sprite.prototype.__createMatrix=function(){var w=this.width,h=this.height;this._spriteMatrixSet=!1,cc.math.Matrix3.identity(this._spriteMatrix),this._flippedX&&this._flippedY?(cc.math.Matrix3.translateBy(this._spriteMatrix,w,h),cc.math.Matrix3.scaleBy(this._spriteMatrix,-1,-1),this._spriteMatrixSet=!0):this._flippedX?(cc.math.Matrix3.translateBy(this._spriteMatrix,w,0),cc.math.Matrix3.scaleBy(this._spriteMatrix,-1,1),this._spriteMatrixSet=!0):this._flippedY&&(cc.math.Matrix3.translateBy(this._spriteMatrix,0,h),cc.math.Matrix3.scaleBy(this._spriteMatrix,1,-1),this._spriteMatrixSet=!0),this._spriteFrame.needsSpecialMatrix()&&(cc.math.Matrix3.translateBy(this._spriteMatrix,this._spriteFrame._offsetFromCenter.x,this._spriteFrame._offsetFromCenter.y),this._spriteFrame._rotated&&(cc.math.Matrix3.translateBy(this._spriteMatrix,w/2,h/2),cc.math.Matrix3.rotateBy(this._spriteMatrix,Math.PI/2),cc.math.Matrix3.translateBy(this._spriteMatrix,-w/2,-h/2)),this._spriteMatrixSet=!0),this._spriteMatrixDirty=!1},Sprite.prototype.__setLocalTransform=function(){_super.prototype.__setLocalTransform.call(this),this.__isFlagSet(2)&&(this._spriteMatrixDirty&&this.__createMatrix(),this._spriteMatrixSet&&cc.math.Matrix3.multiply(this._modelViewMatrix,this._spriteMatrix))},Sprite.prototype.setFlippedX=function(f){return this._flippedX=f,this._spriteMatrixDirty=!0,this.__setFlag(2),this},Sprite.prototype.setFlippedY=function(f){return this._flippedY=f,this._spriteMatrixDirty=!0,this.__setFlag(2),this},Sprite.prototype.resizeOnSpriteFrameSet=function(b){return this._resizeOnSpriteFrameSet=b,this},Sprite.prototype.setTextureRect=function(r){this._spriteFrame&&this.setSpriteFrame(this._spriteFrame.createSubSpriteFrame(r.x,r.y,r.w,r.h,this._name))},Object.defineProperty(Sprite.prototype,"flippedX",{set:function(b){this.setFlippedX(b)},enumerable:!0,configurable:!0}),Object.defineProperty(Sprite.prototype,"flippedY",{set:function(b){this.setFlippedY(b)},enumerable:!0,configurable:!0}),Sprite}(Node));node.Sprite=Sprite;var SpriteBatchNode=function(_super){function SpriteBatchNode(ddata,rect){_super.call(this,null),this._resizeOnSpriteFrameSet=!1,this.__init(ddata,rect)}return __extends(SpriteBatchNode,_super),SpriteBatchNode}(Sprite);node.SpriteBatchNode=SpriteBatchNode}(node=cc.node||(cc.node={}))
}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var node;!function(node){var FastSprite=function(_super){function FastSprite(ddata){_super.call(this,ddata)}return __extends(FastSprite,_super),FastSprite.prototype.visit=function(ctx){this.__isFlagSet(8)&&this._spriteFrame&&("webgl"===ctx.type?ctx.batchGeometryWithSpriteFast(this):_super.prototype.visit.call(this,ctx))},FastSprite}(cc.node.Sprite);node.FastSprite=FastSprite}(node=cc.node||(cc.node={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){function MenuItemSprite(normal,selected,disabled,callback,context){var button=new cc.widget.Button;button.setAnchorPoint(.5,.5);var obj={normal:normal._spriteFrame};return selected&&(obj.pressed=selected._spriteFrame),disabled&&(obj.disabled=disabled._spriteFrame),callback&&(obj.callback=context?callback.bind(context):callback),button.init(obj),button}function MenuItemLabel(label,callback){return callback&&(label.enableEvents(!0),label.addEventListener("mouseclick",function(e){e.target._enabled&&callback()}),label.addEventListener("touchend",function(e){e.target._enabled&&callback()})),label}var widget;!function(widget){!function(ButtonStatus){ButtonStatus[ButtonStatus.NORMAL=0]="NORMAL",ButtonStatus[ButtonStatus.PRESSED=1]="PRESSED",ButtonStatus[ButtonStatus.OVER=2]="OVER",ButtonStatus[ButtonStatus.DISABLED=3]="DISABLED"}(widget.ButtonStatus||(widget.ButtonStatus={}));var Button=(widget.ButtonStatus,function(_super){function Button(){_super.call(this),this._frames=[null,null,null,null],this._status=0,this._callback=null,this.enableEvents(!0);var down=function(e){3!==e.target._status&&e.target.setStatus(1)},click=function(e){3!==e.target._status&&(e.target.setStatus(0),e.target._callback&&e.target._callback())},over=function(e){3!==e.target._status&&e.target.setStatus(2)},out=function(e){3!==e.target._status&&e.target.setStatus(0)};this.addEventListener("mousedown",down),this.addEventListener("touchstart",down),this.addEventListener("touchend",click),this.addEventListener("mouseclick",click),this.addEventListener("mouseover",over),this.addEventListener("touchover",over),this.addEventListener("mouseout",out),this.addEventListener("touchout",out)}return __extends(Button,_super),Button.prototype.disable=function(){this._status=3,this.enableEvents(!1)},Button.prototype.enable=function(){this._status=0,this.enableEvents(!0)},Button.prototype.setEnabled=function(b){b?this.enable():this.disable()},Button.prototype.draw=function(ctx){var sf=this.__getCurrentFrame();sf&&(ctx.globalAlpha=this._frameAlpha,ctx.setTintColor(this._color),sf.draw(ctx,this.width,this.height))},Button.prototype.init=function(obj){obj.normal&&(this._frames[0]=obj.normal),obj.pressed&&(this._frames[1]=obj.pressed),obj.over&&(this._frames[2]=obj.over),obj.disabled&&(this._frames[3]=obj.disabled),this._status=0,obj.callback&&(this._callback=obj.callback),this.width=obj.normal.getWidth(),this.height=obj.normal.getHeight()},Button.prototype.__getCurrentFrame=function(){return this._frames[this._status]||this._frames[0]},Button.prototype.setStatus=function(st){this._status=st;var frame=this.__getCurrentFrame();this.setContentSize(frame.getWidth(),frame.getHeight())},Button}(cc.node.Node));widget.Button=Button}(widget=cc.widget||(cc.widget={})),cc.MenuItemSprite=MenuItemSprite,cc.MenuItemLabel=MenuItemLabel;var MenuItemFont=function(_super){function MenuItemFont(_initializer,callback,target){var _this=this;_super.call(this),this._label=null,this._callback=null,this._enabled=!0;var label;"string"==typeof _initializer?label=new cc.widget.LabelTTF(_initializer,cc.MenuItemFont.DEFAULT_FONT,cc.MenuItemFont.DEFAULT_SIZE):(label=new cc.widget.LabelTTF,label.initialize(_initializer)),this._label=label,callback&&(this._callback=target?callback.bind(target):callback,this._label.enableEvents(!0),this._label.addEventListener("mouseup",function(){_this._enabled&&_this._callback()}),this._label.addEventListener("touchend",function(){_this._enabled&&_this._callback()})),this.addChild(this._label),this._label.setPositionAnchor(0,0),this.setContentSize(this._label.width,this._label.height)}return __extends(MenuItemFont,_super),MenuItemFont.prototype.setFontSize=function(s){this._label.setFontSize(s)},MenuItemFont.prototype.getFontSize=function(){return this._label.getFontSize()},MenuItemFont.prototype.setFontName=function(name){this._label.setFont(name)},MenuItemFont.prototype.getFontName=function(){return this._label.getFont()},MenuItemFont.prototype.setEnabled=function(b){this._label.setEnabled(b)},Object.defineProperty(MenuItemFont.prototype,"fontSize",{get:function(){return this._label._size},set:function(v){this._label._size=v},enumerable:!0,configurable:!0}),Object.defineProperty(MenuItemFont.prototype,"fontName",{get:function(){return this._label._font},set:function(v){this._label._font=v},enumerable:!0,configurable:!0}),MenuItemFont.setFontSize=function(fontSize){cc.MenuItemFont.DEFAULT_SIZE=fontSize},MenuItemFont.fontSize=function(){return cc.MenuItemFont.DEFAULT_SIZE},MenuItemFont.setFontName=function(name){cc.MenuItemFont.DEFAULT_FONT=name},MenuItemFont.DEFAULT_SIZE=16,MenuItemFont.DEFAULT_FONT="Arial",MenuItemFont}(cc.node.Node);cc.MenuItemFont=MenuItemFont;var Menu=function(_super){function Menu(){for(var buttons=[],_i=0;_i<arguments.length;_i++)buttons[_i-0]=arguments[_i];_super.call(this);for(var i=0;i<buttons.length;i++)this.addChild(buttons[i]);this.setPositionAnchor(0,0);var winSize=cc.director.getWinSize();this.setPosition(winSize.width/2,winSize.height/2),this.setContentSize(winSize.width,winSize.height)}return __extends(Menu,_super),Menu.prototype.alignItemsVerticallyWithPadding=function(padding){this._padding=padding+this.y;var len,i,locScaleY,locHeight,locChild,height=-padding,locChildren=this._children;if(locChildren&&locChildren.length>0){for(i=0,len=locChildren.length;len>i;i++)height+=locChildren[i].height*locChildren[i].scaleY+padding;var y=height/2;for(i=0,len=locChildren.length;len>i;i++)locChild=locChildren[i],locHeight=locChild.height,locScaleY=locChild.scaleY,locChild.setPosition(0,y-locHeight*locScaleY/2),y-=locHeight*locScaleY+padding}},Menu.prototype.alignItemsInColumns=function(){for(var rows=[],i=0;i<arguments.length;i++)rows.push(arguments[i]);var rowColumns,tmp,len,height=-5,row=0,rowHeight=0,columnsOccupied=0,locChildren=this._children;if(locChildren&&locChildren.length>0)for(i=0,len=locChildren.length;len>i;i++)row>=rows.length||(rowColumns=rows[row],rowColumns&&(tmp=locChildren[i].height,rowHeight=rowHeight>=tmp||isNaN(tmp)?rowHeight:tmp,++columnsOccupied,columnsOccupied>=rowColumns&&(height+=rowHeight+5,columnsOccupied=0,rowHeight=0,++row)));var winSize=cc.director.getWinSize();row=0,rowHeight=0,rowColumns=0;var w=0,x=0,y=height/2;if(locChildren&&locChildren.length>0)for(i=0,len=locChildren.length;len>i;i++){var child=locChildren[i];0==rowColumns&&(rowColumns=rows[row],w=winSize.width/(1+rowColumns),x=w),tmp=child.height,rowHeight=rowHeight>=tmp||isNaN(tmp)?rowHeight:tmp,child.setPosition(x-winSize.width/2,y-tmp/2),x+=w,++columnsOccupied,columnsOccupied>=rowColumns&&(y-=rowHeight+5,columnsOccupied=0,rowColumns=0,rowHeight=0,++row)}},Menu}(cc.node.Node);cc.Menu=Menu;var MenuItemToggle=function(_super){function MenuItemToggle(){var _this=this;_super.call(this),this._currentOptionIndex=-1,this._options=[],this._callback=null,this._enabled=!0,this.setAnchorPoint(.5,.5),this.enableEvents(!0),this.addEventListener("mouseup",function(){_this._enabled&&_this.__nextOption()}),this.addEventListener("touchup",function(){_this._enabled&&_this.__nextOption()}),this.__init.call(this,Array.prototype.slice.call(arguments))}return __extends(MenuItemToggle,_super),MenuItemToggle.prototype.setEnabled=function(b){this._enabled=b;for(var i=0;i<this._options.length;i++){var node=this._options[i];"undefined"!=typeof node.setEnabled&&node.setEnabled(b)}},MenuItemToggle.prototype.initWithItems=function(){this.__init.call(this,Array.prototype.slice.call(arguments))},MenuItemToggle.prototype.__init=function(args){var len=args.length;"function"==typeof args[args.length-2]?(len-=2,this._callback=args[args.length-2].bind(args[args.length-1])):"function"==typeof args[args.length-1]&&(len-=1,this._callback=args[args.length-1]);for(var i=0;len>i;i++)this.addItem(args[i]);this.setSelectedIndex(0)},MenuItemToggle.prototype.addItem=function(node){node.setAnchorPoint(.5,.5),node.visible=!1,this._options.push(node),this.addChild(node),1===this._children.length&&this.setSelectedIndex(0)},MenuItemToggle.prototype.setCallback=function(callback){this.onClick(callback)},MenuItemToggle.prototype.onClick=function(callback){this._callback=callback},MenuItemToggle.prototype.setSelectedIndex=function(index){if(0!==this._options.length&&(index%=this._children.length,index!==this._currentOptionIndex)){-1!==this._currentOptionIndex&&(this._options[this._currentOptionIndex].visible=!1),this._currentOptionIndex=index;var co=this._options[this._currentOptionIndex];co.setPosition(co.width/2,co.height/2),co.visible=!0,this.setContentSize(co.width,co.height)}},MenuItemToggle.prototype.__emit=function(){this._callback&&this._callback(-1!==this._currentOptionIndex?this._options[this._currentOptionIndex]:null)},MenuItemToggle.prototype.__nextOption=function(){0!==this._children.length&&(this.setSelectedIndex(-1===this._currentOptionIndex?0:this._currentOptionIndex+1),this.__emit())},MenuItemToggle}(cc.node.Node);cc.MenuItemToggle=MenuItemToggle}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var widget;!function(widget){!function(VALIGN){VALIGN[VALIGN.TOP=0]="TOP",VALIGN[VALIGN.MIDDLE=1]="MIDDLE",VALIGN[VALIGN.BOTTOM=2]="BOTTOM"}(widget.VALIGN||(widget.VALIGN={}));widget.VALIGN;!function(HALIGN){HALIGN[HALIGN.LEFT=0]="LEFT",HALIGN[HALIGN.CENTER=1]="CENTER",HALIGN[HALIGN.RIGHT=2]="RIGHT"}(widget.HALIGN||(widget.HALIGN={}));var Label=(widget.HALIGN,function(_super){function Label(text,fontName){_super.call(this),this._text="",this._textSize=null,this._font=null,this._resizeContentSize=!0,this._valign=1,this._halign=1,this._enabled=!0,this._flowWidth=0,this._text=text,this._font=cc.plugin.asset.AssetManager.getSpriteFont(fontName),this.__measureText()}return __extends(Label,_super),Label.prototype.setResizeContentSize=function(b){return this._resizeContentSize=b,this},Label.prototype.__measureText=function(){if(this._font){var d=this._font.getTextSize(this._text,this._flowWidth);this._contentSize.width=this._flowWidth?this._flowWidth:d.width,this._contentSize.height=d.height,this._textSize=d}},Label.prototype.setFont=function(fontName){var fn=cc.plugin.asset.AssetManager.getSpriteFont(fontName);null!==fn&&(this._font=fn,this._resizeContentSize&&this.__measureText())},Label.prototype.setText=function(text){this._text=text,this._resizeContentSize&&this.__measureText()},Label.prototype.setHAlign=function(a){return this._halign=a,this},Label.prototype.setVAlign=function(a){return this._valign=a,this},Label.prototype.draw=function(ctx){_super.prototype.draw.call(this,ctx),this._font&&this._font.drawTextInRect(ctx,this._text,0,0,this._contentSize.width,this._contentSize.height,this._halign,this._valign)},Object.defineProperty(Label.prototype,"textAlign",{get:function(){return this._halign},set:function(v){this._halign=v},enumerable:!0,configurable:!0}),Object.defineProperty(Label.prototype,"textVerticalAlign",{get:function(){return this._valign},set:function(v){this._valign=v},enumerable:!0,configurable:!0}),Label.prototype.setString=function(text){this.setText(text)},Label.prototype.setEnabled=function(e){this._enabled=e},Label.prototype.flowWidth=function(f){return this._flowWidth=f,this.__measureText(),this},Label}(cc.node.Node));widget.Label=Label;var __index=0,LabelTTF=function(_super){function LabelTTF(_initializer,font,fontSize,dimensions,halign,valign){_super.call(this,null),this._text=null,this._font="Arial",this._size=16,this._flow=!1,this._flowWidth=1024,this._fillColor="#fff",this._strokeColor="#ccc",this._strokeSize=1,this._fill=!0,this._stroke=!1,this._shadowBlur=0,this._shadowColor="#ff0",this._shadowOffsetX=0,this._shadowOffsetY=0,this._texture=null,this._horizontalAlignment=0,this._verticalAlignment=1,this._enabled=!0;var initializer;"string"==typeof _initializer?(initializer={text:_initializer,font:"undefined"!=typeof font?font:this._font,size:"undefined"!=typeof fontSize?fontSize:this._size},"undefined"!=typeof dimensions&&(initializer.flowWidth=dimensions.width),initializer.horizontalAlignment="undefined"!=typeof halign?halign:this._horizontalAlignment,initializer.verticalAlignment="undefined"!=typeof valign?valign:this._verticalAlignment):initializer=_initializer,initializer&&(this.initialize(initializer),initializer.text&&this.__initLabel())}return __extends(LabelTTF,_super),LabelTTF.prototype.initialize=function(init){return this._text=init.text,"undefined"!=typeof init.font&&(this._font=init.font),"undefined"!=typeof init.size&&(this._size=init.size),this._flow="undefined"!=typeof init.flowWidth,"undefined"!=typeof init.flowWidth&&(this._flowWidth=init.flowWidth),"undefined"!=typeof init.fillColor&&(this._fillColor=init.fillColor),"undefined"!=typeof init.strokeColor&&(this._strokeColor=init.strokeColor),"undefined"!=typeof init.strokeSize&&(this._strokeSize=init.strokeSize),"undefined"!=typeof init.fill&&(this._fill=init.fill),"undefined"!=typeof init.stroke&&(this._stroke=init.stroke),"undefined"!=typeof init.shadowBlur&&(this._shadowBlur=init.shadowBlur),"undefined"!=typeof init.shadowColor&&(this._shadowColor=init.shadowColor),"undefined"==typeof init.shadowOffsetX&&(this._shadowOffsetX=init.shadowOffsetX),"undefined"==typeof init.shadowOffsetY&&(this._shadowOffsetY=init.shadowOffsetY),"undefined"!=typeof init.horizontalAlignment&&(this._horizontalAlignment=init.horizontalAlignment),"undefined"!=typeof init.verticalAlignment&&(this._verticalAlignment=init.verticalAlignment),this.__initLabel(),this},LabelTTF.prototype.setEnabled=function(b){this._enabled=b},LabelTTF.prototype.setText=function(text){this._text!==text&&(this._text=text,this.__initLabel())},LabelTTF.prototype.setString=function(text){this.setText(text)},LabelTTF.prototype.__initLabel=function(){this._texture&&this._texture.release();var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");this.__prepareContext(ctx);var textSize=this.__getTextSize(ctx,this._text,this._flowWidth),canvas=this.__drawText(this._text,textSize),textureId="labelTTF"+__index++;this._texture=new cc.render.Texture2D(canvas,textureId),this.setSpriteFrame(new cc.node.sprite.SpriteFrame(this._texture))},LabelTTF.prototype.__prepareContext=function(ctx){ctx.font=""+this._size+"px "+this._font,ctx.textBaseline="top",ctx.fillStyle=this._fillColor,this._stroke&&(ctx.strokeStyle=this._strokeColor,ctx.lineWidth=this._strokeSize),this._shadowBlur&&(ctx.shadowBlur=this._shadowBlur,ctx.shadowColor=this._shadowColor,ctx.shadowOffsetX=this._shadowOffsetX,ctx.shadowOffsetY=this._shadowOffsetY)},LabelTTF.prototype.__drawText=function(text,size){var y=0,flowWidth=size.width,offsetX=0,offsetY=0;this._stroke&&(offsetX+=this._strokeSize/2,offsetY+=this._strokeSize/2,size.width+=this._strokeSize),this._shadowBlur&&(size.width+=this._shadowBlur+this._shadowOffsetX,size.height+=this._shadowBlur+this._shadowOffsetY,offsetX+=this._shadowBlur/2+this._shadowOffsetX,offsetY+=this._shadowBlur/2+this._shadowOffsetY*(cc.render.RENDER_ORIGIN===cc.render.ORIGIN_BOTTOM?-1:1));var canvas=document.createElement("canvas");canvas.width=size.width,canvas.height=size.height;var ctx=canvas.getContext("2d");this.__prepareContext(ctx),y=offsetY;for(var lines=text.split("\n"),l=0;l<lines.length;l++){for(var x=offsetX,words=lines[l].split(" "),w=0;w<words.length;w++){var word=words[w]+(w<words.length-1?" ":""),wordLength=ctx.measureText(word).width;x+wordLength>flowWidth&&(y+=this._size,x=0),this._stroke&&ctx.strokeText(word,x,y),this._fill&&ctx.fillText(word,x,y),x+=wordLength}y+=this._size}return canvas},LabelTTF.prototype.__getTextSize=function(ctx,text,flowWidth){var dim=new cc.math.Dimension;flowWidth=this._flowWidth;for(var lines=text.split("\n"),l=0;l<lines.length;l++){for(var x=0,words=lines[l].split(" "),w=0;w<words.length;w++){var word=words[w]+(w<words.length-1?" ":""),wordLength=ctx.measureText(word).width;x+wordLength>flowWidth?(dim.width=Math.max(dim.width,x),dim.height+=this._size,x=wordLength):x+=wordLength}dim.height+=this._size,dim.width=Math.max(dim.width,x)}return this._flow&&(dim.width=flowWidth),dim},LabelTTF.prototype.getFont=function(){return this._font},LabelTTF.prototype.setFont=function(font){this._font=font,this.__initLabel()},LabelTTF.prototype.setFontSize=function(s){this._size=s,this.__initLabel()},LabelTTF.prototype.getFontSize=function(){return this._size},LabelTTF}(cc.node.Sprite);widget.LabelTTF=LabelTTF}(widget=cc.widget||(cc.widget={}))}(cc||(cc={}));var cc;!function(cc){var render;!function(render){var WebGLState=function(){function WebGLState(_gl){this._gl=_gl,this._currentProgram=null,this._currentTexture=null,this._blendSource=-1,this._blendDestination=-1,this._flags={},this._clearColor=[-1,-1,-1,-1],this._viewport=[-1,-1,-1,-1],this._texture={},this._uniformLocation={},this._attribArray={0:!1,1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1,10:!1},this._attribPointers={};for(var i=0;16>i;i++)this._texture[_gl["TEXTURE"+i]]=!1}return WebGLState.prototype.useProgram=function(program){program!==this._currentProgram&&(this._currentProgram=program,this._gl.useProgram(program))},WebGLState.prototype.activeTexture=function(i){this._texture[i]||(this._texture[i]=!0,this._gl.activeTexture(i))},WebGLState.prototype.bindTexture=function(type,t){t!==this._currentTexture&&(this._gl.bindTexture(type,t),this._currentTexture=t)},WebGLState.prototype.enable=function(flag){return this._flags.hasOwnProperty(flag)?void(this._flags[flag]||(this._flags[flag]=!0,this._gl.enable(flag))):(this._flags[flag]=!1,void this._gl.enable(flag))},WebGLState.prototype.flagEnabled=function(flag){return this._flags[flag]},WebGLState.prototype.disable=function(flag){return this._flags.hasOwnProperty(flag)?void(this._flags[flag]&&(this._flags[flag]=!1,this._gl.disable(flag))):(this._flags[flag]=!1,void this._gl.disable(flag))},WebGLState.prototype.clear=function(flags){this._gl.clear(flags)},WebGLState.prototype.clearColor=function(r,g,b,a){(r!==this._clearColor[0]||g!==this._clearColor[1]||b!==this._clearColor[2]||a!==this._clearColor[3])&&(this._clearColor[0]=r,this._clearColor[1]=g,this._clearColor[2]=b,this._clearColor[3]=a,this._gl.clearColor(r,g,b,a))},WebGLState.prototype.viewport=function(x,y,w,h){(x!==this._viewport[0]||y!==this._viewport[1]||w!==this._viewport[2]||h!==this._viewport[3])&&(this._viewport[0]=x,this._viewport[1]=y,this._viewport[2]=w,this._viewport[3]=h,this._gl.viewport(x,y,w,h))},WebGLState.prototype.blendFunc=function(blendSource,blendDestination){(this._blendSource!==blendSource||this._blendDestination!==blendDestination)&&(this._blendSource=blendSource,this._blendDestination=blendDestination,this._gl.blendFunc(blendSource,blendDestination))},WebGLState.prototype.__uniform1Scalar=function(location,value){this._uniformLocation.hasOwnProperty(location._id)||(this._uniformLocation[location._id]=null),this._uniformLocation[location._id]!==value&&(this._gl.uniform1i(location,value),this._uniformLocation[location._id]=value)},WebGLState.prototype.uniform1i=function(location,value){this.__uniform1Scalar(location,value)},WebGLState.prototype.uniform1f=function(location,value){this.__uniform1Scalar(location,value)},WebGLState.prototype.uniformMatrix4fv=function(location,transpose,value){this._uniformLocation.hasOwnProperty(location._id)||(this._uniformLocation[location._id]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);var v0=this._uniformLocation[location._id];(v0[0]!==value[0]||v0[1]!==value[1]||v0[2]!==value[2]||v0[3]!==value[3]||v0[4]!==value[4]||v0[5]!==value[5]||v0[6]!==value[6]||v0[7]!==value[7]||v0[8]!==value[8]||v0[9]!==value[9]||v0[10]!==value[10]||v0[11]!==value[11]||v0[12]!==value[12]||v0[13]!==value[13]||v0[14]!==value[14]||v0[15]!==value[15])&&(this._gl.uniformMatrix4fv(location,transpose,value),this._uniformLocation[location._id]=value)},WebGLState.prototype.vertexAttribPointer=function(locationIndex,size,type,normalized,stride,offset){this._gl.vertexAttribPointer(locationIndex,size,type,normalized,stride,offset)},WebGLState.prototype.enableVertexAttribArray=function(locationIndex){this._attribArray.hasOwnProperty(locationIndex)||(this._attribArray[locationIndex]=!1),this._attribArray[locationIndex]||(this._attribArray[locationIndex]=!0,this._gl.enableVertexAttribArray(locationIndex))},WebGLState.prototype.disableVertexAttribArray=function(locationIndex){this._attribArray.hasOwnProperty(locationIndex)||(this._attribArray[locationIndex]=!1),this._attribArray[locationIndex]&&(this._attribArray[locationIndex]=!1,this._gl.disableVertexAttribArray(locationIndex))},WebGLState.prototype.setTexture=function(textureIndex,textureId){textureId!==this._currentTexture&&(this.activeTexture(this._gl.TEXTURE0),this.bindTexture(this._gl.TEXTURE_2D,textureId),this._currentTexture=textureId)},WebGLState}();render.WebGLState=WebGLState}(render=cc.render||(cc.render={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var transition;!function(_transition){var MoveAction=(cc.node.NodeDirtyFlags,cc.action.MoveAction),Interpolator=cc.action.Interpolator,Transition=function(){function Transition(duration,scene){this._transitionCallback=null,this._userTransitionCallback=null,this._duration=0,this._interpolator=Interpolator.Linear(!1,!1),this._sceneIn=null,this._duration=duration,this._sceneIn=scene}return Transition.prototype.initialize=function(){return this},Transition.prototype.onDirectorTransitionEnd=function(callback){return this._transitionCallback=callback,this},Transition.prototype.onTransitionEnd=function(callback){return this._userTransitionCallback=callback,this},Transition.prototype.setInterpolator=function(i){return this._interpolator=i,this},Transition.prototype.__setupActionCallbacks=function(actionIn,actionOut){var _this=this;actionIn.onStart(function(action,target){target.callOnEnter()}),actionIn.onEnd(function(action,target){_this._transitionCallback&&_this._transitionCallback(_this),_this._userTransitionCallback&&_this._userTransitionCallback(_this),target.callOnEnterTransitionDidFinish()}),actionOut&&(actionOut.onStart(function(action,target){target.callOnExitTransitionDidStart()}),actionOut.onEnd(function(action,target){target.callOnExit(),target.__clearFlag(8)}))},Transition}();_transition.Transition=Transition,function(TransitionMoveDirection){TransitionMoveDirection[TransitionMoveDirection.LEFT=0]="LEFT",TransitionMoveDirection[TransitionMoveDirection.RIGHT=1]="RIGHT",TransitionMoveDirection[TransitionMoveDirection.TOP=2]="TOP",TransitionMoveDirection[TransitionMoveDirection.BOTTOM=3]="BOTTOM"}(_transition.TransitionMoveDirection||(_transition.TransitionMoveDirection={}));var TransitionFade=(_transition.TransitionMoveDirection,function(_super){function TransitionFade(duration,scene){_super.call(this,duration,scene)}return __extends(TransitionFade,_super),TransitionFade.prototype.initialize=function(sceneIn,sceneOut){var actionIn=null,actionOut=null,director=null;return sceneIn.resetScene(),sceneIn.setAlpha(0),actionIn=cc.FadeIn.create(this._duration/1e3),this._interpolator&&actionIn.setInterpolator(this._interpolator),director=sceneIn.getParent(),director._scenesActionManager.scheduleActionForNode(sceneIn,actionIn),sceneOut&&(sceneOut.resetScene(),actionOut=cc.FadeOut.create(this._duration/1e3),director._scenesActionManager.scheduleActionForNode(sceneOut,actionOut)),this.__setupActionCallbacks(actionIn,actionOut),this},TransitionFade}(Transition));_transition.TransitionFade=TransitionFade;var TransitionMove=function(_super){function TransitionMove(duration,direction,scene){void 0===direction&&(direction=0),_super.call(this,duration,scene),this.direction=direction}return __extends(TransitionMove,_super),TransitionMove.prototype.initialize=function(sceneIn,sceneOut){var actionIn=null,actionOut=null,director=null,_inX=0,_inY=0;switch(this.direction){case 0:_inX=-sceneIn._contentSize.width;break;case 1:_inX=sceneIn._contentSize.width;break;case 2:_inY=-sceneIn._contentSize.height;break;case 3:_inY=sceneIn._contentSize.height}return sceneIn.resetScene().setPosition(_inX,_inY),actionIn=new MoveAction({from:{x:0,y:0},to:{x:-_inX,y:-_inY},relative:!0}).setDuration(this._duration),this._interpolator&&actionIn.setInterpolator(this._interpolator),director=sceneIn._parent,director._scenesActionManager.scheduleActionForNode(sceneIn,actionIn),sceneOut&&(sceneOut.resetScene(),actionOut=actionIn.clone(),director._scenesActionManager.scheduleActionForNode(sceneOut,actionOut)),this.__setupActionCallbacks(actionIn,actionOut),this},TransitionMove}(Transition);_transition.TransitionMove=TransitionMove;var TransitionSlideInL=function(_super){function TransitionSlideInL(duration,scene){_super.call(this,duration,0,scene)}return __extends(TransitionSlideInL,_super),TransitionSlideInL}(TransitionMove);_transition.TransitionSlideInL=TransitionSlideInL;var TransitionSlideInR=function(_super){function TransitionSlideInR(duration,scene){_super.call(this,duration,1,scene)}return __extends(TransitionSlideInR,_super),TransitionSlideInR}(TransitionMove);_transition.TransitionSlideInR=TransitionSlideInR;var TransitionSlideInT=function(_super){function TransitionSlideInT(duration,scene){_super.call(this,duration,2,scene)}return __extends(TransitionSlideInT,_super),TransitionSlideInT}(TransitionMove);_transition.TransitionSlideInT=TransitionSlideInT;var TransitionSlideInB=function(_super){function TransitionSlideInB(duration,scene){_super.call(this,duration,3,scene)}return __extends(TransitionSlideInB,_super),TransitionSlideInB}(TransitionMove);_transition.TransitionSlideInB=TransitionSlideInB}(transition=cc.transition||(cc.transition={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var render;!function(render){var shader;!function(shader){var idGenerator=function(){var index=0;return function(){return index++}}(),Uniform=function(){function Uniform(_name,_type,_value){this._name=_name,this._type=_type,this._value=_value,this._prevValue=null,this._location=null}return Uniform.prototype.setLocation=function(l){this._location=l,this._location._id=idGenerator()},Uniform.prototype.updateValue=function(gl){this._value!==this._prevValue&&(gl._gl["uniform"+this._type](this._location,this._value),this._prevValue=this._value)},Uniform.prototype.setValue=function(v){this._value=v},Uniform.createUniform=function(name,type,value){return"t"===type?new TextureUniform(name,type,value):"m4v"===type?new MatrixUniform(name,type,value):new Uniform(name,type,value)},Uniform}();shader.Uniform=Uniform;var TextureUniform=function(_super){function TextureUniform(name,type,value){_super.call(this,name,type,value)}return __extends(TextureUniform,_super),TextureUniform.prototype.updateValue=function(gl){this._value!==this._prevValue&&(gl.uniform1i(this._location,this._value),this._prevValue=this._value)},TextureUniform}(Uniform);shader.TextureUniform=TextureUniform;var MatrixUniform=function(_super){function MatrixUniform(name,type,value){_super.call(this,name,type,value),this._dirty=!0}return __extends(MatrixUniform,_super),MatrixUniform.prototype.setValue=function(v){_super.prototype.setValue.call(this,v),this._dirty=!0},MatrixUniform.prototype.updateValue=function(gl){this._dirty&&(gl.uniformMatrix4fv(this._location,!1,this._value),this._prevValue=this._value,this._dirty=!1)},MatrixUniform}(Uniform);shader.MatrixUniform=MatrixUniform}(shader=render.shader||(render.shader={}))}(render=cc.render||(cc.render={}))}(cc||(cc={}));var cc;!function(cc){var render;!function(render){var shader;!function(shader){var Attribute=function(){function Attribute(_name,_location){this._name=_name,this._location=_location}return Attribute.prototype.enable=function(gl){gl.enableVertexAttribArray(this._location)},Attribute.prototype.disable=function(gl){gl.disableVertexAttribArray(this._location)},Attribute}();shader.Attribute=Attribute}(shader=render.shader||(render.shader={}))}(render=cc.render||(cc.render={}))}(cc||(cc={}));var cc;!function(cc){var render;!function(render){var shader;!function(_shader){var Uniform=cc.render.shader.Uniform,Attribute=cc.render.shader.Attribute,AbstractShader=function(){function AbstractShader(_webglState,shaderDefinition){this._webglState=_webglState,this._uniforms=[],this._attributes=[],this._shaderProgram=null,this._uniformProjection=null,this.__initializeFromShaderDefinition(shaderDefinition)}return AbstractShader.prototype.enableAttributes=function(){for(var i=0;i<this._attributes.length;i++)this._attributes[i].enable(this._webglState);return this},AbstractShader.prototype.disableAttributes=function(){for(var i=0;i<this._attributes.length;i++)this._attributes[i].disable(this._webglState);return this},AbstractShader.prototype.__getShaderDef=function(def){return"[object Array]"===Object.prototype.toString.call(def)?def.join("\n"):def},AbstractShader.prototype.__initializeFromShaderDefinition=function(shaderDef){var gl=this._webglState._gl;if(this._shaderProgram=gl.createProgram(),gl.attachShader(this._shaderProgram,this.__getShader(gl,"x-shader/x-vertex",this.__getShaderDef(shaderDef.vertexShader))),gl.attachShader(this._shaderProgram,this.__getShader(gl,"x-shader/x-fragment",this.__getShaderDef(shaderDef.fragmentShader))),gl.linkProgram(this._shaderProgram),gl.getError()&&console.log(gl.getProgramInfoLog(this._shaderProgram)),this._webglState.useProgram(this._shaderProgram),shaderDef.uniforms)for(var uniformName in shaderDef.uniforms){var uniformDef=shaderDef.uniforms[uniformName],type=uniformDef.type,value=uniformDef.value,uniform=Uniform.createUniform(uniformName,type,value);uniform.setLocation(gl.getUniformLocation(this._shaderProgram,uniformName)),"undefined"!=typeof value&&null!==value&&(uniform.setValue(value),uniform.updateValue(this._webglState)),this._uniforms.push(uniform)}if(shaderDef.attributes)for(var i=0;i<shaderDef.attributes.length;i++){var attribute=new Attribute(shaderDef.attributes[i],gl.getAttribLocation(this._shaderProgram,shaderDef.attributes[i]));this._attributes.push(attribute)}},AbstractShader.prototype.__getShader=function(gl,type,str){var shader;if("x-shader/x-fragment"===type)shader=gl.createShader(gl.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!==type)return null;shader=gl.createShader(gl.VERTEX_SHADER)}return gl.shaderSource(shader,str),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS)?shader:(alert(gl.getShaderInfoLog(shader)),null)},AbstractShader.prototype.useProgram=function(){this._shaderProgram!==this._webglState._currentProgram&&(this._webglState.useProgram(this._shaderProgram),this.enableAttributes())},AbstractShader.prototype.notUseProgram=function(){this._shaderProgram===this._webglState._currentProgram&&this.disableAttributes()},AbstractShader.prototype.flushBuffersWithContent=function(){},AbstractShader.prototype.__updateUniformValues=function(){for(var i=0;i<this._uniforms.length;i++)this._uniforms[i].updateValue(this._webglState)},AbstractShader.prototype.findUniform=function(name){for(var i=0;i<this._uniforms.length;i++)if(this._uniforms[i]._name===name)return this._uniforms[i];
return null},AbstractShader.prototype.findAttribute=function(name){for(var i=0;i<this._attributes.length;i++)if(this._attributes[i]._name===name)return this._attributes[i];return null},AbstractShader.prototype.mat4_from_mat3=function(mat3,__mat4){return __mat4[0]=mat3[0],__mat4[4]=mat3[1],__mat4[1]=mat3[3],__mat4[5]=mat3[4],__mat4[12]=mat3[2],__mat4[13]=mat3[5],__mat4},AbstractShader}();_shader.AbstractShader=AbstractShader}(shader=render.shader||(render.shader={}))}(render=cc.render||(cc.render={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var render;!function(render){var shader;!function(shader){var AbstractShader=cc.render.shader.AbstractShader,SolidColorShader=function(_super){function SolidColorShader(gl){_super.call(this,gl,{vertexShader:"attribute vec2 aPosition; \nattribute vec4 aColor; \nuniform mat4 uProjection; \nuniform mat4 uTransform; \nvarying vec4 vAttrColor; \nvoid main(void) { \ngl_Position = uProjection * uTransform * vec4( aPosition.x, aPosition.y, 0.0, 1.0 );\nvAttrColor = aColor;\n}\n",fragmentShader:"precision mediump float; \nvarying vec4 vAttrColor;\nvoid main(void) { \n  gl_FragColor = vAttrColor; \n}\n",uniforms:{uProjection:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},uTransform:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},attributes:["aPosition","aColor"]}),this._uniformTransform=null,this._attributePosition=null,this._attributeColor=null,this._uniformProjection=this.findUniform("uProjection"),this._uniformTransform=this.findUniform("uTransform"),this._attributePosition=this.findAttribute("aPosition"),this._attributeColor=this.findAttribute("aColor"),SolidColorShader.mat.set([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return __extends(SolidColorShader,_super),SolidColorShader.prototype.flushBuffersWithContent=function(){this.__updateUniformValues();var gl=this._webglState;gl.vertexAttribPointer(this._attributePosition._location,2,gl._gl.FLOAT,!1,32,0),gl.vertexAttribPointer(this._attributeColor._location,4,gl._gl.FLOAT,!1,32,8)},SolidColorShader.mat=new Float32Array(16),SolidColorShader}(AbstractShader);shader.SolidColorShader=SolidColorShader}(shader=render.shader||(render.shader={}))}(render=cc.render||(cc.render={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var render;!function(render){var shader;!function(shader){var AbstractShader=cc.render.shader.AbstractShader,TextureShader=function(_super){function TextureShader(gl){return _super.call(this,gl,{vertexShader:"attribute vec2 aPosition; \nattribute vec4 aColor; \nattribute vec2 aTexture; \nuniform mat4 uProjection; \nuniform mat4 uTransform; \nvarying vec2 vTextureCoord; \nvarying vec4 vAttrColor; \nvoid main(void) { \ngl_Position = uProjection * uTransform * vec4( aPosition.x, aPosition.y, 0.0, 1.0 );\nvTextureCoord = aTexture;\nvAttrColor = aColor;\n}\n",fragmentShader:"precision mediump float; \nvarying vec2 vTextureCoord; \nuniform sampler2D uTextureSampler; \nvarying vec4 vAttrColor;\nvoid main(void) { \n  vec4 textureColor= texture2D(uTextureSampler, vec2(vTextureCoord)); \n  gl_FragColor = textureColor * vAttrColor; \n}\n",attributes:["aPosition","aColor","aTexture"],uniforms:{uProjection:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},uTransform:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},uTextureSampler:{type:"t",value:null}}}),this._uniformTransform=null,this._uniformTextureSampler=null,this._attributePosition=null,this._attributeTexture=null,this._attributeColor=null,this._uniformTextureSampler=this.findUniform("uTextureSampler"),this._uniformProjection=this.findUniform("uProjection"),this._uniformTransform=this.findUniform("uTransform"),this._attributePosition=this.findAttribute("aPosition"),this._attributeColor=this.findAttribute("aColor"),this._attributeTexture=this.findAttribute("aTexture"),TextureShader.mat[0]=1,TextureShader.mat[5]=1,TextureShader.mat[10]=1,TextureShader.mat[15]=1,this}return __extends(TextureShader,_super),TextureShader.prototype.flushBuffersWithContent=function(){this.__updateUniformValues();var gl=this._webglState;gl.vertexAttribPointer(this._attributePosition._location,2,gl._gl.FLOAT,!1,32,0),gl.vertexAttribPointer(this._attributeColor._location,4,gl._gl.FLOAT,!1,32,8),gl.vertexAttribPointer(this._attributeTexture._location,2,gl._gl.FLOAT,!1,32,24)},TextureShader.mat=new Float32Array(16),TextureShader}(AbstractShader);shader.TextureShader=TextureShader}(shader=render.shader||(render.shader={}))}(render=cc.render||(cc.render={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var render;!function(render){var shader;!function(shader){function __getPatternFragmentShader(){return["precision mediump float;","uniform vec4 uPatternImageBounds;","uniform sampler2D uSampler;","varying vec2 v_texCoord;","varying vec4 vColor;","void main() {","    gl_FragColor = texture2D(uSampler, mod(v_texCoord,(uPatternImageBounds.zw-uPatternImageBounds.xy))+ uPatternImageBounds.xy ) * vColor;","}"]}var TexturePatternShader=function(_super){function TexturePatternShader(gl){_super.call(this,gl,{vertexShader:["precision mediump float;","attribute vec2 aPosition;","attribute vec4 aColor;","uniform vec4 uPatternImageBounds;","uniform vec2 uPatternBounds;","uniform mat4 uProjection;","uniform mat4 uTransform;","uniform mat4 uPatternTransform;","varying vec2 v_texCoord;","varying vec4 vColor;","void main(void) {","vec4 avp= vec4( aPosition, 0, 1);","gl_Position = uProjection * uTransform * avp;","v_texCoord = (uPatternTransform * avp).xy / uPatternBounds * (uPatternImageBounds.zw-uPatternImageBounds.xy);","vColor= aColor;","}"],fragmentShader:__getPatternFragmentShader(),uniforms:{uPatternImageBounds:{type:"4fv",value:[0,0,0,0]},uPatternBounds:{type:"2fv",value:[0,0]},uProjection:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},uTransform:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},uPatternTransform:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},uSampler:{type:"t",value:null}},attributes:["aPosition","aColor"]}),this._uniformTransform=null,this._uniformPatternTransform=null,this._uniformPatternImageBounds=null,this._uniformPatternBounds=null,this._attributePosition=null,this._attributeColor=null,this._uniformProjection=this.findUniform("uProjection"),this._uniformTransform=this.findUniform("uTransform"),this._uniformPatternTransform=this.findUniform("uTransform"),this._uniformPatternImageBounds=this.findUniform("uPatternImageBounds"),this._uniformPatternBounds=this.findUniform("uPatternBounds"),this._attributePosition=this.findAttribute("aPosition"),this._attributeColor=this.findAttribute("aColor"),TexturePatternShader.mat.set([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return __extends(TexturePatternShader,_super),TexturePatternShader.prototype.flushBuffersWithContent=function(){this.__updateUniformValues();var gl=this._webglState;gl.vertexAttribPointer(this._attributePosition._location,2,gl._gl.FLOAT,!1,32,0),gl.vertexAttribPointer(this._attributeColor._location,4,gl._gl.FLOAT,!1,32,8)},TexturePatternShader.mat=new Float32Array(16),TexturePatternShader}(shader.AbstractShader);shader.TexturePatternShader=TexturePatternShader}(shader=render.shader||(render.shader={}))}(render=cc.render||(cc.render={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var render;!function(render){var shader;!function(shader){var FastTextureShader=function(_super){function FastTextureShader(gl){return _super.call(this,gl,{vertexShader:"precision lowp float; \nattribute vec2 aPosition; \nattribute vec4 aColor; \nattribute vec2 aTexture; \nattribute vec2 aAnchorPosition; \nattribute float aRotation; \nattribute vec2 aScale; \nuniform mat4 uProjection; \nvarying vec2 vTextureCoord; \nvarying vec4 vAttrColor; \nvoid main(void) { \nvec2 v;\nvec2 sv = aAnchorPosition * aScale; \nfloat _rotation= aRotation * 0.017453292519943295;\n v.x = sv.x * cos(_rotation) - sv.y * sin(_rotation); \n v.y = sv.x * sin(_rotation) + sv.y * cos(_rotation); \ngl_Position = uProjection * vec4( v + aPosition, 0.0, 1.0 );\nvTextureCoord = aTexture;\nvAttrColor = aColor;\n}\n",fragmentShader:"precision lowp float; \nvarying vec2 vTextureCoord; \nuniform sampler2D uTextureSampler; \nvarying vec4 vAttrColor;\nvoid main(void) { \n  gl_FragColor = texture2D(uTextureSampler,vTextureCoord) * vAttrColor; \n}\n",attributes:["aPosition","aColor","aTexture","aAnchorPosition","aRotation","aScale"],uniforms:{uProjection:{type:"m4v",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},uTextureSampler:{type:"t",value:null}}}),this._uniformTransform=null,this._uniformTextureSampler=null,this._attributePosition=null,this._attributeTexture=null,this._attributeColor=null,this._attributeAnchorPosition=null,this._attributeRotation=null,this._attributeScale=null,this._uniformTextureSampler=this.findUniform("uTextureSampler"),this._uniformProjection=this.findUniform("uProjection"),this._attributePosition=this.findAttribute("aPosition"),this._attributeColor=this.findAttribute("aColor"),this._attributeTexture=this.findAttribute("aTexture"),this._attributeAnchorPosition=this.findAttribute("aAnchorPosition"),this._attributeRotation=this.findAttribute("aRotation"),this._attributeScale=this.findAttribute("aScale"),FastTextureShader.mat[0]=1,FastTextureShader.mat[5]=1,FastTextureShader.mat[10]=1,FastTextureShader.mat[15]=1,this}return __extends(FastTextureShader,_super),FastTextureShader.prototype.flushBuffersWithContent=function(){this.__updateUniformValues();var gl=this._webglState;gl.vertexAttribPointer(this._attributePosition._location,2,gl._gl.FLOAT,!1,40,0),gl.vertexAttribPointer(this._attributeColor._location,4,gl._gl.UNSIGNED_BYTE,!0,40,8),gl.vertexAttribPointer(this._attributeTexture._location,2,gl._gl.FLOAT,!1,40,12),gl.vertexAttribPointer(this._attributeAnchorPosition._location,2,gl._gl.FLOAT,!1,40,20),gl.vertexAttribPointer(this._attributeRotation._location,1,gl._gl.FLOAT,!1,40,28),gl.vertexAttribPointer(this._attributeScale._location,2,gl._gl.FLOAT,!1,40,32)},FastTextureShader.mat=new Float32Array(16),FastTextureShader}(shader.AbstractShader);shader.FastTextureShader=FastTextureShader}(shader=render.shader||(render.shader={}))}(render=cc.render||(cc.render={}))}(cc||(cc={}));var cc;!function(cc){var render;!function(render){var shader;!function(shader){!function(){console.log("Buffers: in bufferData mode with whole buffer.")}();var Buffer=function(){function Buffer(_gl,_type,initialValue,usage){this._gl=_gl,this._type=_type,this._buffer=null,this._prevValue=null,this._usage=_gl.STATIC_DRAW,this._buffer=_gl.createBuffer(),initialValue&&(this._gl.bindBuffer(_type,this._buffer),this._gl.bufferData(_type,initialValue,usage))}return Buffer.prototype.enableWithValue=function(v){this._gl.bindBuffer(this._type,this._buffer),this._gl.bufferData(this._type,v,this._usage)},Buffer.prototype.forceEnableWithValue=function(v){this._gl.bindBuffer(this._type,this._buffer),this._gl.bufferData(this._type,v,this._usage)},Buffer}();shader.Buffer=Buffer}(shader=render.shader||(render.shader={}))}(render=cc.render||(cc.render={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var render;!function(render){function autodetectRenderer(w,h,elem){w=w||800,h=h||600;var webgl=function(){var canvas=document.createElement("canvas");try{return!("undefined"==typeof window.WebGLRenderingContext)&&(canvas.getContext("webgl")||canvas.getContext("experimental-webgl"))}catch(e){return!1}}();return webgl?new cc.render.WebGLRenderer(w,h,document.getElementById(elem)):new cc.render.CanvasRenderer(w,h,document.getElementById(elem))}function dc2d(renderer){var canvas=renderer._surface,c2d=canvas.getContext("2d");return c2d.flush=function(){this.setTransform(1,0,0,1,0,0)},Object.defineProperty(c2d,"type",{get:function(){return"canvas"},enumerable:!0,configurable:!0}),c2d.setFillStyleColor=function(color){this.fillStyle=color.getFillStyle()},c2d.setFillStyleColorArray=function(colorArray){this.fillStyle=new cc.math.Color(colorArray[0],colorArray[1],colorArray[2],colorArray[3]).getFillStyle()},c2d.setFillStylePattern=function(pattern){var _pattern=this.createPattern(pattern.texture._image,pattern.type);this.fillStyle=_pattern},c2d.setTintColor=function(){},c2d.clear=function(){this.setTransform(1,0,0,1,0,0),this.clearRect(0,0,this.getWidth(),this.getHeight())},c2d.getUnitsFactor=function(){return renderer.getUnitsFactor()},c2d.getWidth=function(){return this.canvas.width},c2d.getHeight=function(){return this.canvas.height},c2d.setCompositeOperation=function(o){this.globalCompositeOperation=cc.render.CompositeOperationToCanvas[o]},c2d.getCompositeOperation=function(){return cc.render.CanvasToComposite[this.globalCompositeOperation]},c2d.drawTexture=function(texture,sx,sy,sw,sh,dx,dy,dw,dh){var h;3===arguments.length?cc.render.RENDER_ORIGIN===cc.render.ORIGIN_BOTTOM?(h=sy+texture._image.height,this.translate(0,h),this.scale(1,-1),this.drawImage(texture._image,sx,0),this.scale(1,-1),this.translate(0,-h)):this.drawImage(texture._image,sx,sy):5===arguments.length?cc.render.RENDER_ORIGIN===cc.render.ORIGIN_BOTTOM?(h=sy+sh,this.translate(0,h),this.scale(1,-1),this.drawImage(texture._image,sx,0,sw,sh),this.scale(1,-1),this.translate(0,-h)):this.drawImage(texture._image,sx,sy,sw,sh):cc.render.RENDER_ORIGIN===cc.render.ORIGIN_BOTTOM?(h=dy+dh,this.translate(0,h),this.scale(1,-1),this.drawImage(texture._image,sx,sy,sw,sh,dx,0,dw,dh),this.scale(1,-1),this.translate(0,-h)):this.drawImage(texture._image,sx,sy,sw,sh,dx,dy,dw,dh)},c2d}render.ORIGIN_BOTTOM=1,render.ORIGIN_TOP=0,render.RENDER_ORIGIN=cc.render.ORIGIN_BOTTOM,render.autodetectRenderer=autodetectRenderer;var Dimension=cc.math.Dimension,Renderer=function(){function Renderer(w,h,surface){this._surface=null,this._renderingContext=null,this._dimension=new Dimension,this._addedToDOM=!1,this._scaleManager=null,this._onContentScaled=null,this._adjustContentToFullScreen=!1,this._preferredUnits=null,this._sceneHint=16,this._surface="undefined"!=typeof surface?surface:document.createElement("canvas"),this._surface.width="undefined"!=typeof w?w:800,this._surface.height="undefined"!=typeof h?h:600,this._preferredUnits=new Dimension,this._preferredUnits.set(w,h),this._dimension.set(w,h);var me=this;this._scaleManager=new cc.render.ScaleManager(this).onWindowResized(function(w,h){var uw=me._scaleManager._units.width,uh=me._scaleManager._units.height;me._adjustContentToFullScreen&&(w=window.innerWidth,h=window.innerHeight),me.setScaleContent(uw,uh,w,h)}),this._addedToDOM=surface?!0:!1}return Renderer.prototype.__calcPreferredUnits=function(){var d=new cc.math.Dimension,units=this.getScaleManager()._units;if(this.getScaleManager()._contentScaled){var ratio=Math.min(window.innerWidth/units.width,window.innerHeight/units.height);d.width=window.innerWidth/ratio,d.height=window.innerHeight/ratio}else d.width=units.width,d.height=units.height;return this._preferredUnits.set(d.width,d.height),d},Renderer.prototype.adjustContentToFullScreen=function(hint){return this._adjustContentToFullScreen=!0,this._sceneHint=hint,this},Renderer.prototype.onContentScaled=function(callback){return this._onContentScaled=callback,this},Renderer.prototype.isAddedToDOM=function(){return this._addedToDOM},Renderer.prototype.addToDOM=function(){this.isAddedToDOM()||(document.body.appendChild(this._surface),this._addedToDOM=!0)},Renderer.prototype.getRenderingContext=function(){return this._renderingContext},Renderer.prototype.render=function(node){node.visit(this._renderingContext)},Renderer.prototype.flush=function(){this._renderingContext.flush()},Renderer.prototype.getContentSize=function(){return this._dimension.clone()},Renderer.prototype.prepareTexture=function(){},Renderer.prototype.getScaleContentMatrix=function(){return this._scaleManager.getScaleContentMatrix()},Renderer.prototype.getScaleManager=function(){return this._scaleManager},Renderer.prototype.setScaleStrategy=function(ss,sp){this._scaleManager.setScale(ss,sp)},Renderer.prototype.setScaleContent=function(w,h,cw,ch){"undefined"!=typeof cw&&"undefined"!=typeof ch&&(cw/ch>w/h?cw=w*ch/h+1:ch=cw*h/w+1,cw=Math.ceil(cw),ch=Math.ceil(ch),this._adjustContentToFullScreen&&(cw=window.innerWidth,ch=window.innerHeight),this.__resize(cw>>0,ch>>0)),this._scaleManager.setScaleContent(w,h),this.__calcPreferredUnits();var ret=this._scaleManager.getUnitsFactor();return this._onContentScaled&&this._onContentScaled(w,h,this._preferredUnits.width,this._preferredUnits.height,cw,ch,this._sceneHint),ret},Renderer.prototype.getUnitsFactor=function(){return this._scaleManager.getUnitsFactor()},Renderer.prototype.setOrientationStrategy=function(os,onOk,onError){this._scaleManager.forceOrientation(os,onOk,onError)},Renderer.prototype.isFullScreenCapable=function(){return this._scaleManager.isFullScreenCapable()},Renderer.prototype.isFullScreen=function(){return this._scaleManager.isFullScreen()},Renderer.prototype.startFullScreen=function(f){this._scaleManager.startFullScreen(f)},Renderer.prototype.endFullScreen=function(f){this._scaleManager.endFullScreen(f)},Renderer.prototype.forceOrientation=function(os,onOk,onError){return this._scaleManager.forceOrientation(os,onOk,onError)},Renderer.prototype.checkOrientation=function(){return this._scaleManager.checkOrientation()},Renderer.prototype.__resize=function(w,h){this._surface.width=w,this._surface.height=h,this._dimension.width=w,this._dimension.height=h},Renderer.prototype.getType=function(){return""},Renderer}();render.Renderer=Renderer;var CanvasRenderer=function(_super){function CanvasRenderer(w,h,surface){_super.call(this,w,h,surface),this._renderingContext=dc2d(this),cc.plugin.asset.AssetManager.prepareTextures(this)}return __extends(CanvasRenderer,_super),Object.defineProperty(CanvasRenderer.prototype,"renderingContext",{get:function(){return this._renderingContext},enumerable:!0,configurable:!0}),Object.defineProperty(CanvasRenderer.prototype,"canvasContext",{get:function(){return this._renderingContext},enumerable:!0,configurable:!0}),CanvasRenderer.prototype.getCanvasContext=function(){return this._renderingContext},CanvasRenderer.prototype.__resize=function(w,h){_super.prototype.__resize.call(this,w,h),this._renderingContext=dc2d(this)},CanvasRenderer.prototype.getType=function(){return"canvas"},CanvasRenderer}(Renderer);render.CanvasRenderer=CanvasRenderer;var WebGLRenderer=function(_super){function WebGLRenderer(w,h,surface){_super.call(this,w,h,surface),this._webglState=null;var drc=new cc.render.DecoratedWebGLRenderingContext(this);this._webglState=drc._webglState,this._renderingContext=drc,cc.plugin.asset.AssetManager.prepareTextures(this)}return __extends(WebGLRenderer,_super),WebGLRenderer.prototype.getCanvasContext=function(){return this._webglState},Object.defineProperty(WebGLRenderer.prototype,"renderingContext",{get:function(){return this._renderingContext},enumerable:!0,configurable:!0}),Object.defineProperty(WebGLRenderer.prototype,"canvasContext",{get:function(){return this._webglState},enumerable:!0,configurable:!0}),WebGLRenderer.prototype.prepareTexture=function(texture){texture.__setAsGLTexture(this._webglState)},WebGLRenderer.prototype.__resize=function(w,h){_super.prototype.__resize.call(this,w,h),this._renderingContext.resize(),this._webglState=this._renderingContext._webglState},WebGLRenderer.prototype.getType=function(){return"webgl"},WebGLRenderer}(Renderer);render.WebGLRenderer=WebGLRenderer,render.RendererUtil={draw9Patch:function(ctx,frameName,x,y,w,h,patchData){var sf=cc.plugin.asset.AssetManager.getSpriteFrame(frameName);if(null!==sf){if("undefined"==typeof patchData)return void ctx.drawTexture(sf.getTexture(),0,0,sf.getWidth(),sf.getHeight(),x,y,w,h);patchData.left=patchData.left||0,patchData.top=patchData.top||0,patchData.right=patchData.right||0,patchData.bottom=patchData.bottom||0;var paddingW=patchData.left+patchData.right,paddingH=patchData.bottom+patchData.top,spriteBottomHeight=patchData.bottom,spriteTopHeight=patchData.top,spriteBottomY=sf.getHeight()-spriteBottomHeight,spriteMiddleHeight=sf.getHeight()-paddingH,spriteMiddleWidth=sf.getWidth()-paddingW,spriteLeftWidth=patchData.left,scaleFactor=ctx.getUnitsFactor(),topy=cc.render.RENDER_ORIGIN===cc.render.ORIGIN_TOP?y:y+h-spriteTopHeight/scaleFactor,bottomy=cc.render.RENDER_ORIGIN===cc.render.ORIGIN_TOP?y+h-spriteBottomHeight/scaleFactor:y,middley=cc.render.RENDER_ORIGIN===cc.render.ORIGIN_TOP?y+spriteTopHeight/scaleFactor:y+spriteBottomHeight/scaleFactor;patchData.left&&(patchData.top&&ctx.drawTexture(sf.getTexture(),0,0,spriteLeftWidth,spriteTopHeight,x,topy,spriteLeftWidth/scaleFactor,spriteTopHeight/scaleFactor),patchData.bottom&&ctx.drawTexture(sf.getTexture(),0,spriteBottomY,spriteLeftWidth,spriteBottomHeight,x,bottomy,spriteLeftWidth/scaleFactor,spriteBottomHeight/scaleFactor),ctx.drawTexture(sf.getTexture(),0,patchData.top,spriteLeftWidth,spriteMiddleHeight,x,middley,spriteLeftWidth/scaleFactor,h-paddingH/scaleFactor)),patchData.right&&(patchData.top&&ctx.drawTexture(sf.getTexture(),sf.getWidth()-patchData.right,0,spriteLeftWidth,spriteTopHeight,x+w-patchData.right/scaleFactor,topy,spriteLeftWidth/scaleFactor,spriteTopHeight/scaleFactor),patchData.bottom&&ctx.drawTexture(sf.getTexture(),sf.getWidth()-patchData.right,spriteBottomY,spriteLeftWidth,spriteBottomHeight,x+w-patchData.right/scaleFactor,bottomy,spriteLeftWidth/scaleFactor,spriteBottomHeight/scaleFactor),ctx.drawTexture(sf.getTexture(),sf.getWidth()-patchData.right,patchData.top,spriteLeftWidth,spriteMiddleHeight,x+w-patchData.right/scaleFactor,middley,spriteLeftWidth/scaleFactor,h-paddingH/scaleFactor)),patchData.top&&ctx.drawTexture(sf.getTexture(),patchData.left,0,spriteMiddleWidth,spriteTopHeight,x+patchData.left/scaleFactor,topy,w-paddingW/scaleFactor,spriteTopHeight/scaleFactor),patchData.bottom&&ctx.drawTexture(sf.getTexture(),patchData.left,spriteBottomY,spriteMiddleWidth,spriteBottomHeight,x+patchData.left/scaleFactor,bottomy,w-paddingW/scaleFactor,spriteBottomHeight/scaleFactor),ctx.drawTexture(sf.getTexture(),patchData.left,patchData.top,spriteMiddleWidth,spriteMiddleHeight,x+patchData.left/scaleFactor,middley,w-paddingW/scaleFactor,h-paddingH/scaleFactor)}}}}(render=cc.render||(cc.render={}))}(cc||(cc={}));var cc;!function(cc){var render;!function(render){var Pattern=function(){function Pattern(texture,type){this._texture=null,this._type="repeat",this._texture=texture,this._type=type}return Object.defineProperty(Pattern.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),Object.defineProperty(Pattern.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Pattern}();render.Pattern=Pattern,function(CompositeOperation){CompositeOperation[CompositeOperation.source_over=0]="source_over",CompositeOperation[CompositeOperation.source_out=1]="source_out",CompositeOperation[CompositeOperation.source_in=2]="source_in",CompositeOperation[CompositeOperation.source_atop=3]="source_atop",CompositeOperation[CompositeOperation.destination_over=4]="destination_over",CompositeOperation[CompositeOperation.destination_in=5]="destination_in",CompositeOperation[CompositeOperation.destination_out=6]="destination_out",CompositeOperation[CompositeOperation.destination_atop=7]="destination_atop",CompositeOperation[CompositeOperation.multiply=8]="multiply",CompositeOperation[CompositeOperation.screen=9]="screen",CompositeOperation[CompositeOperation.copy=10]="copy",CompositeOperation[CompositeOperation.lighter=11]="lighter",CompositeOperation[CompositeOperation.darker=12]="darker",CompositeOperation[CompositeOperation.xor=13]="xor",CompositeOperation[CompositeOperation.add=14]="add"}(render.CompositeOperation||(render.CompositeOperation={}));render.CompositeOperation;render.CanvasToComposite={"source-over":0,"source-out":1,"source-in":2,"source-atop":3,"destination-over":4,"destination-in":5,"destination-out":6,"destination-atop":7,multiply:8,screen:9,copy:10,lighter:11,darker:12,xor:13,add:14},render.CompositeOperationToCanvas=["source-over","source-out","source-in","source-atop","destination-over","destination-in","destination-out","destination-atop","multiply","screen","copy","lighter","darker","xor","lighter"]}(render=cc.render||(cc.render={}))}(cc||(cc={}));var cc;!function(cc){var render;!function(render){var Matrix3=cc.math.Matrix3,RenderingContextSnapshot=function(){function RenderingContextSnapshot(){this._globalCompositeOperation=0,this._currentMatrix=new Float32Array([1,0,0,0,1,0,0,0,1]),this._globalAlpha=1,this._miterLimit=10,this._currentFillStyleType=0,this._fillStyleColor=new Float32Array([0,0,0,1]),this._fillStylePattern=null,this._tintColor=new Float32Array([0,0,0,1]),this._lineWidth=1,this._fontDefinition="10px sans-serif",this._textBaseline="alphabetic",this._textAlign="left",this._currentPath=null,this._clippingStack=[]}return RenderingContextSnapshot.prototype.clone=function(){var rcs=new RenderingContextSnapshot;return rcs._globalCompositeOperation=this._globalCompositeOperation,rcs._globalAlpha=this._globalAlpha,Matrix3.copy(rcs._currentMatrix,this._currentMatrix),rcs._fillStyleColor=this._fillStyleColor,rcs._fillStylePattern=this._fillStylePattern,rcs._currentFillStyleType=this._currentFillStyleType,rcs._tintColor=this._tintColor,rcs._lineWidth=this._lineWidth,rcs._miterLimit=this._miterLimit,rcs._fontDefinition=this._fontDefinition,rcs._textBaseline=this._textBaseline,rcs._textAlign=this._textAlign,rcs._clippingStack=this._clippingStack,rcs},RenderingContextSnapshot}();render.RenderingContextSnapshot=RenderingContextSnapshot}(render=cc.render||(cc.render={}))}(cc||(cc={}));var cc;!function(_cc){var render;!function(render){var Matrix3=cc.math.Matrix3,Buffer=cc.render.shader.Buffer,__vv={x:0,y:0},GeometryBatcher=(new Uint8Array([0,0,0,0]),function(){function GeometryBatcher(glstate){this._glDataBuffers=[],this._glIndexBuffers=[],this._currentBuffersIndex=0,this._dataArrayBuffer=null,this._dataBufferFloat=null,this._dataBufferByte=null,this._dataBufferUint=null,this._dataBufferIndex=0,this._indexBuffer=null,this._indexBufferIndex=0,this._gl=null,this._gl=glstate._gl,this._dataArrayBuffer=new ArrayBuffer(40*GeometryBatcher.MAX_QUADS*4),this._dataBufferFloat=new Float32Array(this._dataArrayBuffer),this._dataBufferByte=new Uint8Array(this._dataArrayBuffer),this._dataBufferUint=new Uint32Array(this._dataArrayBuffer),this._indexBuffer=new Uint16Array(6*GeometryBatcher.MAX_QUADS);for(var indexBufferIndex=0,elementIndex=0,indexBuffer=this._indexBuffer,i=0;i<GeometryBatcher.MAX_QUADS;i++)indexBuffer[indexBufferIndex]=elementIndex,indexBuffer[indexBufferIndex+1]=elementIndex+1,indexBuffer[indexBufferIndex+2]=elementIndex+2,indexBuffer[indexBufferIndex+3]=elementIndex,indexBuffer[indexBufferIndex+4]=elementIndex+2,indexBuffer[indexBufferIndex+5]=elementIndex+3,indexBufferIndex+=6,elementIndex+=4;this._glDataBuffers.push(new Buffer(this._gl,this._gl.ARRAY_BUFFER,this._dataBufferFloat,this._gl.DYNAMIC_DRAW)),this._glDataBuffers.push(new Buffer(this._gl,this._gl.ARRAY_BUFFER,this._dataBufferFloat,this._gl.DYNAMIC_DRAW)),this._glDataBuffers.push(new Buffer(this._gl,this._gl.ARRAY_BUFFER,this._dataBufferFloat,this._gl.DYNAMIC_DRAW)),this._glDataBuffers.push(new Buffer(this._gl,this._gl.ARRAY_BUFFER,this._dataBufferFloat,this._gl.DYNAMIC_DRAW)),this._glIndexBuffers.push(new Buffer(this._gl,this._gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer,this._gl.STATIC_DRAW)),this._glIndexBuffers.push(new Buffer(this._gl,this._gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer,this._gl.STATIC_DRAW)),this._glIndexBuffers.push(new Buffer(this._gl,this._gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer,this._gl.STATIC_DRAW)),this._glIndexBuffers.push(new Buffer(this._gl,this._gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer,this._gl.STATIC_DRAW)),this._glDataBuffer=this._glDataBuffers[0],this._glIndexBuffer=this._glIndexBuffers[0]}return GeometryBatcher.prototype.batchRectGeometryWithTexture=function(vertices,u0,v0,u1,v1,rcs){var tint=rcs._tintColor,r=tint[0],g=tint[1],b=tint[2],a=tint[3]*rcs._globalAlpha;return this.batchVertex(vertices[0],r,g,b,a,u0,v0),this.batchVertex(vertices[1],r,g,b,a,u1,v0),this.batchVertex(vertices[2],r,g,b,a,u1,v1),this.batchVertex(vertices[3],r,g,b,a,u0,v1),this._indexBufferIndex+=6,this._dataBufferIndex+32>=this._dataBufferFloat.length},GeometryBatcher.prototype.batchRectWithTexture=function(x,y,w,h,rcs,u0,v0,u1,v1){var tint=rcs._tintColor,r=tint[0],g=tint[1],b=tint[2],a=tint[3]*rcs._globalAlpha,cm=rcs._currentMatrix;return __vv.x=x,__vv.y=y,this.batchVertex(Matrix3.transformPoint(cm,__vv),r,g,b,a,u0,v0),__vv.x=x+w,__vv.y=y,this.batchVertex(Matrix3.transformPoint(cm,__vv),r,g,b,a,u1,v0),__vv.x=x+w,__vv.y=y+h,this.batchVertex(Matrix3.transformPoint(cm,__vv),r,g,b,a,u1,v1),__vv.x=x,__vv.y=y+h,this.batchVertex(Matrix3.transformPoint(cm,__vv),r,g,b,a,u0,v1),this._indexBufferIndex+=6,this._dataBufferIndex+32>=this._dataBufferFloat.length},GeometryBatcher.prototype.batchRect=function(x,y,w,h,rcs){var color=rcs._fillStyleColor,tint=rcs._tintColor,r=color[0]*tint[0],g=color[1]*tint[1],b=color[2]*tint[2],a=color[3]*tint[3]*rcs._globalAlpha,cm=rcs._currentMatrix;return __vv.x=x,__vv.y=y,this.batchVertex(Matrix3.transformPoint(cm,__vv),r,g,b,a,0,0),__vv.x=x+w,__vv.y=y,this.batchVertex(Matrix3.transformPoint(cm,__vv),r,g,b,a,0,0),__vv.x=x+w,__vv.y=y+h,this.batchVertex(Matrix3.transformPoint(cm,__vv),r,g,b,a,0,0),__vv.x=x,__vv.y=y+h,this.batchVertex(Matrix3.transformPoint(cm,__vv),r,g,b,a,0,0),this._indexBufferIndex+=6,this._dataBufferIndex+32>=this._dataBufferFloat.length},GeometryBatcher.prototype.batchVertex=function(p,r,g,b,a,u,v){this._dataBufferFloat[this._dataBufferIndex++]=p.x,this._dataBufferFloat[this._dataBufferIndex++]=p.y,this._dataBufferFloat[this._dataBufferIndex++]=r,this._dataBufferFloat[this._dataBufferIndex++]=g,this._dataBufferFloat[this._dataBufferIndex++]=b,this._dataBufferFloat[this._dataBufferIndex++]=a,this._dataBufferFloat[this._dataBufferIndex++]=u,this._dataBufferFloat[this._dataBufferIndex++]=v},GeometryBatcher.prototype.flush=function(shader,rcs){this._indexBufferIndex&&(this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._glIndexBuffer._buffer),this._glDataBuffer.forceEnableWithValue(this._dataBufferFloat.subarray(0,this._dataBufferIndex)),shader.flushBuffersWithContent(rcs),this._gl.drawElements(this._gl.TRIANGLES,this._indexBufferIndex,this._gl.UNSIGNED_SHORT,0),this._dataBufferIndex=0,this._indexBufferIndex=0,this._currentBuffersIndex=this._currentBuffersIndex+1&3,this._glDataBuffer=this._glDataBuffers[this._currentBuffersIndex],this._glIndexBuffer=this._glIndexBuffers[this._currentBuffersIndex])},GeometryBatcher.prototype.__uintColor=function(rcs){var tint=rcs._tintColor,r=255*tint[0]|0,g=255*tint[1]|0,b=255*tint[2]|0,a=tint[3]*rcs._globalAlpha*255|0;return r|g<<8|b<<16|a<<24},GeometryBatcher.prototype.batchRectGeometryWithSpriteFast=function(sprite,u0,v0,u1,v1,rcs){var cc=this.__uintColor(rcs),db=this._dataBufferFloat,dbuint=this._dataBufferUint,dbi=this._dataBufferIndex;dbuint[dbi+2]=dbuint[dbi+12]=dbuint[dbi+22]=dbuint[dbi+32]=cc,db[dbi]=db[dbi+10]=db[dbi+20]=db[dbi+30]=sprite.x,db[dbi+1]=db[dbi+11]=db[dbi+21]=db[dbi+31]=sprite.y,db[dbi+7]=db[dbi+17]=db[dbi+27]=db[dbi+37]=sprite.rotationAngle,db[dbi+8]=db[dbi+18]=db[dbi+28]=db[dbi+38]=sprite.scaleX,db[dbi+9]=db[dbi+19]=db[dbi+29]=db[dbi+39]=sprite.scaleY;
var w0=sprite.width/2,w1=-w0,h1=sprite.height/2,h0=-h1;return db[dbi+3]=u0,db[dbi+4]=v0,db[dbi+5]=w0,db[dbi+6]=h0,db[dbi+13]=u1,db[dbi+14]=v0,db[dbi+15]=w1,db[dbi+16]=h0,db[dbi+23]=u1,db[dbi+24]=v1,db[dbi+25]=w1,db[dbi+26]=h1,db[dbi+33]=u0,db[dbi+34]=v1,db[dbi+35]=w0,db[dbi+36]=h1,this._indexBufferIndex+=6,this._dataBufferIndex+=40,this._dataBufferIndex+40>=this._dataBufferFloat.length},GeometryBatcher.MAX_QUADS=26214,GeometryBatcher}());render.GeometryBatcher=GeometryBatcher}(render=_cc.render||(_cc.render={}))}(cc||(cc={}));var cc;!function(cc){var render;!function(render){var RenderingContextSnapshot=cc.render.RenderingContextSnapshot,GeometryBatcher=cc.render.GeometryBatcher,SolidColorShader=cc.render.shader.SolidColorShader,TextureShader=cc.render.shader.TextureShader,TexturePatternShader=cc.render.shader.TexturePatternShader,FastTextureShader=cc.render.shader.FastTextureShader,Matrix3=cc.math.Matrix3,WebGLState=cc.render.WebGLState;!function(FillStyleType){FillStyleType[FillStyleType.COLOR=0]="COLOR",FillStyleType[FillStyleType.IMAGE=1]="IMAGE",FillStyleType[FillStyleType.IMAGEFAST=2]="IMAGEFAST",FillStyleType[FillStyleType.PATTERN_REPEAT=3]="PATTERN_REPEAT"}(render.FillStyleType||(render.FillStyleType={}));render.FillStyleType;!function(ShaderType){ShaderType[ShaderType.COLOR=0]="COLOR",ShaderType[ShaderType.IMAGE=1]="IMAGE",ShaderType[ShaderType.IMAGEFAST=2]="IMAGEFAST",ShaderType[ShaderType.PATTERN_REPEAT=3]="PATTERN_REPEAT"}(render.ShaderType||(render.ShaderType={}));render.ShaderType;!function(WEBGL_FLAGS){WEBGL_FLAGS[WEBGL_FLAGS.BLEND=1]="BLEND",WEBGL_FLAGS[WEBGL_FLAGS.DEPTH_TEST=2]="DEPTH_TEST",WEBGL_FLAGS[WEBGL_FLAGS.CULL_FACE=4]="CULL_FACE"}(render.WEBGL_FLAGS||(render.WEBGL_FLAGS={}));var __mat3=(render.WEBGL_FLAGS,new Float32Array([1,0,0,0,1,0,0,0,1])),DecoratedWebGLRenderingContext=function(){function DecoratedWebGLRenderingContext(r){this._currentContextSnapshot=null,this._contextSnapshots=[],this._currentFillStyleColor=new Float32Array([0,0,0,1]),this._currentFillStylePattern=null,this._currentFillStyleType=0,this._currentTintColor=new Float32Array([1,1,1,1]),this._currentGlobalCompositeOperation=0,this._shaders=[],this._batcher=null,this._webglState=null,this._width=0,this._height=0,this._renderer=null,this._canvas=null,this._renderer=r,this._canvas=r._surface,this.__initContext(),this._batcher=new GeometryBatcher(this._webglState),this._currentContextSnapshot=new RenderingContextSnapshot,this._contextSnapshots.push(this._currentContextSnapshot),this.__createRenderingShaders(this._canvas.width,this._canvas.height),this.__setGlobalCompositeOperation()}return DecoratedWebGLRenderingContext.prototype.__initContext=function(){function createContext(){var _gl=null;try{var obj={premultipliedAlpha:DecoratedWebGLRenderingContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL,antialias:DecoratedWebGLRenderingContext.ANTIALIAS,alpha:DecoratedWebGLRenderingContext.CTX_ALPHA,stencil:!0};_gl=_canvas.getContext("webgl",obj)||_canvas.getContext("experimental-webgl",obj),_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,DecoratedWebGLRenderingContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL?1:0)}catch(e){alert("WebGL context error")}return _gl}function initializeContext(webglState){var _gl=webglState._gl;webglState.clearColor(0,0,0,0),webglState.disable(_gl.DEPTH_TEST),webglState.disable(_gl.CULL_FACE),webglState.clear(_gl.COLOR_BUFFER_BIT),webglState.viewport(0,0,_canvas.width,_canvas.height)}var _canvas=this._canvas;this._width=this._canvas.width,this._height=this._canvas.height,this._webglState=new WebGLState(createContext()),initializeContext(this._webglState)},DecoratedWebGLRenderingContext.prototype.clear=function(){var gl=this._webglState,flags=gl._gl.COLOR_BUFFER_BIT;gl.flagEnabled(gl._gl.STENCIL_TEST)&&(flags|=gl._gl.STENCIL_BUFFER_BIT),gl.clear(flags)},DecoratedWebGLRenderingContext.prototype.getWidth=function(){return this._width},DecoratedWebGLRenderingContext.prototype.getHeight=function(){return this._height},DecoratedWebGLRenderingContext.prototype.__createProjection=function(w,h){function createOrthographicProjectionMatrix(left,right,bottom,top,znear,zfar){var tx=-(right+left)/(right-left),ty=-(top+bottom)/(top-bottom),tz=-(zfar+znear)/(zfar-znear);return new Float32Array([2/(right-left),0,0,0,0,2/(top-bottom),0,0,0,0,-2/(zfar-znear),0,tx,ty,tz,1])}var opm=[];return opm.push(createOrthographicProjectionMatrix(0,w,h,0,-1,1)),opm.push(createOrthographicProjectionMatrix(0,w,0,h,-1,1)),opm},DecoratedWebGLRenderingContext.prototype.__createRenderingShaders=function(w,h){this._shaders.push(new SolidColorShader(this._webglState)),this._shaders.push(new TextureShader(this._webglState)),this._shaders.push(new FastTextureShader(this._webglState)),this._shaders.push(new TexturePatternShader(this._webglState)),this.__setShadersProjection(w,h),this._shaders[0].useProgram()},DecoratedWebGLRenderingContext.prototype.__setShadersProjection=function(w,h){var opms=this.__createProjection(w,h),opm=opms[0],opm_inverse=opms[1];this._shaders[0]._uniformProjection.setValue(opm),this._shaders[1]._uniformProjection.setValue(opm),this._shaders[2]._uniformProjection.setValue(cc.render.RENDER_ORIGIN===cc.render.ORIGIN_TOP?opm:opm_inverse),this._shaders[3]._uniformProjection.setValue(opm)},Object.defineProperty(DecoratedWebGLRenderingContext.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),DecoratedWebGLRenderingContext.prototype.setTintColor=function(color){this._currentTintColor=color._color},Object.defineProperty(DecoratedWebGLRenderingContext.prototype,"tintColor",{set:function(color){this._currentTintColor=color._color},enumerable:!0,configurable:!0}),Object.defineProperty(DecoratedWebGLRenderingContext.prototype,"globalAlpha",{get:function(){return this._currentContextSnapshot._globalAlpha},set:function(v){this._currentContextSnapshot._globalAlpha=v},enumerable:!0,configurable:!0}),DecoratedWebGLRenderingContext.prototype.setCompositeOperation=function(gco){this._currentGlobalCompositeOperation=gco},DecoratedWebGLRenderingContext.prototype.getCompositeOperation=function(){return this._currentGlobalCompositeOperation},DecoratedWebGLRenderingContext.prototype.__setGlobalCompositeOperation=function(){var gl=this._webglState._gl;switch(this._webglState.enable(gl.BLEND),this._currentGlobalCompositeOperation){case 0:gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);break;case 1:gl.blendFunc(gl.ONE_MINUS_DST_ALPHA,gl.ZERO);break;case 2:gl.blendFunc(gl.DST_ALPHA,gl.ZERO);break;case 3:gl.blendFunc(gl.DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA);break;case 4:gl.blendFunc(gl.ONE_MINUS_DST_ALPHA,gl.DST_ALPHA);break;case 5:gl.blendFunc(gl.ZERO,gl.SRC_ALPHA);break;case 6:gl.blendFunc(gl.ZERO,gl.ONE_MINUS_SRC_ALPHA);break;case 7:gl.blendFunc(gl.ONE_MINUS_DST_ALPHA,gl.SRC_ALPHA);break;case 8:gl.blendFunc(gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA);break;case 9:gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_COLOR);break;case 10:gl.blendFunc(gl.ONE,gl.ZERO);break;case 11:gl.blendFunc(gl.ONE,gl.ONE);break;case 12:gl.blendFunc(gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA);break;case 13:gl.blendFunc(gl.ONE_MINUS_DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA);break;case 14:gl.blendFunc(gl.SRC_ALPHA,gl.DST_ALPHA);break;default:gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)}this._currentContextSnapshot._globalCompositeOperation=this._currentGlobalCompositeOperation},DecoratedWebGLRenderingContext.prototype.setTransform=function(a,b,c,d,tx,ty){Matrix3.setTransform(this._currentContextSnapshot._currentMatrix,a,b,c,d,tx,ty)},DecoratedWebGLRenderingContext.prototype.transform=function(a,b,c,d,tx,ty){Matrix3.transform(this._currentContextSnapshot._currentMatrix,a,b,c,d,tx,ty)},DecoratedWebGLRenderingContext.prototype.fillRect=function(x,y,w,h){0>=w||0>=h||(this.__flushFillRectIfNeeded(),this._batcher.batchRect(x,y,w,h,this._currentContextSnapshot)&&this.flush())},DecoratedWebGLRenderingContext.prototype.drawTexture=function(texture,sx,sy,sw,sh,dx,dy,dw,dh){var ti=texture,textureId=ti._glId;null===textureId&&(cc.Debug.warn(" --- lazy image to texture call.  --- deprecated and dangerous."),ti.__setAsGLTexture(this._webglState),textureId=ti._glId),this.__drawImageFlushIfNeeded(textureId);var _sx,_sy,_sw,_sh,_dx,_dy,_dw,_dh;arguments.length>=9?(ti._invertedY&&(sy=ti._imageHeight-(ti._offsetY+sy)-sh),_sy=(sy+ti._offsetY)/ti._textureHeight,_sx=(sx+ti._offsetX)/ti._textureWidth,_sw=(sx+sw+ti._offsetX)/ti._textureWidth,_sh=(sy+sh+ti._offsetY)/ti._textureHeight,_dx=dx,_dy=dy,_dw=dw,_dh=dh):arguments.length>=5?(_dx=sx,_dy=sy,_dw=sw,_dh=sh,_sx=ti._u0,_sy=ti._v0,_sw=ti._u1,_sh=ti._v1):(_dx=sx,_dy=sy,_dw=ti._imageWidth,_dh=ti._imageHeight,_sx=ti._u0,_sy=ti._v0,_sw=ti._u1,_sh=ti._v1),this._batcher.batchRectWithTexture(_dx,_dy,_dw,_dh,this._currentContextSnapshot,_sx,_sy,_sw,_sh)&&this.flush()},DecoratedWebGLRenderingContext.prototype.batchGeometryWithSprite=function(sprite,transposed){var frame=sprite._spriteFrame,rect=frame._normalizedRect,u0=rect.x,v0=rect.y,u1=rect.x1,v1=rect.y1;if(sprite.flippedX){var itmp=u0;u0=u1,u1=itmp}if(sprite.flippedY){var itmp=v0;v0=v1,v1=itmp}this.__drawImageFlushIfNeeded(frame._texture._glId),this._batcher.batchRectGeometryWithTexture(sprite._BBVertices,u0,v0,u1,v1,this._currentContextSnapshot)&&this.flush()},DecoratedWebGLRenderingContext.prototype.batchGeometryWithSpriteFast=function(sprite){var frame=sprite._spriteFrame,rect=frame._normalizedRect,u0=rect.x,v0=rect.y,u1=rect.x1,v1=rect.y1;if(sprite.flippedX){var itmp=u0;u0=u1,u1=itmp}if(sprite.flippedY){var itmp=v0;v0=v1,v1=itmp}this.__drawImageFastFlushIfNeeded(frame._texture._glId),this._batcher.batchRectGeometryWithSpriteFast(sprite,u0,v0,u1,v1,this._currentContextSnapshot)&&this.flush()},DecoratedWebGLRenderingContext.prototype.translate=function(x,y){Matrix3.setTranslate(__mat3,x,y),Matrix3.multiply(this._currentContextSnapshot._currentMatrix,__mat3)},DecoratedWebGLRenderingContext.prototype.rotate=function(angle){Matrix3.setRotate(__mat3,angle),Matrix3.multiply(this._currentContextSnapshot._currentMatrix,__mat3)},DecoratedWebGLRenderingContext.prototype.scale=function(x,y){Matrix3.setScale(__mat3,x,y),Matrix3.multiply(this._currentContextSnapshot._currentMatrix,__mat3)},DecoratedWebGLRenderingContext.prototype.flush=function(){this._batcher.flush(this._shaders[this._currentContextSnapshot._currentFillStyleType],this._currentContextSnapshot)},DecoratedWebGLRenderingContext.prototype.resize=function(){this.__initContext(),this.__setShadersProjection(this._canvas.width,this._canvas.height)},DecoratedWebGLRenderingContext.prototype.getUnitsFactor=function(){return this._renderer.getUnitsFactor()},Object.defineProperty(DecoratedWebGLRenderingContext.prototype,"type",{get:function(){return"webgl"},enumerable:!0,configurable:!0}),DecoratedWebGLRenderingContext.prototype.__drawImageFastFlushIfNeeded=function(textureId){this.__drawImageFlushIfNeededImpl(2,this._shaders[2],textureId)},DecoratedWebGLRenderingContext.prototype.__drawImageFlushIfNeeded=function(textureId){this.__drawImageFlushIfNeededImpl(1,this._shaders[1],textureId)},DecoratedWebGLRenderingContext.prototype.__drawImageFlushIfNeededImpl=function(fillStyleType,shader,textureId){this._currentContextSnapshot._currentFillStyleType!==fillStyleType?(this.flush(),this.__setCurrentFillStyleType(fillStyleType),this._currentContextSnapshot._tintColor=this._currentTintColor,shader._uniformTextureSampler.setValue(0),this._webglState.setTexture(0,textureId)):(this._webglState._currentTexture!==textureId&&(this.flush(),shader._uniformTextureSampler.setValue(0),this._webglState.setTexture(0,textureId)),this._currentContextSnapshot._tintColor=this._currentTintColor,this.__compositeFlushIfNeeded())},DecoratedWebGLRenderingContext.prototype.__flushFillRectIfNeeded=function(){this._currentContextSnapshot._currentFillStyleType!==this._currentFillStyleType&&(this.flush(),this.__setCurrentFillStyleType(this._currentFillStyleType)),this._currentContextSnapshot._fillStyleColor=this._currentFillStyleColor,this._currentContextSnapshot._fillStylePattern=this._currentFillStylePattern,this._currentContextSnapshot._tintColor=this._currentTintColor},DecoratedWebGLRenderingContext.prototype.__compositeFlushIfNeeded=function(){this._currentGlobalCompositeOperation!==this._currentContextSnapshot._globalCompositeOperation&&(this.flush(),this.__setGlobalCompositeOperation())},DecoratedWebGLRenderingContext.prototype.__setCurrentFillStyleType=function(f){this._shaders[this._currentContextSnapshot._currentFillStyleType].notUseProgram(),this._shaders[f].useProgram(),this._currentContextSnapshot._currentFillStyleType=f,this._currentFillStyleType=f},DecoratedWebGLRenderingContext.prototype.setFillStyleColor=function(color){this._currentFillStyleColor=color._color,this._currentFillStyleType=0},DecoratedWebGLRenderingContext.prototype.setFillStyleColorArray=function(colorArray){this._currentFillStyleColor=colorArray,this._currentFillStyleType=0},DecoratedWebGLRenderingContext.prototype.setFillStylePattern=function(pattern){this._currentFillStyleType=3,this._currentFillStylePattern=pattern},DecoratedWebGLRenderingContext.prototype.beginPath=function(){},DecoratedWebGLRenderingContext.prototype.stroke=function(){},DecoratedWebGLRenderingContext.prototype.moveTo=function(){},DecoratedWebGLRenderingContext.prototype.lineTo=function(){},DecoratedWebGLRenderingContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL=!1,DecoratedWebGLRenderingContext.ANTIALIAS=!1,DecoratedWebGLRenderingContext.CTX_ALPHA=!1,DecoratedWebGLRenderingContext}();render.DecoratedWebGLRenderingContext=DecoratedWebGLRenderingContext}(render=cc.render||(cc.render={}))}(cc||(cc={}));var cc;!function(cc){var render;!function(render){!function(ScaleContentSceneHint){ScaleContentSceneHint[ScaleContentSceneHint.TOP=1]="TOP",ScaleContentSceneHint[ScaleContentSceneHint.LEFT=2]="LEFT",ScaleContentSceneHint[ScaleContentSceneHint.BOTTOM=4]="BOTTOM",ScaleContentSceneHint[ScaleContentSceneHint.RIGHT=8]="RIGHT",ScaleContentSceneHint[ScaleContentSceneHint.CENTER=16]="CENTER",ScaleContentSceneHint[ScaleContentSceneHint.STRETCH=32]="STRETCH"}(render.ScaleContentSceneHint||(render.ScaleContentSceneHint={}));render.ScaleContentSceneHint;!function(ScaleManagerStrategy){ScaleManagerStrategy[ScaleManagerStrategy.NONE=0]="NONE",ScaleManagerStrategy[ScaleManagerStrategy.SCALE_FIT=1]="SCALE_FIT",ScaleManagerStrategy[ScaleManagerStrategy.SCALE_ASPECT=2]="SCALE_ASPECT",ScaleManagerStrategy[ScaleManagerStrategy.SCALE_CONTENT=128]="SCALE_CONTENT"}(render.ScaleManagerStrategy||(render.ScaleManagerStrategy={}));render.ScaleManagerStrategy;!function(OrientationStrategy){OrientationStrategy[OrientationStrategy.BOTH=0]="BOTH",OrientationStrategy[OrientationStrategy.PORTRAIT=1]="PORTRAIT",OrientationStrategy[OrientationStrategy.LANDSCAPE=2]="LANDSCAPE"}(render.OrientationStrategy||(render.OrientationStrategy={}));render.OrientationStrategy;!function(ScalePosition){ScalePosition[ScalePosition.NONE=0]="NONE",ScalePosition[ScalePosition.CENTER=1]="CENTER",ScalePosition[ScalePosition.LEFT=2]="LEFT",ScalePosition[ScalePosition.RIGHT=4]="RIGHT"}(render.ScalePosition||(render.ScalePosition={}));var ScaleManager=(render.ScalePosition,function(){function ScaleManager(renderer){this._referenceParentNode=null,this._scaleStrategy=0,this._scalePosition=0,this._forceOrientationStrategy=0,this._wrongOrientation=!1,this._onOrientationError=null,this._onOrientationOk=null,this._fullScreen=!1,this._fullScreenCapable=!1,this._surface=null,this._prefix=null,this._windowResizeTimer=null,this._onExitFullScreen=null,this._onEnterFullScreen=null,this._requestFullScreen=null,this._exitFullScreen=null,this._unitsMatrix=new Float32Array(9),this._unitsFactor=1,this._contentScaled=!1,this._renderer=null,this._onWindowResized=null,this._renderer=renderer,this._units=new cc.math.Dimension,cc.math.Matrix3.identity(this._unitsMatrix),this._unitsFactor=1,this.__initialize(),this.setScaleSurface(renderer._surface),this.__setScaleContentMatrix()}return ScaleManager.prototype.__initialize=function(){for(var prefix=["","moz","ms","webkit"],i=0;i<prefix.length;i++)if("moz"===prefix[i])"undefined"!=typeof document.body.mozRequestFullScreen&&(this._prefix="moz",this._requestFullScreen="mozRequestFullScreen",this._exitFullScreen="mozCancelFullScreen",document.addEventListener(this._prefix+"fullscreenchange",this.__fullScreenChange.bind(this),!1),document.addEventListener(this._prefix+"fullscreenerror",this.__fullScreenError.bind(this),!1));else if(document.body[prefix[i]+(""===prefix[i]?"requestFullscreen":"RequestFullscreen")]){this._prefix=prefix[i],this._requestFullScreen=""===prefix[i]?"requestFullscreen":prefix[i]+"RequestFullscreen",this._exitFullScreen=""===prefix[i]?"exitFullscreen":prefix[i]+"ExitFullscreen","ms"===prefix[i]?(document.addEventListener("MSFullscreenChange",this.__fullScreenChange.bind(this),!1),document.addEventListener("MSFullscreenError",this.__fullScreenError.bind(this),!1)):(document.addEventListener(this._prefix+"fullscreenchange",this.__fullScreenChange.bind(this),!1),document.addEventListener(this._prefix+"fullscreenerror",this.__fullScreenError.bind(this),!1));break}this._fullScreenCapable=null!==this._prefix,window.addEventListener("resize",this.__windowResized.bind(this),!1)},ScaleManager.prototype.setScaleSurface=function(surface){this._surface=surface,this._units.width=surface.width,this._units.height=surface.height,this.checkOrientation();var me=this;setTimeout(function(){me.__setScaleImpl()},200)},ScaleManager.prototype.getUnitsFactor=function(){return this._unitsFactor},ScaleManager.prototype.forceOrientation=function(os,onOk,onError){return this._forceOrientationStrategy=os,onOk&&(this._onOrientationOk=onOk),onError&&(this._onOrientationError=onError),this.checkOrientation(),this},ScaleManager.prototype.checkOrientation=function(){var currentOrientation=window.innerWidth>window.innerHeight?2:1;0===this._forceOrientationStrategy&&this._onOrientationOk&&this._onOrientationOk(currentOrientation),currentOrientation!==this._forceOrientationStrategy?(this._wrongOrientation=!0,this._onOrientationError&&this._onOrientationError()):(this._wrongOrientation&&this._onOrientationOk&&this._onOrientationOk&&this._onOrientationOk(currentOrientation),this._wrongOrientation=!1)},ScaleManager.prototype.isWrongOrientation=function(){return this._wrongOrientation},ScaleManager.prototype.isFullScreenCapable=function(){return this._fullScreenCapable},ScaleManager.prototype.startFullScreen=function(f){this._fullScreenCapable&&("undefined"!=typeof f&&this.onEnterFullScreen(f),this._surface[this._requestFullScreen]())},ScaleManager.prototype.endFullScreen=function(f){this._fullScreenCapable&&("undefined"!=typeof f&&this.onExitFullScreen(f),document[this._exitFullScreen]())},ScaleManager.prototype.isFullScreen=function(){return this._fullScreen},ScaleManager.prototype.onWindowResized=function(callback){return this._onWindowResized=callback,this},ScaleManager.prototype.__windowResized=function(){null!==this._windowResizeTimer&&clearTimeout(this._windowResizeTimer);var me=this;this._windowResizeTimer=setTimeout(function(){if(clearTimeout(me._windowResizeTimer),me._windowResizeTimer=null,me.checkOrientation(),me._contentScaled){var w,h;this._referenceParentNode?(w=this._referenceParentNode.width,h=this._referenceParentNode.height):(w=window.innerWidth,h=window.innerHeight),me._onWindowResized(w,h)}this.__wrongOrientation||me.__setScaleImpl()},1e3)},ScaleManager.prototype.__fullScreenChange=function(){this._fullScreen?(this._onExitFullScreen&&this._onExitFullScreen(),this._fullScreen=!1):(this._onEnterFullScreen&&this._onEnterFullScreen(),this._fullScreen=!0);var me=this;setTimeout(function(){me.__setScaleImpl()},500)},ScaleManager.prototype.onEnterFullScreen=function(f){return this._onEnterFullScreen=f,this},ScaleManager.prototype.onExitFullScreen=function(f){return this._onExitFullScreen=f,this},ScaleManager.prototype.onOrientationOk=function(f){return this._onOrientationOk=f,this.checkOrientation(),this},ScaleManager.prototype.onOrientationError=function(f){return this._onOrientationError=f,this.checkOrientation(),this},ScaleManager.prototype.__fullScreenError=function(){cc.Debug.warn(cc.locale.WARN_FULLSCREEN_ERROR)},ScaleManager.prototype.setReferenceParentNode=function(node){this._referenceParentNode=node},ScaleManager.prototype.setScale=function(scale,positionOp){if(this._scaleStrategy!==scale){if(this._scaleStrategy=scale,this._scalePosition=positionOp||0,this._surface){var me=this;setTimeout(function(){me.__setScaleImpl()},200)}return this}},ScaleManager.prototype.setScaleContent=function(unitsWidth,unitsHeight){return this._units.width=unitsWidth,this._units.height=unitsHeight,this.__setScaleContentMatrix(),this._contentScaled=!0,this._unitsMatrix},ScaleManager.prototype.__setScaleContentMatrix=function(){if(this._surface&&this._units.width>0&&this._units.height>0){var scale=Math.min(this._surface.width/this._units.width,this._surface.height/this._units.height);if(this._unitsFactor=scale,cc.math.Matrix3.setScale(this._unitsMatrix,scale,scale),cc.render.RENDER_ORIGIN===cc.render.ORIGIN_BOTTOM){var um=this.getScaleContentMatrix();um[1]*=-1,um[4]*=-1,um[5]+=this._renderer._dimension.height}}},ScaleManager.prototype.getScaleContentMatrix=function(){return this._unitsMatrix},ScaleManager.prototype.__setScaleImpl=function(){this._surface.style.width="",this._surface.style.height="";var scale=this._scaleStrategy;0===scale?this.__setScaleNone(this._surface):1===scale?this.__setScaleFit(this._surface):2===scale&&this.__setScaleAspect(this._surface)},ScaleManager.prototype.__setScalePosition=function(scaleW){if(this.isFullScreen())return void(this._surface.style.margin="0");var pw=0;switch(pw=null===this._referenceParentNode?window.innerWidth:this._referenceParentNode.getBoundingClientRect().width,this._scalePosition){case 2:this._surface.style.margin="0";break;case 4:this._surface.style.marginLeft=(pw-scaleW*this._surface.width|0)+"px";break;case 1:this._surface.style.marginLeft=((pw-scaleW*this._surface.width)/2|0)+"px"}this._surface.style.padding="0"},ScaleManager.prototype.__setScaleNone=function(surface){surface.style.width=surface.width+"px",surface.style.height=surface.height+"px",this.__setScalePosition(1)},ScaleManager.prototype.__setScaleFit=function(surface){surface.style.display="none";var pw,ph,parentBounds;null===this._referenceParentNode?(pw=window.innerWidth,ph=window.innerHeight):(parentBounds=this._referenceParentNode.getBoundingClientRect(),pw=parentBounds.width,ph=parentBounds.height);var sw=surface.width,sh=surface.height,factorx=pw/sw,factory=ph/sh;surface.style.width=factorx*sw+"px",surface.style.height=factory*sh+"px",surface.style.display="block",this.__setScalePosition(factorx)},ScaleManager.prototype.__setScaleAspect=function(surface){surface.style.display="none";var pw,ph,parentBounds;null===this._referenceParentNode?(pw=window.innerWidth,ph=window.innerHeight):(parentBounds=this._referenceParentNode.getBoundingClientRect(),pw=parentBounds.width,ph=parentBounds.height);var sw=surface.width,sh=surface.height,factor=Math.min(pw/sw,ph/sh);surface.style.width=factor*sw+"px",surface.style.height=factor*sh+"px",surface.style.display="block",this.__setScalePosition(factor)},ScaleManager.prototype.getScaleStrategy=function(){return this._scaleStrategy},ScaleManager}());render.ScaleManager=ScaleManager}(render=cc.render||(cc.render={}))}(cc||(cc={}));var cc;!function(cc){var render;!function(render){var util;!function(util){function getAlphaChannel(image){return getChannel(image,3)}function getRedChannel(image){return getChannel(image,0)}function getGreenChannel(image){return getChannel(image,1)}function getBlueChannel(image){return getChannel(image,2)}function getChannel(image){var canvas=null,ctx=null;if(image instanceof HTMLCanvasElement)canvas=image,ctx=canvas.getContext("2d");else{var canvas=createCanvas(image.width,image.height);ctx=canvas.getContext("2d"),ctx.drawImage(image,0,0)}var imageData=ctx.getImageData(0,0,canvas.width,canvas.height);return extractChannel(imageData.data,canvas.width,canvas.height,3)}function createCanvas(w,h){var canvas=document.createElement("canvas");return canvas.width=w,canvas.height=h,canvas}function extractChannel(data,width,height,channel){for(var ret="undefined"!=typeof Uint8Array?new Uint8Array(width*height):new Array(width*height),pos=0,i=0;i<data.length;i+=4)ret[pos++]=data[i+channel];return ret}util.getAlphaChannel=getAlphaChannel,util.getRedChannel=getRedChannel,util.getGreenChannel=getGreenChannel,util.getBlueChannel=getBlueChannel,util.getChannel=getChannel,util.createCanvas=createCanvas,util.extractChannel=extractChannel}(util=render.util||(render.util={}))}(render=cc.render||(cc.render={}))}(cc||(cc={}));var cc;!function(cc){var util;!function(util){function FloatArray(size,defaultValue){var a,i;if(defaultValue=defaultValue||0,"undefined"!=typeof Float32Array){if(a=new Float32Array(size),defaultValue)for(i=0;size>i;i++)a[i]=defaultValue}else for(a=new Array(size),i=0;size>i;i++)a[i]=defaultValue;return a}function UInt16Array(size,defaultValue){var a,i;if(defaultValue=defaultValue||0,"undefined"!=typeof Uint16Array){if(a=new Uint16Array(size),defaultValue)for(i=0;size>i;i++)a[i]=defaultValue}else for(a=new Array(size),i=0;size>i;i++)a[i]=defaultValue;return a}function fromPosixRegularExpression(expr){return expr=expr.replace(/\[\:digit\:\]/g,"\\d"),expr=expr.replace(/\[\:alpha\:\]/g,"[A-Za-z]"),expr=expr.replace(/\[\:alnum\:\]/g,"[A-Za-z0-9]"),expr=expr.replace(/\[\:word\:\]/g,"\\w"),expr=expr.replace(/\[\:cntrl\:\]/g,"[\\x00-\\x1F\\x7F]"),expr=expr.replace(/\[\:graph\:\]/g,"[\\x21-\\x7E]"),expr=expr.replace(/\[\:lower\:\]/g,"[a-z]"),expr=expr.replace(/\[\:print\:\]/g,"[\\x20-\\x7E]"),expr=expr.replace(/\[\:punct\:\]/g,"[][!\"#$%&'()*+,./:;<=>?@\\^_`{|}~-]"),expr=expr.replace(/\[\:space\:\]/g,"\\s"),expr=expr.replace(/\[\:upper\:\]/g,"[A-Z]"),expr=expr.replace(/\[\:xdigit\:\]/g,"[A-Fa-f0-9]")}util.FloatArray=FloatArray,util.UInt16Array=UInt16Array,util.fromPosixRegularExpression=fromPosixRegularExpression}(util=cc.util||(cc.util={}))}(cc||(cc={}));var cc;!function(cc){var plugin;!function(plugin){var loader;!function(_loader){var Resource=function(){function Resource(_url){this.id=null,this.extension=null,this.value=null,this._status="created",this.type=null,this.name=null,this.url=null;var url_and_id=_url.split("@"),url=url_and_id[0],id=url_and_id.length>1?url_and_id[1]:null,path=url.split("/"),name=path[path.length-1];name=name.split("?")[0];var extensionPos,extension;extensionPos=url.lastIndexOf("."),extension=null,extension=-1!==extensionPos?url.substr(extensionPos+1):"default",this.url=url,this.extension=extension,this.id=id||url,this.name=name}return Resource.prototype.load=function(loaded,error){var _this=this,loaderDescriptor=cc.plugin.loader.getLoaderByType(this.extension);if(loaderDescriptor){this.type=loaderDescriptor.type;var loader=loaderDescriptor.loader(this.url);loader.load(function(content){_this.__setValue(content),loaded(_this)},function(){_this.__setError(),error(_this)})}else cc.Debug.warn(cc.locale.WARN_RESOURCE_OF_UNKNOWN_TYPE,this.id),error(this)},Resource.prototype.__setValue=function(value){this.value=value,this._status="loaded"},Resource.prototype.__setError=function(){this._status="error"},Resource.prototype.isValid=function(){return"loaded"===this._status},Resource.prototype.getId=function(){return this.id},Resource}();_loader.Resource=Resource}(loader=plugin.loader||(plugin.loader={}))}(plugin=cc.plugin||(cc.plugin={}))}(cc||(cc={}));var cc;!function(cc){var plugin;!function(plugin){var loader;!function(loader){function registerLoaderForType(extension,builder){__resourceLoaderByType[extension]=builder}function getLoaderByType(extension){return __resourceLoaderByType[extension]}loader.registerLoaderForType=registerLoaderForType,loader.getLoaderByType=getLoaderByType;var __resourceLoaderByType={}}(loader=plugin.loader||(plugin.loader={}))}(plugin=cc.plugin||(cc.plugin={}))}(cc||(cc={}));var cc;!function(cc){var plugin;!function(plugin){var loader;!function(loader){var ResourceLoaderImage=function(){function ResourceLoaderImage(url){this._url=null,this._url=url}return ResourceLoaderImage.prototype.load=function(loaded,error){var img=new Image;img.addEventListener("load",function(e){loaded(e.target)},!1),img.addEventListener("error",function(){error()},!1),img.src=this._url},ResourceLoaderImage}();loader.ResourceLoaderImage=ResourceLoaderImage,cc.plugin.loader.registerLoaderForType("png",{type:"image",loader:function(url){return new ResourceLoaderImage(url)}}),cc.plugin.loader.registerLoaderForType("jpg",{type:"image",loader:function(url){return new ResourceLoaderImage(url)}}),cc.plugin.loader.registerLoaderForType("jpeg",{type:"image",loader:function(url){return new ResourceLoaderImage(url)}})}(loader=plugin.loader||(plugin.loader={}))}(plugin=cc.plugin||(cc.plugin={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var plugin;!function(plugin){var loader;!function(loader){var ResourceLoaderJSON=function(){function ResourceLoaderJSON(url,initializer){this._url=null,this._parse=!0,this._url=url,"undefined"!=typeof initializer&&(this._parse="undefined"!=typeof initializer.parse?initializer.parse:!0)}return ResourceLoaderJSON.prototype.load=function(loaded,error){var me=this,req=null;if("undefined"!=typeof XMLHttpRequest&&"undefined"==typeof ActiveXObject)try{req=new XMLHttpRequest}catch(e){req=null}else if("undefined"!=typeof ActiveXObject)try{req=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{req=new ActiveXObject("Microsoft.XMLHTTP")}catch(e1){req=null}}req&&(req.open("GET",me._url,!0),req.onload=function(e){if(200!=req.status)return void error();var text=e.currentTarget?e.currentTarget.responseText:e.target.responseText;if(""!==text)try{loaded(me.getValue(text))}catch(e){cc.Debug.warn(cc.locale.LOADER_JSON_PARSE_ERROR),loaded({})}},req.send())},ResourceLoaderJSON.prototype.getValue=function(text){return this._parse?JSON.parse(text):text},ResourceLoaderJSON}();loader.ResourceLoaderJSON=ResourceLoaderJSON;var ResourceLoaderXML=function(_super){function ResourceLoaderXML(url){_super.call(this,url)}return __extends(ResourceLoaderXML,_super),ResourceLoaderXML.prototype.getValue=function(text){if("undefined"!=typeof DOMParser){var parser=new DOMParser,doc=parser.parseFromString(text,"text/xml");return this.__parseNode(doc.documentElement)}return{}},ResourceLoaderXML.prototype.__parseNode=function(node){var data=null,tagName=node.tagName;if("plist"===tagName)return this.__parseArray(node);if("dict"===tagName)return this.__parseDict(node);if("array"===tagName)return this.__parseArray(node);if("string"===tagName)if(1==node.childNodes.length)data=node.firstChild.nodeValue;else{data="";for(var i=0;i<node.childNodes.length;i++)data+=node.childNodes[i].nodeValue}else{if("false"===tagName)return!1;if("true"===tagName)return!0;if("real"===tagName)return parseFloat(node.firstChild.nodeValue);if("integer"===tagName)return parseInt(node.firstChild.nodeValue,10)}return data},ResourceLoaderXML.prototype.__parseArray=function(node){for(var data=[],i=0;i<node.childNodes.length;i++){var child=node.childNodes[i];1===child.nodeType&&data.push(this.__parseNode(child))}return data},ResourceLoaderXML.prototype.__parseDict=function(node){for(var data={},key=null,i=0;i<node.childNodes.length;i++){var child=node.childNodes[i];1===child.nodeType&&("key"===child.tagName?key=child.firstChild.nodeValue:data[key]=this.__parseNode(child))}return data},ResourceLoaderXML}(ResourceLoaderJSON);loader.ResourceLoaderXML=ResourceLoaderXML,cc.plugin.loader.registerLoaderForType("json",{type:"javascript json",loader:function(url){return new ResourceLoaderJSON(url,{parse:!0})}}),cc.plugin.loader.registerLoaderForType("txt",{type:"plain text files",loader:function(url){return new ResourceLoaderJSON(url,{parse:!1})
}}),cc.plugin.loader.registerLoaderForType("fnt",{type:"Glypth designer fnt",loader:function(url){return new ResourceLoaderJSON(url,{parse:!1})}}),cc.plugin.loader.registerLoaderForType("xml",{type:"XML file",loader:function(url){return new ResourceLoaderXML(url)}}),cc.plugin.loader.registerLoaderForType("plist",{type:"MAC Plist file",loader:function(url){return new ResourceLoaderXML(url)}})}(loader=plugin.loader||(plugin.loader={}))}(plugin=cc.plugin||(cc.plugin={}))}(cc||(cc={}));var cc;!function(cc){var plugin;!function(plugin){var loader;!function(loader){var audioContext=function(){var ctx="undefined"!=typeof AudioContext?AudioContext:"undefined"!=typeof webkitAudioContext?webkitAudioContext:null;return ctx&&new ctx}(),ResourceLoaderAudioBuffer=function(){function ResourceLoaderAudioBuffer(url){this._url=null,this._url=url}return ResourceLoaderAudioBuffer.prototype.load=function(loaded,error){var me=this,req=null;if("undefined"!=typeof XMLHttpRequest&&"undefined"==typeof ActiveXObject)try{req=new XMLHttpRequest}catch(e){req=null}else if("undefined"!=typeof ActiveXObject)try{req=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{req=new ActiveXObject("Microsoft.XMLHTTP")}catch(e1){req=null}}req&&(req.open("GET",me._url,!0),req.responseType="arraybuffer",req.onload=function(){audioContext.decodeAudioData(req.response,function(buffer){loaded(buffer)},function(e){console.log("decode error ",e),error()})},req.send())},ResourceLoaderAudioBuffer}();loader.ResourceLoaderAudioBuffer=ResourceLoaderAudioBuffer,cc.plugin.loader.registerLoaderForType("mp3",{type:"mp3 audio",loader:function(url){return new ResourceLoaderAudioBuffer(url)}}),cc.plugin.loader.registerLoaderForType("ogg",{type:"ogg audio",loader:function(url){return new ResourceLoaderAudioBuffer(url)}}),cc.plugin.loader.registerLoaderForType("wav",{type:"wav audio",loader:function(url){return new ResourceLoaderAudioBuffer(url)}})}(loader=plugin.loader||(plugin.loader={}))}(plugin=cc.plugin||(cc.plugin={}))}(cc||(cc={}));var cc;!function(cc){var plugin;!function(plugin){var loader;!function(loader){var Resource=cc.plugin.loader.Resource,Loader=function(){function Loader(loaderData){this._prefix=null,this._resources=[],this._currentLoadedResourcesCount=0,loaderData&&("undefined"!=typeof loaderData.prefix&&(this._prefix=loaderData.prefix),"undefined"!=typeof loaderData.resources&&this.addResources(loaderData.resources))}return Loader.prototype.__addPrefixIfNeeded=function(s){return this._prefix?(s=s.trim(),"/"===s.charAt(0)?s:0===s.indexOf("http")||0===s.indexOf("https")||0===s.indexOf("ftp")?s:this._prefix+s):s},Loader.prototype.addResource=function(url){url=this.__addPrefixIfNeeded(url);var resource=new Resource(url);return this._resources.push(resource),this},Loader.prototype.addResources=function(resources){for(var i=0;i<resources.length;i++)this.addResource(resources[i]);return this},Loader.prototype.startLoading=function(onEnd,onProgress,onError){var _this=this;if(0===this._resources.length)return void onEnd({});for(var i=0;i<this._resources.length;i++)this._resources[i].load(function(resource){if(_this._currentLoadedResourcesCount++,onProgress&&onProgress(resource,_this._currentLoadedResourcesCount,_this._resources.length,!0),_this._currentLoadedResourcesCount===_this._resources.length){for(var notify={},i=0;i<_this._resources.length;i++)notify[_this._resources[i].getId()]=_this._resources[i].value;onEnd(notify),_this._resources=null,_this._currentLoadedResourcesCount=0}},function(resource){_this._currentLoadedResourcesCount++,onProgress&&onProgress(resource,_this._currentLoadedResourcesCount,_this._resources.length,!1),onError&&onError(resource)});return this},Loader}();loader.Loader=Loader}(loader=plugin.loader||(plugin.loader={}))}(plugin=cc.plugin||(cc.plugin={}))}(cc||(cc={}));var cc;!function(cc){var plugin;!function(plugin){var texture;!function(texture){var getTexturePageIndex=function(){var index=0;return function(){return index++}}(),SortStrategies={__compare:function(v0,v1){return v1>v0?1:v0>v1?-1:0},perimeter:function(i0,i1){var w0=i0.getWidth(),h0=i0.getHeight(),w1=i1.getWidth(),h1=i1.getHeight();return SortStrategies.__compare(w0+w0+h0+h0,w1+w1+h1+h1)},area:function(i0,i1){var w0=i0.getWidth(),h0=i0.getHeight(),w1=i1.getWidth(),h1=i1.getHeight();return SortStrategies.__compare(w0*h0,w1*h1)},width:function(i0,i1){return SortStrategies.__compare(i0.getWidth(),i1.getHeight())},height:function(i0,i1){return SortStrategies.__compare(i0.getWidth(),i1.getHeight())}},TexturePackerNode=function(){function TexturePackerNode(){this._x=0,this._y=0,this._width=0,this._height=0,this._left=null,this._right=null,this._item=null}return TexturePackerNode.prototype.insert=function(w,h,margin){var marginw=margin[0]+margin[2],marginh=margin[1]+margin[3];if(this._left){var node=this._left.insert(w,h,margin);return null===node?this._right.insert(w,h,margin):node}return null!==this._item?null:this._width<w||this._height<h?null:this._width===w&&this._height===h?this:(this._left=new TexturePackerNode,this._right=new TexturePackerNode,this._width-w>=this._height-h?(this._left._x=this._x,this._left._y=this._y,this._left._width=w,this._left._height=this._height,this._right._x=this._x+w+marginw,this._right._y=this._y,this._right._width=this._width-w-marginw,this._right._height=this._height):(this._left._x=this._x,this._left._y=this._y,this._left._width=this._width,this._left._height=h,this._right._x=this._x,this._right._y=this._y+h+marginh,this._right._width=this._width,this._right._height=this._height-h-marginh),this._left.insert(w,h,margin))},TexturePackerNode.prototype.paint=function(ctx,margin,debug){debug&&(this._item?(ctx.strokeStyle="#fff",ctx.strokeRect(this._x+.5,this._y+.5,this._width-1,this._height-1)):this._left||(ctx.strokeStyle="#f00",ctx.lineWidth=1,ctx.strokeRect(this._x+.5,this._y+.5,this._width-1,this._height-1),ctx.beginPath(),ctx.moveTo(this._x+.5,this._y+.5),ctx.lineTo(this._x+this._width-.5,this._y+this._height-.5),ctx.moveTo(this._x+this._width-.5,this._y+.5),ctx.lineTo(this._x+.5,this._y+this._height-.5),ctx.stroke())),this._item&&this._item.draw(ctx,this._x,this._y),this._left&&this._left.paint(ctx,margin,debug),this._right&&this._right.paint(ctx,margin,debug)},TexturePackerNode.prototype.createFrames=function(textureId){this._item&&cc.plugin.asset.AssetManager.addSpriteFrame(cc.plugin.asset.AssetManager.getSpriteFrame(textureId).createSubSpriteFrame(this._x,this._y,this._width,this._height,this._item.getId())),this._left&&this._left.createFrames(textureId),this._right&&this._right.createFrames(textureId)},TexturePackerNode}();texture.TexturePackerNode=TexturePackerNode;var TexturePackerPage=function(){function TexturePackerPage(id,w,h){this._canvas=null,this._ctx=null,this._root=null,this._id=id,this._width=w,this._height=h,this._root=new TexturePackerNode,this._root._width=w,this._root._height=h}return TexturePackerPage.prototype.insertImage=function(item,margin){var node=this._root.insert(item.getWidth(),item.getHeight(),margin);return null!==node&&(node._item=item),node},TexturePackerPage.prototype.createAssets=function(margin,debug){this._canvas=document.createElement("canvas"),this._canvas.width=this._width,this._canvas.height=this._height,this._ctx=this._canvas.getContext("2d"),this._root.paint(this._ctx,margin,debug),cc.plugin.asset.AssetManager.addImage(this._canvas,this._id),this._root.createFrames(this._id)},TexturePackerPage}();texture.TexturePackerPage=TexturePackerPage;var TexturePackerItemImage=function(){function TexturePackerItemImage(image,id){this.image=image,this.id=id}return TexturePackerItemImage.prototype.getId=function(){return this.id},TexturePackerItemImage.prototype.getWidth=function(){return this.image.width},TexturePackerItemImage.prototype.getHeight=function(){return this.image.height},TexturePackerItemImage.prototype.fits=function(w,h){return this.image.width<=w&&this.image.height<=h},TexturePackerItemImage.prototype.draw=function(ctx,x,y){ctx.drawImage(this.image,x,y)},TexturePackerItemImage}(),TexturePackerItemSpriteFrame=function(){function TexturePackerItemSpriteFrame(frame,id){this.frame=frame,this.id=id}return TexturePackerItemSpriteFrame.prototype.getId=function(){return this.id},TexturePackerItemSpriteFrame.prototype.getWidth=function(){return this.frame.getWidth()},TexturePackerItemSpriteFrame.prototype.getHeight=function(){return this.frame.getHeight()},TexturePackerItemSpriteFrame.prototype.fits=function(w,h){return this.frame.getWidth()<=w&&this.frame.getHeight()<=h},TexturePackerItemSpriteFrame.prototype.draw=function(ctx,x,y){ctx.save();var w=this.frame.getWidth(),h=this.frame.getHeight(),rect=this.frame._rect;this.frame._rotated&&(ctx.translate(w/2,h/2),ctx.rotate(-Math.PI/2),ctx.translate(-w/2,-h/2)),ctx.drawImage(this.frame._texture._image,rect.x,rect.y,rect.w,rect.h,x,y,w,h),ctx.restore()},TexturePackerItemSpriteFrame}(),TexturePacker=function(){function TexturePacker(){this._images=[],this._pages=[],this._margin=[0,0,0,0],this._debug=!1}return TexturePacker.prototype.addImage=function(image,id){this._images.push(new TexturePackerItemImage(image,id?id:image.src))},TexturePacker.prototype.addSpriteFrame=function(spriteFrame){this._images.push(new TexturePackerItemSpriteFrame(spriteFrame,spriteFrame._name))},TexturePacker.prototype.addSpriteFrames=function(spriteFrames){for(var i=0;i<spriteFrames.length;i++)this.addSpriteFrame(spriteFrames[i])},TexturePacker.prototype.addPListAtlas=function(image,atlasInfo){var main=new cc.node.sprite.SpriteFrame(new cc.render.Texture2D(image,"")),sf=main.createSpriteFramesFromPLIST(atlasInfo);this.addSpriteFrames(sf)},TexturePacker.prototype.addJSONAtlas=function(image,atlasInfo){var main=new cc.node.sprite.SpriteFrame(new cc.render.Texture2D(image,"")),sf=main.createSpriteFramesFromJSON(atlasInfo);this.addSpriteFrames(sf)},TexturePacker.prototype.pack=function(pack){var w=pack.width||2048,h=pack.height||2048,sortStrategy=pack.sortBy,margin_v=pack.margin||0,margin=[margin_v,margin_v,margin_v,margin_v];if(pack["margin-left"]&&(margin[0]=pack["margin-left"]),pack["margin-top"]&&(margin[1]=pack["margin-top"]),pack["margin-right"]&&(margin[2]=pack["margin-right"]),pack["margin-bottom"]&&(margin[3]=pack["margin-bottom"]),this._debug="undefined"!=typeof pack.debug?pack.debug:!1,this._margin=margin,this._pages=[],sortStrategy){var ss=SortStrategies[sortStrategy]||SortStrategies.perimeter;this._images.sort(ss)}this._pages.push(new TexturePackerPage("texturepage"+getTexturePageIndex(),w,h));for(var i=0;i<this._images.length;i++)if(this._images[i].fits(w,h)){for(var node=null,j=0;j<this._pages.length&&(node=this._pages[j].insertImage(this._images[i],margin),null===node);j++);if(null===node){var newPage=new TexturePackerPage("texturepage"+getTexturePageIndex(),w,h);this._pages.push(newPage),newPage.insertImage(this._images[i],margin)}}},TexturePacker.prototype.createAssets=function(){for(var i=0;i<this._pages.length;i++)this._pages[i].createAssets(this._margin,this._debug)},TexturePacker}();texture.TexturePacker=TexturePacker}(texture=plugin.texture||(plugin.texture={}))}(plugin=cc.plugin||(cc.plugin={}))}(cc||(cc={}));var cc;!function(cc){var plugin;!function(plugin){var font;!function(_font){var SpriteFontChar=function(){function SpriteFontChar(){this._id=null,this._frame=null,this._xadvance=0,this._xoffset=0,this._yoffset=0,this._kerningInfo={},this._font=null}return Object.defineProperty(SpriteFontChar.prototype,"width",{get:function(){return this._frame._rect.w},enumerable:!0,configurable:!0}),SpriteFontChar.prototype.setFont=function(f){this._font=f},SpriteFontChar.prototype.setFrame=function(spriteFrame){this._frame=spriteFrame},SpriteFontChar.prototype.addKerning=function(char,v){this._kerningInfo[char]=v},SpriteFontChar.prototype.draw=function(ctx,x,y,nextChar){if(null!==this._frame&&!this._frame._rect.isEmpty()){if(null!==nextChar){var _kerning=this._kerningInfo[nextChar];_kerning&&(x+=_kerning)}var _y,rect=this._frame._rect;_y=cc.render.RENDER_ORIGIN===cc.render.ORIGIN_TOP?y+this._yoffset:y+this._font._height-(rect.h+this._yoffset),ctx.drawTexture(this._frame.getTexture(),rect.x,rect.y,rect.w,rect.h,x+this._xoffset,_y,rect.w,rect.h)}},SpriteFontChar.createFrom=function(frame,data){var sfc=new SpriteFontChar;return sfc._frame=frame.createSubSpriteFrame(data.x-2,data.y,data.width,data.height,data.id),null===sfc._frame&&cc.Debug.info(cc.locale.ERR_FONT_GLYPTH_NOT_IN_FRAME,data.id),sfc._xadvance=data.xadvance||0,sfc._xoffset=data.xoffset||0,sfc._yoffset=data.yoffset||0,sfc._id=data.id,sfc},SpriteFontChar}();_font.SpriteFontChar=SpriteFontChar;var SpriteFont=function(){function SpriteFont(name){this._fontName=null,this._valid=!1,this._chars={},this._height=0,this._baseline=0,this._descent=0,this._ascent=0,this._fontName=name}return SpriteFont.prototype.isValid=function(){return this._valid},SpriteFont.prototype.__addChar=function(obj){obj.setFont(this),this._chars[String.fromCharCode(obj._id)]=obj},SpriteFont.prototype.setAsFnt=function(spriteFrameId,fontDef){return this.setAsGlypthDesigner(spriteFrameId,fontDef)},SpriteFont.prototype.setAsGlypthDesigner=function(spriteFrameId,fontDef){for(var f=cc.plugin.asset.AssetManager.getSpriteFrame(spriteFrameId),text=fontDef.split("\n"),i=0;i<text.length;i++)if(text[i]=text[i].replace(/\t/gi," "),0===text[i].indexOf("char ")){for(var str=text[i].substring(5),pairs=str.split(" "),props={},j=0;j<pairs.length;j++){var pair=pairs[j];if(""!==pair){var pairData=pair.trim().split("=");if("page"!==pairData[0]&&"chnl"!==pairData[0]&&"letter"!==pairData[0]){var property=pairData[0],value=pairData[1];props[property]=parseFloat(value)}}}this.__addChar(SpriteFontChar.createFrom(f,props))}else if(0===text[i].indexOf("kerning "))for(var str=text[i].substring(8),pairs=str.trim().split(" "),j=0;j<pairs.length;j++){var first=pairs[0].split("=")[1],second=pairs[1].split("=")[1],amount=pairs[2].split("=")[1],char=this._chars[String.fromCharCode(parseInt(first))];char&&char.addKerning(String.fromCharCode(parseInt(second)),parseInt(amount))}else if(0===text[i].indexOf("common"))for(var str=text[i].substring(7),pairs=str.trim().split(" "),j=0;j<pairs.length;j++){var vv=pairs[j].split("="),key=vv[0];value=vv[1],"lineHeight"===key?this._height=parseFloat(value):"base"===key&&(this._baseline=parseFloat(value),this._descent=this._height-this._baseline)}else 0===text[i].indexOf("info");return this._valid=!0,this},SpriteFont.prototype.setAsSystemFont=function(fontDef){"undefined"==typeof fontDef.fontface&&(fontDef.fontface="arial"),"undefined"==typeof fontDef.size&&(fontDef.size=20),fontDef.padding=fontDef.padding||2,fontDef.strokeSize=fontDef.strokeSize||1,fontDef.strokeStyle=fontDef.strokeStyle||"#000",fontDef.fillStyle=fontDef.fillStyle||"#000";var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),font=""+fontDef.size+"px "+fontDef.fontface+(fontDef.style?" "+fontDef.style:"");ctx.font=font,ctx.strokeStyle=fontDef.strokeStyle,ctx.fillStyle=fontDef.fillStyle,ctx.lineWidth=fontDef.strokeSize;var mt=cc.plugin.font.getFontMetrics(ctx,font);this._height=mt.height+fontDef.padding,this._baseline=this._height;var mwidth=ctx.measureText(fontDef.characters).width,w=(0|Math.min(mwidth,1024))+1,h=(2+(mwidth/1024|0))*this._height;canvas.width=w,canvas.height=h,ctx=canvas.getContext("2d"),ctx.font=font,ctx.textBaseline="alphabetic",ctx.textAlign="center",ctx.strokeStyle=fontDef.strokeStyle,ctx.fillStyle=fontDef.fillStyle,ctx.lineWidth=fontDef.strokeSize;for(var x=0,y=mt.ascent,chars={},i=0;i<fontDef.characters.length;i++){var str=fontDef.characters.substr(i,1),strw=1+(0|ctx.measureText(str).width);x+strw+fontDef.padding>=w&&(x=0,y+=this._height),fontDef.stroke&&ctx.strokeText(str,x+strw/2,y),fontDef.fill&&ctx.fillText(str,x+strw/2,y),chars[str]={x:x+fontDef.padding/2,y:y-mt.ascent,width:strw+fontDef.strokeSize/2,height:this._height,id:str.charCodeAt(0),xadvance:strw},x+=strw+fontDef.padding}cc.plugin.asset.AssetManager.addImage(canvas,this._fontName);for(var char in chars)this.__addChar(SpriteFontChar.createFrom(cc.plugin.asset.AssetManager.getSpriteFrame(this._fontName),chars[char]));return this._valid=!0,this},SpriteFont.prototype.drawText=function(ctx,text,x,y){var lines=text.split("\n");this.drawTextArray(ctx,lines,x,y)},SpriteFont.prototype.drawTextArray=function(ctx,lines,x,y){var h=this._height;cc.render.RENDER_ORIGIN===cc.render.ORIGIN_BOTTOM&&(y+=(lines.length-1)*this._height,h=-h);for(var n=0;n<lines.length;n++)this.drawTextLine(ctx,lines[n],x,y),y+=h},SpriteFont.prototype.drawTextLine=function(ctx,text,x,y){for(var i=0;i<text.length;i++){var char=this._chars[text.charAt(i)];char&&(char.draw(ctx,x,y,i<text.length-1?text.charAt(i+1):null),x+=char._xadvance)}},SpriteFont.prototype.drawTextInRect=function(ctx,text,x,y,width,height,halign,valign){var textSize=this.getTextSize(text,width),lines=text.split("\n"),textHeight=textSize.height,yoffset=0;switch(cc.render.RENDER_ORIGIN===cc.render.ORIGIN_BOTTOM&&(2===valign?valign=0:0===valign&&(valign=2)),valign){case 1:yoffset=(height-textHeight)/2;break;case 2:yoffset=height-textHeight-1}cc.render.RENDER_ORIGIN===cc.render.ORIGIN_BOTTOM&&(yoffset+=(lines.length-1)*this._height);for(var xx=x,n=0;n<lines.length;n++){{var xoffset=0;this.getStringWidth(lines[n])}switch(halign){case 1:break;case 2:}for(var words=lines[n].split(" "),i=0;i<words.length;i++){var word=words[i];i<words.length-1&&(word+=" ");var wordWidth=this.getStringWidth(word);x+wordWidth>width&&(y+=this._height*(cc.render.RENDER_ORIGIN===cc.render.ORIGIN_BOTTOM?-1:1),x=0);for(var j=0;j<word.length;j++){var char=this._chars[word[j]];char&&(char.draw(ctx,x+xoffset,y+yoffset,lines[n].charAt(i+1)),x+=char._xadvance)}}y+=this._height*(cc.render.RENDER_ORIGIN===cc.render.ORIGIN_BOTTOM?-1:1),x=xx}},SpriteFont.prototype.getTextSize=function(text,flowWidth){var width=0,height=0;if(flowWidth)return this.getTextSizeFlow(text,flowWidth);for(var lines=text.split("\n"),n=0;n<lines.length;n++){var w=this.getStringWidth(lines[n]);w>width&&(width=w),height+=this._height}return new cc.math.Dimension(width,height)},SpriteFont.prototype.getTextSizeFlow=function(text,flowWidth){for(var lines=text.split("\n"),ret=new cc.math.Dimension,i=0;i<lines.length;i++){var d=this.getLineSizeFlow(lines[i],flowWidth);d.width>ret.width&&(ret.width=d.width),ret.height+=d.height}return ret},SpriteFont.prototype.getLineSizeFlow=function(text,flowWidth){for(var maxWidth=0,w=0,h=this._height,words=text.split(" "),i=0;i<words.length;i++){var word=words[i];i<words.length-1&&(word+=" ");var wordWidth=this.getStringWidth(word);w+wordWidth>flowWidth?(h+=this._height,w>maxWidth&&(maxWidth=w),w=wordWidth):w+=wordWidth}return w>maxWidth&&(maxWidth=w),new cc.math.Dimension(maxWidth,h)},SpriteFont.prototype.getStringWidth=function(text){for(var w=0,i=0;i<text.length;i++){var char=this._chars[text.charAt(i)];char&&(w+=char._xadvance)}return w},SpriteFont}();_font.SpriteFont=SpriteFont}(font=plugin.font||(plugin.font={}))}(plugin=cc.plugin||(cc.plugin={}))}(cc||(cc={}));var cc;!function(cc){var plugin;!function(plugin){var font;!function(_font){function getFontMetrics(ctx,font){var prevFont=ctx.font;ctx.font=font;var fm=ctx.measureText("WHGg"),ffm=fm;if("undefined"!=typeof ffm.actualBoundingBoxDescent){var ret=new FontMetrics;return ret.height=ffm.actualBoundingBoxAscent+ffm.actualBoundingBoxDescent,ret.ascent=ffm.actualBoundingBoxAscent,ret.descent=ffm.actualBoundingBoxDescent,ctx.font=prevFont,ret}try{return ret=getFontMetricsCSS(font)}catch(e){}return getFontMetricsNoCSS(font)}function getFontMetricsNoCSS(font){var height,re=/(\d+(\.\d+)?)p[x|t]\s*/i,res=re.exec(font);height=res?parseFloat(res[1]):32;var ascent=height-1,h=height+.25*height|0;return new FontMetrics(h,ascent,h-ascent)}function getFontMetricsCSS(font){function offset(elem){var box,docElem,body,win,clientTop,clientLeft,scrollTop,scrollLeft,top,left,doc=elem&&elem.ownerDocument;return docElem=doc.documentElement,box=elem.getBoundingClientRect(),body=document.body,win=9===doc.nodeType?doc.defaultView||doc.parentWindow:!1,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,scrollTop=win.pageYOffset||docElem.scrollTop,scrollLeft=win.pageXOffset||docElem.scrollLeft,top=box.top+scrollTop-clientTop,left=box.left+scrollLeft-clientLeft,{top:top,left:left}}try{var text=document.createElement("span");text.style.font=font,text.innerHTML="g";var block=document.createElement("div");block.style.display="inline-block",block.style.width="1px",block.style.height="0px";var div=document.createElement("div");div.appendChild(text),div.appendChild(block);var body=document.body;body.appendChild(div);try{var result=new FontMetrics;return block.style.verticalAlign="baseline",result.ascent=offset(block).top-offset(text).top,block.style.verticalAlign="bottom",result.height=offset(block).top-offset(text).top,result.ascent=Math.ceil(result.ascent),result.height=Math.ceil(result.height),result.descent=result.height-result.ascent,result}finally{body.removeChild(div)}}catch(e){return null}}var FontMetrics=function(){function FontMetrics(h,as,des){this.height=h,this.ascent=as,this.descent=des}return FontMetrics}();_font.FontMetrics=FontMetrics,_font.getFontMetrics=getFontMetrics}(font=plugin.font||(plugin.font={}))}(plugin=cc.plugin||(cc.plugin={}))}(cc||(cc={}));var cc;!function(cc){var plugin;!function(plugin){var asset;!function(asset){var Loader=cc.plugin.loader.Loader,_textures={},_frames={},_animations={},_spriteFonts={},_audioBuffers={},AssetManager=function(){function AssetManager(){}return AssetManager.mergeResources=function(res){for(var i in res)cc.plugin.asset.AssetManager._resources[i]=res[i]},AssetManager.load=function(data,onEnd,onProgress,onError){new Loader(data).startLoading(function(resources){onEnd&&onEnd(resources)},function(resource,index,total,errored){onProgress&&onProgress(resource,index,total,errored)},function(resource){onError&&onError(resource)})},AssetManager.prepareTextures=function(renderer){for(var texture in _textures)_textures.hasOwnProperty(texture)&&renderer.prepareTexture(_textures[texture])},AssetManager.addImage=function(img,id){var texture=new cc.render.Texture2D(img,id);return _textures[id]=texture,_frames[id]=new cc.node.sprite.SpriteFrame(texture),texture},AssetManager.addResource=function(resource){if(resource.isValid())switch(resource.type){case"image":AssetManager.addImage(resource.value,resource.id)}},AssetManager.addSpriteFrame=function(frame){_frames[frame._name]=frame},AssetManager.getSpriteFrame=function(id){var ret=_frames[id];return ret?ret:null},AssetManager.addSpriteFrames=function(frames){for(var i=0;i<frames.length;i++)this.addSpriteFrame(frames[i])},AssetManager.getSpriteFrames=function(ids){for(var ret=[],i=0;i<ids.length;i++){var sf=AssetManager.getSpriteFrame(ids[i]);sf?ret.push(sf):cc.Debug.warn(cc.locale.ASSETMANAGER_WARN_SPRITEFRAME_NOT_FOUND,"getSpriteFrames",ids[i])}return ret},AssetManager.addTexture=function(texture){_textures[texture._name]=texture},AssetManager.getTexture=function(name){var ret=_textures[name];return ret?ret:null},AssetManager.addAnimation=function(animation,name){_animations[name]=animation},AssetManager.addAnimationForFrames=function(animationId,frames,prefix){for(var animation=new cc.node.sprite.Animation,i=0;i<frames.length;i++){var frameName=prefix?prefix+frames[i]:frames[i],spriteFrame=_frames[frameName];spriteFrame&&animation.addFrame(spriteFrame)}return _animations[animationId]=animation,animation},AssetManager.getAnimationById=function(animationId){var anim=_animations[animationId];return anim?anim.clone():null},AssetManager.addSpriteFramesFromFrameWithJSON=function(spriteFrameId,json,prefix){var spriteFrame=AssetManager.getSpriteFrame(spriteFrameId);if(spriteFrame){var frames=spriteFrame.createSpriteFramesFromJSON(json);if(prefix)for(var i=0;i<frames.length;i++)frames[i]._name=prefix+frames[i]._name;AssetManager.addSpriteFrames(frames)}},AssetManager.addGridSpriteFramesFromFrame=function(spriteFrameId,rows,cols){var spriteFrame=AssetManager.getSpriteFrame(spriteFrameId);if(spriteFrame){var frames=spriteFrame.createSubSpriteFrames(rows,cols);AssetManager.addSpriteFrames(frames)}},AssetManager.createSpriteFontFromGlypthDesigner=function(fontName,spriteFrameId,glypthDesignerInfo){var font=new cc.plugin.font.SpriteFont(fontName).setAsGlypthDesigner(spriteFrameId,glypthDesignerInfo);font.isValid()&&(_spriteFonts[fontName]=font)},AssetManager.getSpriteFont=function(fontName){var ret=_spriteFonts[fontName];return ret?ret:null},AssetManager.createSystemSpriteFont=function(fontName,systemFont){var font=new cc.plugin.font.SpriteFont(fontName).setAsSystemFont(systemFont);font.isValid()&&(_spriteFonts[fontName]=font)},AssetManager.addSpriteFramesFromFrameWithPLIST=function(spriteFrameId,plist){var spriteFrame=AssetManager.getSpriteFrame(spriteFrameId);if(spriteFrame){var frames=spriteFrame.createSpriteFramesFromPLIST(plist);AssetManager.addSpriteFrames(frames)}},AssetManager.getAudioBuffer=function(id){var ret=_audioBuffers[id];return ret?ret:null},AssetManager.addAudioBuffer=function(buffer,id){_audioBuffers[id]=buffer},AssetManager._resources={},AssetManager}();asset.AssetManager=AssetManager}(asset=plugin.asset||(plugin.asset={}))}(plugin=cc.plugin||(cc.plugin={}))}(cc||(cc={}));var cc;!function(cc){var plugin;!function(plugin){var audio;!function(_audio){var audioContext=function(){var ctx="undefined"!=typeof AudioContext?AudioContext:"undefined"!=typeof webkitAudioContext?webkitAudioContext:null;return ctx&&new ctx}(),codecs=null;!function(){function check(str){return""!==str&&"no"!==str}var audio=new Audio;codecs={mp3:check(audio.canPlayType("audio/mpeg;")),ogg:check(audio.canPlayType('audio/ogg; codecs="vorbis"')),wav:check(audio.canPlayType('audio/wav; codecs="1"')),aac:check(audio.canPlayType("audio/aac;")),m4a:check(audio.canPlayType("audio/x-m4a;"))||check(audio.canPlayType("audio/m4a;"))||check(audio.canPlayType("audio/aac;")),mp4:check(audio.canPlayType("audio/x-mp4;"))||check(audio.canPlayType("audio/mp4;"))||check(audio.canPlayType("audio/aac;")),weba:check(audio.canPlayType('audio/webm; codecs="vorbis"'))}}(),function(AudioEffectStatus){AudioEffectStatus[AudioEffectStatus.NONE=0]="NONE",AudioEffectStatus[AudioEffectStatus.PLAY=1]="PLAY",AudioEffectStatus[AudioEffectStatus.PAUSE=2]="PAUSE",AudioEffectStatus[AudioEffectStatus.STOP=3]="STOP",AudioEffectStatus[AudioEffectStatus.END=4]="END",AudioEffectStatus[AudioEffectStatus.LOADED=5]="LOADED"}(_audio.AudioEffectStatus||(_audio.AudioEffectStatus={}));var AudioEffect=(_audio.AudioEffectStatus,function(){function AudioEffect(masterGain,buffer){this._id=null,this._isWebAudio=!1,this._status=0,this._muted=!1,this._volume=1,this._bufferDuration=0,this._duration=0,this._source=null,this._buffer=null,this._pauseTime=0,this._startPlaybackTime=0,this._delayTime=0,this._masterGain=null,this._gain=null,this._isSprite=!1,this._spriteStartTime=0,this._loop=!1,this._endTimerId=null,this._onEnd=null,this._onResume=null,this._onPause=null,this._onStop=null,this._onStart=null,this._onRepeat=null,this._filter=null,this._filterEnabled=!1,this._convolver=null,this._convolverEnabled=!1,this._playbackRate=1,this._isWebAudio=!0,buffer&&this.setBuffer(buffer),this._gain="undefined"==typeof audioContext.createGain?audioContext.createGainNode():audioContext.createGain(),this._gain.connect(masterGain),this._masterGain=masterGain,this._filter=cc.plugin.audio.AudioManager.getContext().createBiquadFilter(),this._convolver=cc.plugin.audio.AudioManager.getContext().createConvolver()}return AudioEffect.prototype.setId=function(s){return this._id=s,this},AudioEffect.prototype.getId=function(){return this._id},AudioEffect.prototype.setBuffer=function(buffer){this._bufferDuration=buffer.duration,this._duration=buffer.duration,this._buffer=buffer},AudioEffect.prototype.loop=function(enable){return this._loop=enable,this},AudioEffect.prototype.isLoop=function(){return this._loop},AudioEffect.prototype.getVolume=function(){return this._gain.gain.value},AudioEffect.prototype.setVolume=function(v){this._volume=v,this._muted||(this._gain.gain.value=v)},AudioEffect.prototype.setSprite=function(enable,start,duration){return this._isSprite=enable,"undefined"!=typeof start&&(this._spriteStartTime=start,this._duration=duration),this._source&&this.__setSpriteData(),this},AudioEffect.prototype.__setSpriteData=function(){this._isSprite?this._isWebAudio&&(this._source.loopStart=this._spriteStartTime,this._source.loopEnd=Math.min(this._duration,this._spriteStartTime+this._duration)):this._isWebAudio&&(this._duration=this._bufferDuration,this._source.loopStart=0,this._source.loopEnd=this._duration)},AudioEffect.prototype.setPlaybackRate=function(rate){if(this._playbackRate=rate,this._source){var wasPlaying=this.isPlaying();wasPlaying&&this.pause(),this._source.playbackRate.value=rate,wasPlaying&&this.resume()}},AudioEffect.prototype.getDuration=function(){return this._loop?Number.MAX_VALUE:this._delayTime+this._duration},AudioEffect.prototype.__createSource=function(){this._source=audioContext.createBufferSource(),this._source.buffer=this._buffer,this.__connectNodes(),this.loop(this._loop),this.__setSpriteData(),this._delayTime=0,this._startPlaybackTime=0,this._muted||(this._gain.gain.value=this._volume),this._status=0},AudioEffect.prototype.__connectNodes=function(){var chain=[];chain.push(this._source),this._filterEnabled&&chain.push(this._filter),this._convolverEnabled&&chain.push(this._convolver),chain.push(this._gain);for(var i=0;i<chain.length-1;i++)chain[i].connect(chain[i+1])},AudioEffect.prototype.setFilter=function(f){var wasFilterEnabled=this._filterEnabled;if(this._filterEnabled=null!==f,f){var type=f.type.toLowerCase();this._filter.type=type;for(var pr in f)"type"!==pr&&f.hasOwnProperty(pr)&&(this._filter[pr].value=f[pr])}1===this._status&&(wasFilterEnabled&&this._filterEnabled||this.__pausePlay())},AudioEffect.prototype.__pausePlay=function(){var ct=this.getCurrentTime();this.stop(),this.setCurrentTime(ct),this.__connectNodes(),this.play()},AudioEffect.prototype.play=function(delay){delay=delay||0;var startTime=0,waspaused=!1;return 1===this._status?this.stop():2===this._status&&(startTime=this._pauseTime,waspaused=!0),this.__createSource(),this._status=1,this._startPlaybackTime=audioContext.currentTime,this._delayTime=delay,this._source.playbackRate.value=this._playbackRate,this._isSprite?this._isWebAudio&&("undefined"==typeof this._source.start?this._source.noteGrainOn(delay,this._spriteStartTime+startTime,this.getRemainingTime()):this._source.start(delay,this._spriteStartTime+startTime,this.getRemainingTime())):this._isWebAudio&&this._source.start(delay,startTime),this.__cancelEndTimer(),this.__startEndTimer(),waspaused?this._onResume&&this._onResume(this):this._onStart&&this._onStart(this),this},AudioEffect.prototype.isPlaying=function(){return 1===this._status},AudioEffect.prototype.convolve=function(_buffer){var buffer=null;"undefined"!=typeof _buffer&&"string"==typeof _buffer&&(buffer=cc.plugin.asset.AssetManager.getAudioBuffer(_buffer)),null===buffer?(this._convolver.buffer=null,this._convolverEnabled=!1):(this._convolverEnabled=!0,this._convolver.buffer=buffer),this.isPlaying()&&this.__pausePlay()},AudioEffect.prototype.getCurrentTime=function(){return 1===this._status||2===this._status?(audioContext.currentTime-this._startPlaybackTime+this._spriteStartTime)%this._duration-this._delayTime+this._pauseTime:0},AudioEffect.prototype.setCurrentTime=function(time){var wasPlaying=1===this._status;this.stop(),this._pauseTime=time%this._duration+this._spriteStartTime,this._status=2,wasPlaying&&this.play()},AudioEffect.prototype.getRemainingTime=function(){return 1===this._status||2===this._status?Math.max(0,this._duration-this.getCurrentTime()):0},AudioEffect.prototype.__cancelEndTimer=function(){this._endTimerId&&(clearTimeout(this._endTimerId),this._endTimerId=null)},AudioEffect.prototype.__startEndTimer=function(){if(!this._endTimerId){var timeleft=this.getRemainingTime()/this._playbackRate,me=this;
this._endTimerId=setTimeout(function(){me._endTimerId=null,me._pauseTime=0,me._status=4,me._loop?(me._onRepeat&&me._onRepeat(me),me.play(0)):me._onEnd&&me._onEnd(me)},1e3*timeleft)}},AudioEffect.prototype.__pause_stop_common=function(){"undefined"==typeof this._source.stop?this._source.noteOff(0):this._source.stop(0),this.__cancelEndTimer()},AudioEffect.prototype.stop=function(){return this._source&&this.__pause_stop_common(),this._pauseTime=0,this._status=3,this._onStop&&this._onStop(this),this},AudioEffect.prototype.pause=function(){if(1===this._status){var pt=this.getCurrentTime();this.__pause_stop_common();var ct=audioContext.currentTime;return this._pauseTime=pt,this._startPlaybackTime=ct,this._status=2,this._onPause&&this._onPause(this),this}},AudioEffect.prototype.resume=function(){return 2===this._status?this.play():void 0},AudioEffect.prototype.onEnd=function(c){return this._onEnd=c,this},AudioEffect.prototype.onRepeat=function(c){return this._onRepeat=c,this},AudioEffect.prototype.onPause=function(c){return this._onPause=c,this},AudioEffect.prototype.onResume=function(c){return this._onResume=c,this},AudioEffect.prototype.onStop=function(c){return this._onStop=c,this},AudioEffect.prototype.onStart=function(c){return this._onStart=c,this},AudioEffect.prototype.mute=function(){return this._isWebAudio&&(this._gain.gain.value=0),this._muted=!0,this},AudioEffect.prototype.unmute=function(){return this._isWebAudio&&(this._gain.gain.value=this._volume),this._muted=!1,this},AudioEffect}());_audio.AudioEffect=AudioEffect;var SimpleAudioEffect=function(){function SimpleAudioEffect(){this._audio=null,this._loaded=!1,this._status=0,this._url=null,this._pauseTime=0,this._volume=1,this._masterVolume=1,this._audio=document.createElement("audio"),this._audio.preload="auto",this._audio.autoplay=!1}return SimpleAudioEffect.prototype.setUrl=function(url,autoplay){if(url!==this._url){var me=this;this._url=url,this._loaded=!1,this._audio.addEventListener("canplaythrough",function(e){e.srcElement.removeEventListener("canplaythrough",this),me._loaded=!0,me._status=5,autoplay&&me.play()},!1),this._audio.src=url}},SimpleAudioEffect.prototype.setMasterVolume=function(v){this._masterVolume=v},SimpleAudioEffect.prototype.setVolume=function(v){this._volume=v,this._audio.volume=v*this._masterVolume},SimpleAudioEffect.prototype.loop=function(){this._loop=!0,this.play()},SimpleAudioEffect.prototype.play=function(){0!==this._status&&(this._status=1,this._audio.currentTime=0,this._audio.loop=this._loop,this._audio.play())},SimpleAudioEffect.prototype.pause=function(){0!==this._status&&(this._status=2,this._pauseTime=this._audio.currentTime,this._audio.pause())},SimpleAudioEffect.prototype.resume=function(){0!==this._status&&(this._status=1,this._audio.currentTime=this._pauseTime,this._audio.play(),this._pauseTime=0)},SimpleAudioEffect.prototype.stop=function(){this._status=3,this._pauseTime=0,this._audio.pause()},SimpleAudioEffect}();_audio.SimpleAudioEffect=SimpleAudioEffect;var AudioManager=function(){function AudioManager(ami){var _this=this;this._context=null,this._volume=1,this._masterGain=null,this._soundPool=[],this._playingPool=[],this._music=null,audioContext&&(this._masterGain=audioContext.createGain(),this._masterGain.connect(audioContext.destination)),this._music=new SimpleAudioEffect,ami=ami||{},ami.numChannels=ami.numChannels||16;for(var i=0;i<ami.numChannels;i++){var ae=new AudioEffect(this._masterGain);this._soundPool.push(ae),ae.onEnd(function(ae){_this.__recycle(ae)}),ae.onStop(function(ae){_this.__recycle(ae)})}}return AudioManager.prototype.__recycle=function(ae){var index=this._playingPool.indexOf(ae);-1!==index?(this._playingPool.splice(index,1),this._soundPool.push(ae)):console.log("recycle sound for not found element.")},AudioManager.prototype.createAudio=function(id){return new AudioEffect(this._masterGain,cc.plugin.asset.AssetManager.getAudioBuffer(id))},AudioManager.prototype.setVolume=function(v){this._volume=v,this._masterGain.gain.value=v,this._music.setMasterVolume(v)},AudioManager.prototype.setMusicVolume=function(v){this._music.setVolume(v)},AudioManager.prototype.playEffect=function(id,volume){0===this._soundPool.length&&cc.Debug.warn(cc.locale.ERR_SOUND_POOL_EMPTY);var ab=null;if(ab="string"==typeof id?cc.plugin.asset.AssetManager.getAudioBuffer(id):id,null!==ab){var ae=this._soundPool.pop();ae.setVolume(volume||1),ae.setBuffer(ab),ae.play(),this._playingPool.push(ae)}},AudioManager.prototype.pauseEffects=function(){for(var i=0;i<this._playingPool.length;i++)this._playingPool[i].pause()},AudioManager.prototype.resumeEffects=function(){for(var i=0;i<this._playingPool.length;i++)this._playingPool[i].resume()},AudioManager.prototype.stopEffects=function(){for(var i=0;i<this._playingPool.length;i++)this._playingPool[i].stop()},AudioManager.prototype.setMusic=function(url,autoplay){this._music.loop(!0),this._music.setUrl(url,autoplay)},AudioManager.prototype.playMusic=function(){this._music.loop(!0),this._music.play()},AudioManager.prototype.pauseMusic=function(){this._music.pause()},AudioManager.prototype.resumeMusic=function(){this._music.resume()},AudioManager.prototype.stopMusic=function(){this._music.stop()},AudioManager.canPlay=function(codec){return codecs[codec]},AudioManager.getContext=function(){return audioContext},AudioManager.isWebAudioEnabled=function(){return null!==audioContext},AudioManager}();_audio.AudioManager=AudioManager}(audio=plugin.audio||(plugin.audio={}))}(plugin=cc.plugin||(cc.plugin={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var plugin;!function(plugin){var layout;!function(_layout){var Unit=function(){function Unit(original){this._orgValue=0,this._orgType="","undefined"!=typeof original&&this.setValue(original)}return Unit.prototype.setValue=function(original){var exp=new RegExp("\\d+\\.?\\d*(.*)","gi"),m=exp.exec(""+original);m&&(this._orgType=m[1],this._orgValue=parseInt(m[0]))},Unit.prototype.getValue=function(ref){switch(this._orgType){case"":return this._orgValue;case"px":return this._orgValue;case"%":return"undefined"!=typeof ref?this._orgValue/100*ref:0}},Unit}();_layout.Unit=Unit;var Insets=function(){function Insets(){this.left=new Unit,this.top=new Unit,this.right=new Unit,this.bottom=new Unit}return Insets}();_layout.Insets=Insets;var Gap=function(){function Gap(){this.horizontal=new Unit,this.vertical=new Unit}return Gap}();_layout.Gap=Gap;var BaseLayout=function(){function BaseLayout(){this._bounds=null,this._insets=null,this._gap=null,this._children=[],this._preferredWidth=null,this._preferredHeight=null,this._name="",this._parent=null,this._bounds=new cc.math.Rectangle,this._insets=new Insets,this._gap=new Gap,this._preferredWidth=new Unit,this._preferredHeight=new Unit}return BaseLayout.parse=function(layout){return"string"==typeof layout?(new BaseLayout).parse({type:"element",name:layout}):"element"===layout.type?(new BaseLayout).parse(layout):"border"===layout.type?(new BorderLayout).parse(layout):"layer"===layout.type?(new LayerLayout).parse(layout):"grid"===layout.type?(new GridLayout).parse(layout):void console.log("unknown layout type: "+layout.type)},BaseLayout.prototype.paint=function(ctx){ctx.strokeRect(this._bounds.x,this._bounds.y,this._bounds.w,this._bounds.h);for(var i=0;i<this._children.length;i++)this._children[i].paint(ctx)},BaseLayout.prototype.setBounds=function(x,y,w,h){this._bounds.set(x,y,w,h)},BaseLayout.prototype.setSize=function(w,h){this._bounds.w=w,this._bounds.h=h},BaseLayout.prototype.setPreferredSize=function(w,h){this._preferredWidth.setValue(w),this._preferredHeight.setValue(h)},BaseLayout.prototype.getPreferredSize=function(){return new cc.math.Dimension(this._preferredWidth.getValue(this._parent?this._parent._bounds.w:this._bounds.w),this._preferredHeight.getValue(this._parent?this._parent._bounds.h:this._bounds.h))},BaseLayout.prototype.getPreferredLayoutSize=function(){var ps=this.getPreferredSize();return this.adjustWithInsets(ps),ps},BaseLayout.prototype.doLayout=function(){var d=new cc.math.Dimension;this.adjustWithInsets(d),this._bounds.w-=d.width,this._bounds.h-=d.height,this._bounds.x+=d.width/2,this._bounds.y+=d.height/2},BaseLayout.prototype.layout=function(x,y,w,h){this.setBounds(x,y,w,h),this.getPreferredLayoutSize(),this.doLayout()},BaseLayout.prototype.parse=function(layoutInfo){if("undefined"!=typeof layoutInfo.insets){var arr=layoutInfo.insets;4!==arr.length&&console.log("wrong defined insets: "+arr),this._insets.left.setValue(layoutInfo.insets[0]),this._insets.right.setValue(layoutInfo.insets[2]),this._insets.top.setValue(layoutInfo.insets[1]),this._insets.bottom.setValue(layoutInfo.insets[3])}if("undefined"!=typeof layoutInfo.gap){var arr=layoutInfo.gap;2!==arr.length&&console.log("wrong defined gap: "+arr),this._gap.horizontal.setValue(layoutInfo.gap[0]),this._gap.vertical.setValue(layoutInfo.gap[1])}return"undefined"!=typeof layoutInfo.preferredWidth&&this._preferredWidth.setValue(layoutInfo.preferredWidth),"undefined"!=typeof layoutInfo.preferredHeight&&this._preferredHeight.setValue(layoutInfo.preferredHeight),"undefined"!=typeof layoutInfo.name&&(this._name=layoutInfo.name),"undefined"!=typeof layoutInfo.elements&&("[object Array]"===Object.prototype.toString.call(layoutInfo.elements)?this.parseElements(layoutInfo.elements):console.log("Layout elememts block is not array.")),this},BaseLayout.prototype.parseElements=function(children){function addElement(s,parent){var elem=cc.plugin.layout.BaseLayout.parse(s);elem&&(elem._parent=parent,me._children.push(elem))}for(var me=this,i=0;i<children.length;i++)if("string"==typeof children[i]){var elem=children[i];if(-1!==elem.indexOf("[")&&-1!==elem.indexOf("]")){var exp=new RegExp("(.*)\\[(.*)\\]","gi"),m=exp.exec(elem),prefix=m[1],pattern=m[2].split("-");if(2===pattern.length)for(var from=parseInt(pattern[0]),to=parseInt(pattern[1]);to>=from;)addElement(prefix+from,this),from++;else console.log("wrong pattern for element by name: "+elem),addElement(elem,this)}else addElement(elem,this)}else addElement(children[i],this)},BaseLayout.prototype.addElement=function(e){this._children.push(e)},BaseLayout.prototype.adjustWithInsets=function(d){d.width+=this._insets.left.getValue(this._bounds.w)+this._insets.right.getValue(this._bounds.w),d.height+=this._insets.top.getValue(this._bounds.h)+this._insets.bottom.getValue(this._bounds.h)},BaseLayout.prototype.applyToNode=function(_node,resize){var _this=this;if(_node){""!==this._name&&_node.enumerateChildren(this._name,function(node){node.setPosition(_this._bounds.x,_this._bounds.y),resize&&node.setContentSize(_this._bounds.w,_this._bounds.h)});for(var i=0;i<this._children.length;i++)this._children[i].applyToNode(_node,resize)}},BaseLayout}();_layout.BaseLayout=BaseLayout;var BorderLayout=function(_super){function BorderLayout(){_super.call(this),this._left=null,this._right=null,this._top=null,this._bottom=null,this._center=null}return __extends(BorderLayout,_super),BorderLayout.prototype.getPreferredLayoutSize=function(){var d,ret=new cc.math.Dimension;this._left&&(d=this._left.getPreferredLayoutSize(),ret.width+=d.width+this._gap.horizontal.getValue(this._bounds.w),ret.height=Math.max(d.height,ret.height)),this._right&&(d=this._right.getPreferredLayoutSize(),ret.width+=d.width+this._gap.horizontal.getValue(this._bounds.w),ret.height=Math.max(d.height,ret.height)),this._center&&(d=this._center.getPreferredLayoutSize(),ret.width+=d.width,ret.height=Math.max(d.height,ret.height)),this._top&&(d=this._top.getPreferredLayoutSize(),ret.height+=d.height+this._gap.vertical.getValue(this._bounds.h),ret.width=Math.max(ret.width,d.width)),this._bottom&&(d=this._bottom.getPreferredLayoutSize(),ret.height+=d.height+this._gap.vertical.getValue(this._bounds.h),ret.width=Math.max(ret.width,d.width)),this.adjustWithInsets(d);var pd=this.getPreferredSize();return d.width=Math.max(d.width,pd.width),d.height=Math.max(d.width,pd.height),d},BorderLayout.prototype.left=function(e){return this._children.push(e),this._left=e,this._left._parent=this,this},BorderLayout.prototype.right=function(e){return this._children.push(e),this._right=e,this._right._parent=this,this},BorderLayout.prototype.top=function(e){return this._children.push(e),this._top=e,this._top._parent=this,this},BorderLayout.prototype.bottom=function(e){return this._children.push(e),this._bottom=e,this._bottom._parent=this,this},BorderLayout.prototype.center=function(e){return this._children.push(e),this._center=e,this._center._parent=this,this},BorderLayout.prototype.parse=function(layoutInfo){return _super.prototype.parse.call(this,layoutInfo),"undefined"!=typeof layoutInfo.left&&this.left(cc.plugin.layout.BaseLayout.parse(layoutInfo.left)),"undefined"!=typeof layoutInfo.right&&this.right(cc.plugin.layout.BaseLayout.parse(layoutInfo.right)),"undefined"!=typeof layoutInfo.bottom&&this.bottom(cc.plugin.layout.BaseLayout.parse(layoutInfo.bottom)),"undefined"!=typeof layoutInfo.top&&this.top(cc.plugin.layout.BaseLayout.parse(layoutInfo.top)),"undefined"!=typeof layoutInfo.center&&this.center(cc.plugin.layout.BaseLayout.parse(layoutInfo.center)),this},BorderLayout.prototype.addElement=function(e,constraint){"undefined"!=typeof this[constraint]?this[constraint](e):console.log("wrong border layout constraint.")},BorderLayout.prototype.doLayout=function(){var d,left=this._bounds.x+this._insets.left.getValue(this._bounds.w),top=this._bounds.y+this._insets.top.getValue(this._bounds.h),right=this._bounds.x1-this._insets.right.getValue(this._bounds.w),bottom=this._bounds.y1-this._insets.bottom.getValue(this._bounds.h);this._top&&(this._top.setSize(right-left,this._top._bounds.h),d=this._top.getPreferredLayoutSize(),this._top._bounds.set(left,top,right-left,d.height),this._top.doLayout(),top+=d.height+this._gap.vertical.getValue(this._bounds.h)),this._bottom&&(this._bottom.setSize(right-left,this._bottom._bounds.h),d=this._bottom.getPreferredLayoutSize(),d.height=Math.min(d.height,bottom-top),this._bottom._bounds.set(left,bottom-d.height,right-left,d.height),this._bottom.doLayout(),bottom-=d.height+this._gap.vertical.getValue(this._bounds.h)),this._right&&(this._right.setSize(this._right._bounds.w,bottom-top),d=this._right.getPreferredLayoutSize(),this._right._bounds.set(right-d.width,top,d.width,bottom-top),this._right.doLayout(),right-=d.width+this._gap.horizontal.getValue(this._bounds.w)),this._left&&(this._left.setSize(this._left._bounds.w,bottom-top),d=this._left.getPreferredLayoutSize(),d.width=Math.min(d.width,right-left),this._left._bounds.set(left,top,d.width,bottom-top),this._left.doLayout(),left+=d.width+this._gap.horizontal.getValue(this._bounds.w)),this._center&&(this._center._bounds.set(left,top,right-left,bottom-top),this._center.doLayout())},BorderLayout}(BaseLayout);_layout.BorderLayout=BorderLayout;var GridLayout=function(_super){function GridLayout(){_super.call(this),this._layoutRows=!1,this._numElements=0,this._rows=0,this._columns=0}return __extends(GridLayout,_super),GridLayout.prototype.parse=function(layoutInfo){return _super.prototype.parse.call(this,layoutInfo),"undefined"!=typeof layoutInfo.rows&&(this._layoutRows=!0,this._numElements=layoutInfo.rows),"undefined"!=typeof layoutInfo.columns&&(this._layoutRows=!1,this._numElements=layoutInfo.columns),this._numElements||console.log("bug bug grid info wrong defined."),this},GridLayout.prototype.getPreferredLayoutSize=function(){var rows=0,columns=0,ret=new cc.math.Dimension;this._layoutRows?(rows=this._numElements,columns=(rows+this._children.length-1)/rows>>0):(columns=this._numElements,rows=(columns+this._children.length-1)/columns>>0);for(var i=0;i<this._children.length;i++){var d=this._children[i].getPreferredLayoutSize();d.width>ret.width&&(ret.width=d.width),d.height>ret.height&&(ret.height=d.height)}this.adjustWithInsets(d),d.width+=columns*ret.width+(columns-1)*this._gap.horizontal.getValue(this._bounds.w),d.height+=rows*ret.height+(rows-1)*this._gap.vertical.getValue(this._bounds.h);var pd=this.getPreferredSize();return d.width=Math.max(d.width,pd.width),d.height=Math.max(d.height,pd.height),this._rows=rows,this._columns=columns,d},GridLayout.prototype.doLayout=function(){if(this._children.length){var rows,columns;this._layoutRows?(rows=this._numElements,columns=(rows+this._children.length-1)/rows>>0):(columns=this._numElements,rows=(columns+this._children.length-1)/columns>>0),this._rows=rows,this._columns=columns;for(var nrows=this._rows,ncols=this._columns,totalGapsWidth=(ncols-1)*this._gap.horizontal.getValue(this._bounds.w),widthWOInsets=this._bounds.w-(this._insets.left.getValue(this._bounds.w)+this._insets.right.getValue(this._bounds.w)),widthOnComponent=(widthWOInsets-totalGapsWidth)/ncols,extraWidthAvailable=(widthWOInsets-(widthOnComponent*ncols+totalGapsWidth))/2,totalGapsHeight=(nrows-1)*this._gap.vertical.getValue(this._bounds.h),heightWOInsets=this._bounds.h-(this._insets.top.getValue(this._bounds.h)+this._insets.bottom.getValue(this._bounds.h)),heightOnComponent=(heightWOInsets-totalGapsHeight)/nrows,extraHeightAvailable=(heightWOInsets-(heightOnComponent*nrows+totalGapsHeight))/2,c=0,x=this._insets.left.getValue(this._bounds.w)+extraWidthAvailable;ncols>c;c++,x+=widthOnComponent+this._gap.horizontal.getValue(this._bounds.w))for(var r=0,y=this._insets.top.getValue(this._bounds.h)+extraHeightAvailable;nrows>r;r++,y+=heightOnComponent+this._gap.vertical.getValue(this._bounds.h)){var i=r*ncols+c;if(i<this._children.length){var child=this._children[i];null!==child&&(child.setBounds(this._bounds.x+x,this._bounds.y+y,widthOnComponent,heightOnComponent),child.doLayout())}}}},GridLayout}(BaseLayout);_layout.GridLayout=GridLayout;var LayerLayout=function(_super){function LayerLayout(){_super.call(this)}return __extends(LayerLayout,_super),LayerLayout.prototype.getPreferredLayoutSize=function(){var d=new cc.math.Dimension;d.set(this._preferredWidth.getValue(this._bounds.w),this._preferredHeight.getValue(this._bounds.h)),this.adjustWithInsets(d);var pd=this.getPreferredSize();return d.width=Math.max(d.width,pd.width),d.height=Math.max(d.width,pd.height),d},LayerLayout.prototype.doLayout=function(){for(var x=this._bounds.x+this._insets.left.getValue(this._bounds.w),y=this._bounds.y+this._insets.top.getValue(this._bounds.h),w=this._bounds.w-this._insets.left.getValue(this._bounds.w)-this._insets.right.getValue(this._bounds.w),h=this._bounds.h-this._insets.top.getValue(this._bounds.h)-this._insets.bottom.getValue(this._bounds.h),i=0;i<this._children.length;i++)this._children[i].setBounds(x,y,w,h),this._children[i].doLayout()},LayerLayout}(BaseLayout);_layout.LayerLayout=LayerLayout}(layout=plugin.layout||(plugin.layout={}))}(plugin=cc.plugin||(cc.plugin={}))}(cc||(cc={}));var cc;!function(cc){var input;!function(input){var InputManagerEvent=function(){function InputManagerEvent(){this._target=null,this._type=null}return Object.defineProperty(InputManagerEvent.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),InputManagerEvent.prototype.getCurrentTarget=function(){return this._target},Object.defineProperty(InputManagerEvent.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),InputManagerEvent.prototype.initializeEventForTarget=function(target,type){this._target=target,this._type=type},InputManagerEvent}();input.InputManagerEvent=InputManagerEvent;var InputManager=function(){function InputManager(){this._keyboardManager=null,this._keyboardManager=new cc.input.KeyboardInputManager}return InputManager.prototype.enable=function(element){return this._keyboardManager.enable(),cc.input.MouseInputManager.enable(element),this},InputManager.prototype.disable=function(){return this._keyboardManager.disable(),cc.input.MouseInputManager.disable(),this},InputManager.prototype.addEventListener=function(event,callback,params){"keydown"===event?this._keyboardManager.onDown(params,callback):"keyup"===event&&this._keyboardManager.onUp(params,callback)},InputManager.prototype.registerCursor=function(kd,callback){return this._keyboardManager.registerCursor(kd,callback)},InputManager.prototype.unregisterCursor=function(id){this._keyboardManager.unregisterCursor(id)},InputManager}();input.InputManager=InputManager;var PriorityInputNode=function(){function PriorityInputNode(node,priority){this.node=node,this.priority=priority}return PriorityInputNode}();input.PriorityInputNode=PriorityInputNode;var SceneGraphInputTreeNode=function(){function SceneGraphInputTreeNode(node){this.node=null,this.children=null,this.enabled=!1,this.children=[],"undefined"!=typeof node&&(this.node=node)}return SceneGraphInputTreeNode.prototype.insert=function(path){var lastNode=path[path.length-1];return lastNode===this.node?this.__insertImpl(this,path):(cc.Debug.warn(cc.locale.INPUT_WARN_WRONG_ROOT_NODE),null)},SceneGraphInputTreeNode.prototype.__insertImpl=function(inputNode,path){var pathNode=path.pop();return pathNode!==inputNode.node&&(inputNode=inputNode.addChildInputNode(pathNode)),0!==path.length?this.__insertImpl(inputNode,path):(inputNode.enabled=!0,inputNode)},SceneGraphInputTreeNode.prototype.addChildInputNode=function(node){for(var i=0;i<this.children.length;i++)if(this.children[i].node===node)return this.children[i];var newInputNode=new SceneGraphInputTreeNode(node);return this.children.push(newInputNode),this.children.sort(function(sn0,sn1){var n0=sn0.node,n1=sn1.node;return n0._localZOrder<n1._localZOrder?1:n0._localZOrder>n1._localZOrder?-1:n0._orderOfArrival<n1._orderOfArrival?1:-1}),newInputNode},SceneGraphInputTreeNode.prototype.flatten=function(){var ret=[];return this.__flattenImpl(this,ret),ret},SceneGraphInputTreeNode.prototype.__flattenImpl=function(inputNode,nodes){var i;for(i=0;i<inputNode.children.length;i++)this.__flattenImpl(inputNode.children[i],nodes);inputNode.enabled&&nodes.push(inputNode.node)},SceneGraphInputTreeNode.prototype.findNodeAtScreenPoint=function(p,callback){var node=this.__findNodeAtScreenPoint(this,p,callback);return!node&&callback&&callback(null),node},SceneGraphInputTreeNode.prototype.__findNodeAtScreenPoint=function(inputNode,p,callback){var i,pp=new cc.math.Vector;for(pp.set(p.x,p.y),i=0;i<inputNode.children.length;i++){var node=this.__findNodeAtScreenPoint(inputNode.children[i],p,callback);if(node)return node}if(inputNode.enabled){var node=inputNode.node;if(p.set(pp.x,pp.y),node.isScreenPointInNode(p)){if(!callback)return node;if(!callback(node))return node;p.set(pp.x,pp.y)}}return p.set(pp.x,pp.y),null},SceneGraphInputTreeNode}();input.SceneGraphInputTreeNode=SceneGraphInputTreeNode}(input=cc.input||(cc.input={}))}(cc||(cc={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},cc;!function(cc){var input;!function(input){function createEvent(e,event,node){var mie=new MouseInputManagerEvent(e);return getTargetSpacePoint(__p0,e),mie.setScreenPoint(__p0.x,__p0.y),null===_prevScreenPoint&&(_prevScreenPoint=new Vector(__p0.x,__p0.y)),mie.localPoint.x=mie.screenPoint.x,mie.localPoint.y=mie.screenPoint.y,mie.prevScreenPoint.x=_prevScreenPoint.x,mie.prevScreenPoint.y=_prevScreenPoint.y,mie.initializeEventForTarget(node,event),mie}function routeEvent(p,callback){return _scene?_scene.findNodeAtScreenPoint(p,callback):null}function mouseDown(e){e.preventDefault(),e.stopPropagation&&e.stopPropagation(),_scene&&__inputDown(createEvent(e,"mousedown",_currentCaptureNode),"mousedown")}function __inputDown(ee,event){_isMouseDown=!0,ee._localPoint.set(ee._screenPoint.x,ee._screenPoint.y),routeEvent(ee._localPoint,function(node){var ret=!1;return node&&(ee._type=event,ee._target=node,ret=node.notifyEvent(ee)),_currentCaptureNode===node||ret||_currentCaptureNode&&(ee._type="mousedown"===event?"mouseout":"touchend",ee._target=_currentCaptureNode,_currentCaptureNode.notifyEvent(ee)),ret||(_currentCaptureNode=node),_prevScreenPoint.set(ee.screenPoint.x,ee.screenPoint.y),ret})}function mouseUp(e){e.preventDefault(),e.stopPropagation&&e.stopPropagation(),_scene&&__inputUp(createEvent(e,"mouseup",_currentCaptureNode),"mouseup")}function __inputUp(ee,event){ee._localPoint.set(ee._screenPoint.x,ee._screenPoint.y);var node=routeEvent(ee._localPoint);_currentCaptureNode&&(_currentCaptureNode!==node?(ee._type="mouseup"===event?"mouseout":"touchend",ee._target=_currentCaptureNode,ee.localPoint.x=ee.screenPoint.x,ee.localPoint.y=ee.screenPoint.y,_currentCaptureNode.isScreenPointInNode(ee.localPoint),_currentCaptureNode.notifyEvent(ee)):(_currentCaptureNode.notifyEvent(ee),_isDragging||"mouseup"!==event||(ee._type="mouseclick",ee._target=_currentCaptureNode,_currentCaptureNode.notifyEvent(ee)))),_currentCaptureNode=null,_isMouseDown=!1,_isDragging=!1,_isDraggingInCapture=!1,_prevScreenPoint=null}function mouseMove(e,_event){if(e.preventDefault(),e.stopPropagation&&e.stopPropagation(),_scene){var event=_event?_event:_isMouseDown?"mousedrag":"mousemove";__inputMove(createEvent(e,event,_currentCaptureNode),event)}}function __inputMove(ee,event){if(_isMouseDown&&(_isDragging=!0,_isDraggingInCapture=!0),_isDragging){ee._localPoint.set(ee._screenPoint.x,ee._screenPoint.y);var node=routeEvent(ee._localPoint),ret=!1;node!==_currentCaptureNode?_currentCaptureNode&&(ee._type=ee._type="mousedrag"===event||"mousemove"===event?"mouseout":"touchout",ee.localPoint.x=ee.screenPoint.x,ee.localPoint.y=ee.screenPoint.y,_currentCaptureNode.getScreenPointInLocalSpace(ee.localPoint),_currentCaptureNode.notifyEvent(ee),_isDraggingInCapture=!1):_isDraggingInCapture||(_isDraggingInCapture=!0,ee._type=ee._type="mousedrag"===event||"mousemove"===event?"mouseover":"touchover",_currentCaptureNode.notifyEvent(ee)),null!==_currentCaptureNode&&(ee._type=event,ee._target=_currentCaptureNode,ret=_currentCaptureNode.notifyEvent(ee)),_prevScreenPoint.set(ee.screenPoint.x,ee.screenPoint.y)}else ee._localPoint.set(ee._screenPoint.x,ee._screenPoint.y),routeEvent(ee._localPoint,function(node){var ret=!1;return node&&(ee._type=event,ee._target=node,ret=node.notifyEvent(ee)),node===_currentCaptureNode||ret||(_currentCaptureNode&&(ee._type="mousedrag"===event||"mousemove"===event?"mouseout":"touchout",ee._target=_currentCaptureNode,_currentCaptureNode.notifyEvent(ee)),node&&(ee._type="mousedrag"===event||"mousemove"===event?"mouseover":"touchover",ee._target=node,ret=node.notifyEvent(ee))),ret||(_currentCaptureNode=node),_prevScreenPoint.set(ee.screenPoint.x,ee.screenPoint.y),ret})}function doubleClick(e){if(e.preventDefault(),e.stopPropagation&&e.stopPropagation(),_scene){var ee=createEvent(e,"doubleclick",_currentCaptureNode);_currentCaptureNode?_currentCaptureNode.notifyEvent(ee):(ee._localPoint.set(ee._screenPoint.x,ee._screenPoint.y),routeEvent(ee._localPoint,function(){var ret=!1;return _currentCaptureNode&&(ret=_currentCaptureNode.notifyEvent(ee)),ret})),_prevScreenPoint=null}}function mouseOver(e){e.preventDefault(),e.stopPropagation&&e.stopPropagation(),_scene&&mouseMove(e,"mouseoever")}function mouseOut(e){e.preventDefault(),e.stopPropagation&&e.stopPropagation(),_scene&&mouseMove(e,"mouseout")}function touchStart(e){e.preventDefault(),e.stopPropagation&&e.stopPropagation(),_scene&&__inputDown(createEvent(e.targetTouches[0],"touchstart",_currentCaptureNode),"touchstart")}function touchEnd(e){e.preventDefault(),e.stopPropagation&&e.stopPropagation(),_scene&&__inputUp(createEvent(e.changedTouches[0],"touchend",_currentCaptureNode),"touchend")}function touchMove(e){e.preventDefault(),e.stopPropagation&&e.stopPropagation(),_scene&&__inputMove(createEvent(e.targetTouches[0],"touchmove",_currentCaptureNode),"touchmove")}function __accumulateOffset(node,parentProperty,property){for(var style,left=property+"Left",top=property+"Top",x=0,y=0;isIOS&&node&&node.style&&(node.currentStyle?style=node.currentStyle.position:(style=(node.ownerDocument.defaultView||node.ownerDocument.parentWindow).getComputedStyle(node,null),style=style?style.getPropertyValue("position"):null),!/^(fixed)$/.test(style));)x+=node[left],y+=node[top],node=node[parentProperty];return{x:x,y:y,style:style}}function __getOffset(node){var res=__accumulateOffset(node,"offsetParent","offset");if("fixed"===res.style){var res2=__accumulateOffset(node,node.parentNode?"parentNode":"parentElement","scroll");return{x:res.x+res2.x,y:res.y+res2.y}}return{x:res.x,y:res.y}}function getTargetSpacePoint(point,e){_screenPoint.x=e.clientX,_screenPoint.y=e.clientY;var posx=0,posy=0;if(navigator.isCocoonJS)posx=e.pageX,posy=e.pageY;else if("undefined"!=typeof e.offsetX||"undefined"!=typeof e.layerX||"undefined"!=typeof e.clientX){var bcr=_target.getBoundingClientRect();posx=e.clientX,posy=e.clientY,posx=(posx-bcr.left)*(_target.width/bcr.width),posy=(posy-bcr.top)*(_target.height/bcr.height)}else{e||(e=window.event),e.pageX||e.pageY?(posx=e.pageX,posy=e.pageY):(e.clientX||e.clientY)&&(posx=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,posy=e.clientY+document.body.scrollTop+document.documentElement.scrollTop);var offset=__getOffset(this.canvas);posx-=offset.x,posy-=offset.y}_targetPoint.set(posx,posy),point.set(posx,posy)}function hasTouch(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}var Vector=cc.math.Vector,InputManagerEvent=cc.input.InputManagerEvent,__p0=new Vector,_target=null,_screenPoint=new Vector,_prevScreenPoint=new Vector,_targetPoint=new Vector,_scene=null,_isMouseDown=!1,_isDragging=!1,_isDraggingInCapture=!1,_currentCaptureNode=null,isIOS=navigator&&navigator.userAgent.match(/iOS/),MouseInputManagerEvent=function(_super){function MouseInputManagerEvent(e){_super.call(this),this._originalDOMEvent=null,this._screenPoint=null,this._localPoint=null,this._prevScreenPoint=null,this._originalDOMEvent=e,this._screenPoint=new Vector,this._localPoint=new Vector,this._prevScreenPoint=new Vector}return __extends(MouseInputManagerEvent,_super),MouseInputManagerEvent.prototype.getDelta=function(){return{x:this._screenPoint.x-this._prevScreenPoint.x,y:this._screenPoint.y-this._prevScreenPoint.y}},MouseInputManagerEvent.prototype.setScreenPoint=function(x,y){this._screenPoint.set(x,y)},MouseInputManagerEvent.prototype.initializeEventForTarget=function(target,event){_super.prototype.initializeEventForTarget.call(this,target,event),this._localPoint.set(this._screenPoint.x,this._screenPoint.y)},Object.defineProperty(MouseInputManagerEvent.prototype,"localPoint",{get:function(){return this._localPoint},enumerable:!0,configurable:!0}),Object.defineProperty(MouseInputManagerEvent.prototype,"prevScreenPoint",{get:function(){return this._prevScreenPoint},enumerable:!0,configurable:!0}),Object.defineProperty(MouseInputManagerEvent.prototype,"screenPoint",{get:function(){return this._screenPoint},enumerable:!0,configurable:!0}),MouseInputManagerEvent}(InputManagerEvent);input.MouseInputManagerEvent=MouseInputManagerEvent;var MouseInputManager=function(){function MouseInputManager(){}return MouseInputManager.enableInputForScene=function(scene){_scene=scene},MouseInputManager.disableInputForScene=function(){_scene=null},MouseInputManager.enable=function(target){null!==_target&&this.disable(),_target=target,hasTouch()?(target.addEventListener("touchstart",touchStart,!1),target.addEventListener("touchmove",touchMove,!1),target.addEventListener("touchend",touchEnd,!1)):(window.addEventListener("mouseup",mouseUp,!1),window.addEventListener("mousedown",mouseDown,!1),window.addEventListener("mouseover",mouseOver,!1),window.addEventListener("mouseout",mouseOut,!1),window.addEventListener("mousemove",mouseMove,!1),window.addEventListener("dblclick",doubleClick,!1))},MouseInputManager.disable=function(){null!==_target&&(hasTouch()?(_target.removeEventListener("touchstart",touchStart,!1),_target.removeEventListener("touchmove",touchMove,!1),_target.removeEventListener("touchend",touchEnd,!1)):(window.removeEventListener("mouseup",mouseUp,!1),window.removeEventListener("mousedown",mouseDown,!1),window.removeEventListener("mouseover",mouseOver,!1),window.removeEventListener("mouseout",mouseOut,!1),window.removeEventListener("mousemove",mouseMove,!1),window.removeEventListener("dblclick",doubleClick,!1)),_target=null)
},MouseInputManager}();input.MouseInputManager=MouseInputManager}(input=cc.input||(cc.input={}))}(cc||(cc={}));var cc;!function(cc){var input;!function(input){function buildKeyModifiers(){var modifiers={};return modifiers[input.KEYS.command]=!1,modifiers[input.KEYS.commandright]=!1,modifiers[input.KEYS.ctrl]=!1,modifiers[input.KEYS.shift]=!1,modifiers[input.KEYS.alt]=!1,modifiers}input.KEYS={enter:13,backspace:8,tab:9,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,command:91,meta:91,select:93,rcommand:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equalsign:187,comma:188,dash:189,period:190,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222,commandright:224};var KeyInfo=function(){function KeyInfo(keyDef){this.key=null,this.modifiers=null,this.isValid=!0,this.modifiers=buildKeyModifiers();for(var keys=keyDef.split("+"),i=0;i<keys.length-1;i++)this.modifiers.hasOwnProperty(cc.input.KEYS[keys[i]])?this.modifiers[cc.input.KEYS[keys[i]]]=!0:(this.isValid=!1,console.log("wrong key modifier: '"+keys[i]+"' in key definition: "+keyDef));var key=keys[keys.length-1];input.KEYS.hasOwnProperty(key)?this.key=input.KEYS[key]:(this.isValid=!1,console.log("wrong key '"+key+"' in key definition: "+keyDef))}return KeyInfo.prototype.matches=function(key,modifiers){return this.key===key&&modifiers.ctrl===this.modifiers.ctrl&&modifiers.alt===this.modifiers.alt&&modifiers.shift===this.modifiers.shift&&modifiers.command===this.modifiers.command&&modifiers.commandright===this.modifiers.commandright},KeyInfo}();input.KeyInfo=KeyInfo;var KeyActionInfo=function(){function KeyActionInfo(keys,action,callback){this._keys=[],this._action=null,this._callback=null,this._currentKeyInfoIndex=-1,this._time=-1,this._id=KeyboardIdGenerator(),this._typeTime=1e3,this._action=action,this._callback=callback,this.__parseKeys(keys)}return KeyActionInfo.prototype.getId=function(){return this._id},KeyActionInfo.prototype.__parseKeys=function(keys){for(var keyDefs=keys.split(" "),i=0;i<keyDefs.length;i++){var keyDef=new KeyInfo(keyDefs[i]);keyDef.isValid&&this._keys.push(keyDef)}},KeyActionInfo.prototype.down=function(modifiers,key,time){"down"===this._action&&this.__checkKey(key,modifiers,time)},KeyActionInfo.prototype.up=function(modifiers,key,time){"up"===this._action&&this.__checkKey(key,modifiers,time)},KeyActionInfo.prototype.__checkKey=function(key,modifiers,time){time-this._time>this._typeTime&&(this._currentKeyInfoIndex=-1),-1===this._currentKeyInfoIndex&&(this._currentKeyInfoIndex=0,this._time=time),this._keys[this._currentKeyInfoIndex].matches(key,modifiers)?(this._currentKeyInfoIndex++,this._time=time,this._currentKeyInfoIndex===this._keys.length&&(this._callback(),this._currentKeyInfoIndex=-1)):this._currentKeyInfoIndex=-1},KeyActionInfo.prototype.setSequenceTypeMaxTime=function(m){return this._typeTime=m,this},KeyActionInfo}();input.KeyActionInfo=KeyActionInfo;var KeyboardIdGenerator=function(){var index=0;return function(){return index++}}(),KeyboardCursor=function(){function KeyboardCursor(kim,cd,callback){this._upPressed=!1,this._downPressed=!1,this._leftPressed=!1,this._rightPressed=!1,this._actionInfoIds=[],this._id=KeyboardIdGenerator();var me=this;this._callback=callback,this.__registerKeys(kim,cd.up,function(){me._upPressed=!0,me.__onKeyChange("up",me._upPressed)},function(){me._upPressed=!1,me.__onKeyChange("up",me._upPressed)}),this.__registerKeys(kim,cd.down,function(){me._downPressed=!0,me.__onKeyChange("down",me._downPressed)},function(){me._downPressed=!1,me.__onKeyChange("down",me._downPressed)}),this.__registerKeys(kim,cd.left,function(){me._leftPressed=!0,me.__onKeyChange("left",me._leftPressed)},function(){me._leftPressed=!1,me.__onKeyChange("left",me._leftPressed)}),this.__registerKeys(kim,cd.right,function(){me._rightPressed=!0,me.__onKeyChange("right",me._rightPressed)},function(){me._rightPressed=!1,me.__onKeyChange("right",me._rightPressed)})}return KeyboardCursor.prototype.__onKeyChange=function(key,pressed){this._callback(key,pressed,input.KEYS[key])},KeyboardCursor.prototype.__registerKeys=function(kim,keysdesc,callbackdown,callbackup){for(var keys=keysdesc.split(" "),i=0;i<keys.length;i++)this._actionInfoIds.push(kim.onDown(keys[i],callbackdown)),this._actionInfoIds.push(kim.onUp(keys[i],callbackup))},KeyboardCursor.prototype.getId=function(){return this._id},KeyboardCursor.prototype.unregister=function(kim){for(var i=0;i<this._actionInfoIds.length;i++)kim.removeActionInfo(this._actionInfoIds[i])},Object.defineProperty(KeyboardCursor.prototype,"up",{get:function(){return this._upPressed},enumerable:!0,configurable:!0}),Object.defineProperty(KeyboardCursor.prototype,"down",{get:function(){return this._downPressed},enumerable:!0,configurable:!0}),Object.defineProperty(KeyboardCursor.prototype,"left",{get:function(){return this._leftPressed},enumerable:!0,configurable:!0}),Object.defineProperty(KeyboardCursor.prototype,"right",{get:function(){return this._rightPressed},enumerable:!0,configurable:!0}),KeyboardCursor}();input.KeyboardCursor=KeyboardCursor;var KeyboardInputManager=function(){function KeyboardInputManager(){this._enabled=!1,this._modifiers=null,this._cursors={},this._onDown=null,this._onUp=null,this._keyActionInfos=[],this._onDown=this.__onDown.bind(this),this._onUp=this.__onUp.bind(this),this._modifiers=buildKeyModifiers()}return KeyboardInputManager.prototype.__onDown=function(e){var key=e.which?e.which:e.keyCode,time=(new Date).getTime();if(!this.__setModifiers(key,!0))for(var i=0;i<this._keyActionInfos.length;i++)this._keyActionInfos[i].down(this._modifiers,key,time)},KeyboardInputManager.prototype.__onUp=function(e){var key=e.which?e.which:e.keyCode,time=(new Date).getTime();if(!this.__setModifiers(key,!1))for(var i=0;i<this._keyActionInfos.length;i++)this._keyActionInfos[i].up(this._modifiers,key,time)},KeyboardInputManager.prototype.__setModifiers=function(key,down){return this._modifiers.hasOwnProperty(key)?(this._modifiers[key]=down,!0):!1},KeyboardInputManager.prototype.enable=function(){this._enabled||(window.addEventListener("keydown",this._onDown,!1),window.addEventListener("keyup",this._onUp,!1),this._enabled=!0)},KeyboardInputManager.prototype.disable=function(){this._enabled&&(window.removeEventListener("keydown",this._onDown,!1),window.removeEventListener("keyup",this._onUp,!1),this._enabled=!1)},KeyboardInputManager.prototype.onDown=function(keys,callback){var kai=new KeyActionInfo(keys,"down",callback);return this._keyActionInfos.push(kai),kai.getId()},KeyboardInputManager.prototype.onUp=function(keys,callback){var kai=new KeyActionInfo(keys,"up",callback);return this._keyActionInfos.push(kai),kai.getId()},KeyboardInputManager.prototype.registerCursor=function(cd,callback){var kc=new KeyboardCursor(this,cd,callback);return this._cursors[kc.getId()]=kc,kc.getId()},KeyboardInputManager.prototype.unregisterCursor=function(id){this._cursors.hasOwnProperty(id)&&(this._cursors[id].unregister(this),this._cursors[id]=null)},KeyboardInputManager.prototype.removeActionInfo=function(id){for(var i=0;i<this._keyActionInfos.length;i++)if(this._keyActionInfos[i].getId()===id)return void this._keyActionInfos.splice(i,1)},KeyboardInputManager}();input.KeyboardInputManager=KeyboardInputManager}(input=cc.input||(cc.input={}))}(cc||(cc={}));var cc;!function(cc){var game;!function(_game){var Game=function(){function Game(){this._director=new cc.node.Director}return Game.prototype.setDesignResolutionSize=function(ri){"undefined"==typeof ri&&(ri={width:800,height:600}),"undefined"==typeof ri.canvasPosition&&(ri.canvasPosition="center"),"undefined"==typeof ri.scaleStrategy&&(ri.scaleStrategy="scale_aspect"),"undefined"==typeof ri.orientation&&(ri.orientation="both");var renderer;"string"==typeof ri.renderer&&(renderer="canvas"===ri.renderer?new cc.render.CanvasRenderer(ri.width,ri.height,document.getElementById(ri.canvasElement)):"webgl"===ri.renderer?new cc.render.WebGLRenderer(ri.width,ri.height,document.getElementById(ri.canvasElement)):cc.render.autodetectRenderer(ri.width,ri.height,ri.canvasElement)),this._director.setRenderer(renderer),this._renderer=renderer,ri.scaleStrategy=ri.scaleStrategy.toUpperCase(),ri.canvasPosition=ri.canvasPosition.toUpperCase(),ri.orientation=ri.orientation.toUpperCase();var st=cc.render.ScaleManagerStrategy[ri.scaleStrategy]||1,sp=cc.render.ScalePosition[ri.canvasPosition]||1,co=cc.render.OrientationStrategy[ri.orientation]||0;return this._renderer.setScaleStrategy(st,sp),this._renderer.setOrientationStrategy(co),this},Game.prototype.load=function(assets,_onLoad,_onProgress,_onError){var me=this;cc.plugin.asset.AssetManager.load({resources:assets},function(resources){cc.__BACKWARDS_COMPATIBILITY__&&cc.plugin.asset.AssetManager.mergeResources(resources),_onLoad(me)},function(resource,index,size,errored){"undefined"!=typeof _onProgress&&_onProgress(resource,index,size,errored)},function(resource){"undefined"!=typeof _onError&&_onError(resource)})},Game.prototype.runScene=function(scene){this._director.runScene(scene)},Game.prototype.getScaleManager=function(){return this._renderer.getScaleManager()},Game.prototype.setScaleStrategy=function(ss,sp){this._renderer.setScaleStrategy(ss,sp)},Game.prototype.setScaleContent=function(w,h,cw,ch){return this._renderer.setScaleContent(w,h,cw,ch),this._renderer.getUnitsFactor()},Game.prototype.getUnitsFactor=function(){return this._renderer.getUnitsFactor()},Game.prototype.setOrientationStrategy=function(os,onOk,onError){this._renderer.forceOrientation(os,onOk,onError)},Game.prototype.isFullScreenCapable=function(){return this._renderer.isFullScreenCapable()},Game.prototype.isFullScreen=function(){return this._renderer.isFullScreen()},Game.prototype.startFullScreen=function(f){this._renderer.startFullScreen(f)},Game.prototype.endFullScreen=function(f){this._renderer.endFullScreen(f)},Game}();_game.Game=Game}(game=cc.game||(cc.game={}))}(cc||(cc={}));var cc;!function(cc){function animate(animation){return new AnimateAction(animation)}function callFunc(fn,_this,data){return(new Action).onEnd(function(action,target){"undefined"!=typeof _this?fn.call(_this,target,data):fn(target,data)})}function show(){return(new Action).onEnd(function(action,target){target.setVisible(!action._reversed)})}function toggleVisibility(){return(new Action).onEnd(function(action,target){target.setVisible(!target.__isFlagSet(8))})}function hide(){return(new Action).onEnd(function(action,target){target.setVisible(action._reversed)})}function place(v){return(new Action).onEnd(function(action,target){target.setPosition(v.x,v.y)})}function blink(timeInSecs,blinks){var originalVisibility=!0,action=(new Action).timeInfo(0,timeInSecs).onStart(function(action,node){originalVisibility=node.__isFlagSet(8)}).onEnd(function(action,node){node.setVisible(originalVisibility)});return action.update=function(delta,node){delta%=1/blinks,node.setVisible(delta>=1/blinks/2)},action}function jumpTo(timeInSecs,pos,amplitude,jumps){return void 0===jumps&&(jumps=1),__jump(timeInSecs,pos,amplitude,jumps,!1)}function jumpBy(timeInSecs,pos,amplitude,jumps){return void 0===jumps&&(jumps=1),__jump(timeInSecs,pos,amplitude,jumps,!0)}function __jump(timeInSecs,pos,amplitude,jumps,relative){return new JumpAction({type:"JumpAction",position:pos,jumps:jumps,amplitude:amplitude,relative:relative}).timeInfo(0,timeInSecs)}function __catmull(timeInSecs,p,tension,relative,closed){var segment=(new Path).catmullRomTo(p,closed,tension);return new PathAction({type:"PathAction",segment:segment}).setRelative(relative).timeInfo(0,timeInSecs)}function cardinalSplineTo(timeInSecs,p,tension,closed){return void 0===closed&&(closed=!1),__catmull(timeInSecs,p,tension,!1,closed)}function cardinalSplineBy(timeInSecs,p,tension,closed){return void 0===closed&&(closed=!1),__catmull(timeInSecs,p,tension,!0,closed)}function catmullRomTo(timeInSecs,p,closed){return void 0===closed&&(closed=!1),__catmull(timeInSecs,p,0,!1,closed)}function catmullRomBy(timeInSecs,p,closed){return void 0===closed&&(closed=!1),__catmull(timeInSecs,p,0,!0,closed)}function __bezier(timeInSecs,p,relative){return new PathAction({type:"PathAction",segment:new SegmentBezier({p0:{x:0,y:0},p1:p[0],p2:p[1],p3:p[2]})}).setRelative(relative).timeInfo(0,timeInSecs)}function bezierTo(timeInSecs,p){return __bezier(timeInSecs,p,!1)}function bezierBy(timeInSecs,p){return __bezier(timeInSecs,p,!0)}function __move(timeInSecs,p,relative){return(new MoveAction).to(p).setRelative(relative).timeInfo(0,timeInSecs)}function moveTo(timeInSecs,p){return __move(timeInSecs,p,!1)}function moveBy(timeInSecs,p){return __move(timeInSecs,p,!0)}function __scale(timeInSecs,x,y,relative){return(new ScaleAction).to({x:x,y:y}).setRelative(relative).timeInfo(0,timeInSecs)}function scaleTo(timeInSecs,x,y){return __scale(timeInSecs,x,"undefined"==typeof y?x:y,!1)}function scaleBy(timeInSecs,x,y){return __scale(timeInSecs,x,"undefined"==typeof y?x:y,!0)}function __rotate(timeInSecs,a,relative){return(new RotateAction).to(a).setRelative(relative).timeInfo(0,timeInSecs)}function rotateTo(timeInSecs,a){return __rotate(timeInSecs,a,!1)}function rotateBy(timeInSecs,a){return __rotate(timeInSecs,a,!0)}function fadeIn(timeInSecs){return(new AlphaAction).from(0).to(1).timeInfo(0,timeInSecs)}function fadeOut(timeInSecs){return(new AlphaAction).from(1).to(0).timeInfo(0,timeInSecs)}function __fade(timeInSecs,a,relative){return(new AlphaAction).to(a/255).setRelative(relative).timeInfo(0,timeInSecs)}function fadeTo(timeInSecs,a){return __fade(timeInSecs,a,!1)}function fadeBy(timeInSecs,a){return __fade(timeInSecs,a,!0)}function __tint(timeInSecs,r,g,b,relative){return(new TintAction).to({r:r/255,g:g/255,b:b/255}).setRelative(relative).timeInfo(0,timeInSecs)}function tintTo(timeInSecs,r,g,b){return __tint(timeInSecs,r,g,b,!1)}function tintBy(timeInSecs,r,g,b){return __tint(timeInSecs,r,g,b,!0)}function reverseTime(action){return action.setReversedTime(!action.isReversedTime()),this}function repeat(action,times){return 1>times&&(times=1),action.setRepeatTimes(times),action}function repeatForever(action){return action.setRepeatForever(),action}function delayTime(delayInSecs){return(new PropertyAction).from({}).to({}).timeInfo(0,delayInSecs)}function __sequence(sequential,actions){var seq=new SequenceAction({sequential:sequential});if(!actions.length)return null;for(var i=0;i<actions.length;i++)seq.addAction(actions[i]);return seq}function speed(action,speed){return action.setSpeed(speed),action}function sequence(){for(var actions=[],_i=0;_i<arguments.length;_i++)actions[_i-0]=arguments[_i];return __sequence(!0,actions)}function spawn(){for(var actions=[],_i=0;_i<arguments.length;_i++)actions[_i-0]=arguments[_i];return __sequence(!1,actions)}function easing(action,interpolator){return action.easing(interpolator)}function __interpolator(interpolator,action){return"undefined"!=typeof action?easing(action,interpolator):interpolator}function easeBackIn(action){return __interpolator(Interpolator.EaseBackIn(!1,!1),action)}function easeBackOut(action){return __interpolator(Interpolator.EaseBackOut(!1,!1),action)}function easeBackInOut(action){return __interpolator(Interpolator.EaseBackInOut(!1,!1),action)}function easeBounceIn(action){return __interpolator(Interpolator.EaseBounceIn(!1,!1),action)}function easeBounceOut(action){return __interpolator(Interpolator.EaseBounceOut(!1,!1),action)}function easeBounceInOut(action){return __interpolator(Interpolator.EaseBounceInOut(!1,!1),action)}function easeElasticIn(action,period){var int=Interpolator.EaseElasticIn("undefined"==typeof action?action:period,!1,!1);return __interpolator(int,action)}function easeElasticOut(action,period){var int=Interpolator.EaseElasticOut("undefined"==typeof action?action:period,!1,!1);return __interpolator(int,action)}function easeElasticInOut(action,period){var int=Interpolator.EaseElasticInOut("undefined"==typeof action?action:period,!1,!1);return __interpolator(int,action)}function easeIn(action,exponent){var int=Interpolator.EaseIn("undefined"==typeof action?action:exponent,!1,!1);return __interpolator(int,action)}function easeOut(action,exponent){var int=Interpolator.EaseOut("undefined"==typeof action?action:exponent,!1,!1);return __interpolator(int,action)}function easeInOut(action,exponent){var int=Interpolator.EaseInOut("undefined"==typeof action?action:exponent,!1,!1);return __interpolator(int,action)}function easeExponentialIn(action){return __interpolator(Interpolator.EaseExponentialIn(!1,!1),action)}function easeExponentialOut(action){return __interpolator(Interpolator.EaseExponentialOut(!1,!1),action)}function easeExponentialInOut(action){return __interpolator(Interpolator.EaseExponentialInOut(!1,!1),action)}function easeSineIn(action){return __interpolator(Interpolator.EaseSineIn(!1,!1),action)}function easeSineOut(action){return __interpolator(Interpolator.EaseSineOut(!1,!1),action)}function easeSineInOut(action){return __interpolator(Interpolator.EaseSineInOut(!1,!1),action)}function easeQuadraticActionIn(action){return __interpolator(Interpolator.EaseIn(2,!1,!1),action)}function easeQuadraticActionOut(action){return __interpolator(Interpolator.EaseOut(2,!1,!1),action)}function easeQuadraticActionInOut(action){return __interpolator(Interpolator.EaseInOut(2,!1,!1),action)}function easeCubicActionIn(action){return __interpolator(Interpolator.EaseIn(3,!1,!1),action)}function easeCubicActionOut(action){return __interpolator(Interpolator.EaseOut(3,!1,!1),action)}function easeCubicActionInOut(action){return __interpolator(Interpolator.EaseInOut(3,!1,!1),action)}function easeQuarticlActionIn(action){return __interpolator(Interpolator.EaseIn(4,!1,!1),action)}function easeQuarticActionOut(action){return __interpolator(Interpolator.EaseOut(4,!1,!1),action)}function easeQuarticActionInOut(action){return __interpolator(Interpolator.EaseInOut(4,!1,!1),action)}function easeQuinticActionIn(action){return __interpolator(Interpolator.EaseIn(5,!1,!1),action)}function easeQuinticActionOut(action){return __interpolator(Interpolator.EaseOut(5,!1,!1),action)}function easeQuinticActionInOut(action){return __interpolator(Interpolator.EaseInOut(5,!1,!1),action)}cc.__BACKWARDS_COMPATIBILITY__=!0;var Action=(cc.node.NodeDirtyFlags,cc.action.Action),MoveAction=cc.action.MoveAction,RotateAction=cc.action.RotateAction,PropertyAction=cc.action.PropertyAction,SequenceAction=cc.action.SequenceAction,TintAction=cc.action.TintAction,AlphaAction=cc.action.AlphaAction,ScaleAction=cc.action.ScaleAction,AnimateAction=cc.action.AnimateAction,PathAction=cc.action.PathAction,JumpAction=cc.action.JumpAction,SegmentBezier=cc.math.path.SegmentBezier,Path=cc.math.Path,Interpolator=cc.action.Interpolator;cc.animate=animate,cc.callFunc=callFunc,cc.show=show,cc.toggleVisibility=toggleVisibility,cc.hide=hide,cc.place=place,cc.blink=blink,cc.jumpTo=jumpTo,cc.jumpBy=jumpBy,cc.cardinalSplineTo=cardinalSplineTo,cc.cardinalSplineBy=cardinalSplineBy,cc.catmullRomTo=catmullRomTo,cc.catmullRomBy=catmullRomBy,cc.bezierTo=bezierTo,cc.bezierBy=bezierBy,cc.moveTo=moveTo,cc.moveBy=moveBy,cc.scaleTo=scaleTo,cc.scaleBy=scaleBy,cc.rotateTo=rotateTo,cc.rotateBy=rotateBy,cc.fadeIn=fadeIn,cc.fadeOut=fadeOut,cc.fadeTo=fadeTo,cc.fadeBy=fadeBy,cc.tintTo=tintTo,cc.tintBy=tintBy,cc.reverseTime=reverseTime,cc.repeat=repeat,cc.repeatForever=repeatForever,cc.delayTime=delayTime,cc.__sequence=__sequence,cc.speed=speed,cc.sequence=sequence,cc.spawn=spawn,cc.easing=easing,cc.easeBackIn=easeBackIn,cc.easeBackOut=easeBackOut,cc.easeBackInOut=easeBackInOut,cc.easeBounceIn=easeBounceIn,cc.easeBounceOut=easeBounceOut,cc.easeBounceInOut=easeBounceInOut,cc.easeElasticIn=easeElasticIn,cc.easeElasticOut=easeElasticOut,cc.easeElasticInOut=easeElasticInOut,cc.easeIn=easeIn,cc.easeOut=easeOut,cc.easeInOut=easeInOut,cc.easeExponentialIn=easeExponentialIn,cc.easeExponentialOut=easeExponentialOut,cc.easeExponentialInOut=easeExponentialInOut,cc.easeSineIn=easeSineIn,cc.easeSineOut=easeSineOut,cc.easeSineInOut=easeSineInOut,cc.easeQuadraticActionIn=easeQuadraticActionIn,cc.easeQuadraticActionOut=easeQuadraticActionOut,cc.easeQuadraticActionInOut=easeQuadraticActionInOut,cc.easeCubicActionIn=easeCubicActionIn,cc.easeCubicActionOut=easeCubicActionOut,cc.easeCubicActionInOut=easeCubicActionInOut,cc.easeQuarticlActionIn=easeQuarticlActionIn,cc.easeQuarticActionOut=easeQuarticActionOut,cc.easeQuarticActionInOut=easeQuarticActionInOut,cc.easeQuinticActionIn=easeQuinticActionIn,cc.easeQuinticActionOut=easeQuinticActionOut,cc.easeQuinticActionInOut=easeQuinticActionInOut}(cc||(cc={}));var cc;!function(cc){var EaseBackIn;!function(EaseBackIn){EaseBackIn.create=cc.easeBackIn}(EaseBackIn=cc.EaseBackIn||(cc.EaseBackIn={}));var EaseBackOut;!function(EaseBackOut){EaseBackOut.create=cc.easeBackOut}(EaseBackOut=cc.EaseBackOut||(cc.EaseBackOut={}));var EaseBackInOut;!function(EaseBackInOut){EaseBackInOut.create=cc.easeBackInOut}(EaseBackInOut=cc.EaseBackInOut||(cc.EaseBackInOut={}));var EaseBounceIn;!function(EaseBounceIn){EaseBounceIn.create=cc.easeBounceIn}(EaseBounceIn=cc.EaseBounceIn||(cc.EaseBounceIn={}));var EaseBounceOut;!function(EaseBounceOut){EaseBounceOut.create=cc.easeBounceOut}(EaseBounceOut=cc.EaseBounceOut||(cc.EaseBounceOut={}));var EaseBounceInOut;!function(EaseBounceInOut){EaseBounceInOut.create=cc.easeBounceInOut}(EaseBounceInOut=cc.EaseBounceInOut||(cc.EaseBounceInOut={}));var EaseElasticIn;!function(EaseElasticIn){EaseElasticIn.create=cc.easeElasticIn}(EaseElasticIn=cc.EaseElasticIn||(cc.EaseElasticIn={}));var EaseElasticOut;!function(EaseElasticOut){EaseElasticOut.create=cc.easeElasticOut}(EaseElasticOut=cc.EaseElasticOut||(cc.EaseElasticOut={}));var EaseElasticInOut;!function(EaseElasticInOut){EaseElasticInOut.create=cc.easeElasticInOut}(EaseElasticInOut=cc.EaseElasticInOut||(cc.EaseElasticInOut={}));var EaseSineIn;!function(EaseSineIn){EaseSineIn.create=cc.easeSineIn}(EaseSineIn=cc.EaseSineIn||(cc.EaseSineIn={}));var EaseSineOut;!function(EaseSineOut){EaseSineOut.create=cc.easeSineOut}(EaseSineOut=cc.EaseSineOut||(cc.EaseSineOut={}));var EaseSineInOut;!function(EaseSineInOut){EaseSineInOut.create=cc.easeSineInOut}(EaseSineInOut=cc.EaseSineInOut||(cc.EaseSineInOut={}));var CatmullRomTo;!function(CatmullRomTo){CatmullRomTo.create=cc.catmullRomTo}(CatmullRomTo=cc.CatmullRomTo||(cc.CatmullRomTo={}));var CatmullRomBy;!function(CatmullRomBy){CatmullRomBy.create=cc.catmullRomBy}(CatmullRomBy=cc.CatmullRomBy||(cc.CatmullRomBy={}));var CardinalSplineTo;!function(CardinalSplineTo){CardinalSplineTo.create=cc.cardinalSplineTo}(CardinalSplineTo=cc.CardinalSplineTo||(cc.CardinalSplineTo={}));var CardinalSplineBy;!function(CardinalSplineBy){CardinalSplineBy.create=cc.cardinalSplineBy}(CardinalSplineBy=cc.CardinalSplineBy||(cc.CardinalSplineBy={}));var BezierTo;!function(BezierTo){BezierTo.create=cc.bezierTo}(BezierTo=cc.BezierTo||(cc.BezierTo={}));var BezierBy;!function(BezierBy){BezierBy.create=cc.bezierBy}(BezierBy=cc.BezierBy||(cc.BezierBy={}));var MoveTo;!function(MoveTo){MoveTo.create=cc.moveTo}(MoveTo=cc.MoveTo||(cc.MoveTo={}));var MoveBy;!function(MoveBy){MoveBy.create=cc.moveBy}(MoveBy=cc.MoveBy||(cc.MoveBy={}));var ScaleTo;!function(ScaleTo){ScaleTo.create=cc.scaleTo}(ScaleTo=cc.ScaleTo||(cc.ScaleTo={}));var ScaleBy;!function(ScaleBy){ScaleBy.create=cc.scaleBy}(ScaleBy=cc.ScaleBy||(cc.ScaleBy={}));var RotateTo;!function(RotateTo){RotateTo.create=cc.rotateTo}(RotateTo=cc.RotateTo||(cc.RotateTo={}));var RotateBy;!function(RotateBy){RotateBy.create=cc.rotateBy}(RotateBy=cc.RotateBy||(cc.RotateBy={}));var FadeIn;!function(FadeIn){FadeIn.create=cc.fadeIn}(FadeIn=cc.FadeIn||(cc.FadeIn={}));var FadeOut;!function(FadeOut){FadeOut.create=cc.fadeOut}(FadeOut=cc.FadeOut||(cc.FadeOut={}));var FadeTo;!function(FadeTo){FadeTo.create=cc.fadeTo}(FadeTo=cc.FadeTo||(cc.FadeTo={}));var FadeBy;!function(FadeBy){FadeBy.create=cc.fadeBy}(FadeBy=cc.FadeBy||(cc.FadeBy={}));var TintTo;!function(TintTo){TintTo.create=cc.tintTo}(TintTo=cc.TintTo||(cc.TintTo={}));var TintBy;!function(TintBy){TintBy.create=cc.tintBy}(TintBy=cc.TintBy||(cc.TintBy={}));var ReverseTime;!function(ReverseTime){ReverseTime.create=cc.reverseTime}(ReverseTime=cc.ReverseTime||(cc.ReverseTime={}));var Repeat;!function(Repeat){Repeat.create=cc.repeat}(Repeat=cc.Repeat||(cc.Repeat={}));var RepeatForever;!function(RepeatForever){RepeatForever.create=cc.repeatForever}(RepeatForever=cc.RepeatForever||(cc.RepeatForever={}));var DelayTime;!function(DelayTime){DelayTime.create=cc.delayTime}(DelayTime=cc.DelayTime||(cc.DelayTime={}));var Speed;!function(Speed){Speed.create=cc.speed}(Speed=cc.Speed||(cc.Speed={}));var Sequence;!function(Sequence){Sequence.create=cc.sequence}(Sequence=cc.Sequence||(cc.Sequence={}));var Spawn;!function(Spawn){Spawn.create=cc.spawn}(Spawn=cc.Spawn||(cc.Spawn={}));var Easing;!function(Easing){Easing.create=cc.easing}(Easing=cc.Easing||(cc.Easing={}));var EaseIn;!function(EaseIn){EaseIn.create=cc.easeIn}(EaseIn=cc.EaseIn||(cc.EaseIn={}));var EaseOut;!function(EaseOut){EaseOut.create=cc.easeOut}(EaseOut=cc.EaseOut||(cc.EaseOut={}));var EaseInOut;!function(EaseInOut){EaseInOut.create=cc.easeInOut}(EaseInOut=cc.EaseInOut||(cc.EaseInOut={}));var EaseExponentialIn;!function(EaseExponentialIn){EaseExponentialIn.create=cc.easeExponentialIn}(EaseExponentialIn=cc.EaseExponentialIn||(cc.EaseExponentialIn={}));var EaseExponentialOut;!function(EaseExponentialOut){EaseExponentialOut.create=cc.easeExponentialOut}(EaseExponentialOut=cc.EaseExponentialOut||(cc.EaseExponentialOut={}));var EaseExponentialInOut;!function(EaseExponentialInOut){EaseExponentialInOut.create=cc.easeExponentialInOut}(EaseExponentialInOut=cc.EaseExponentialInOut||(cc.EaseExponentialInOut={}));var EaseQuadraticActionIn;!function(EaseQuadraticActionIn){EaseQuadraticActionIn.create=cc.easeQuadraticActionIn}(EaseQuadraticActionIn=cc.EaseQuadraticActionIn||(cc.EaseQuadraticActionIn={}));var EaseQuadraticActionOut;!function(EaseQuadraticActionOut){EaseQuadraticActionOut.create=cc.easeQuadraticActionOut}(EaseQuadraticActionOut=cc.EaseQuadraticActionOut||(cc.EaseQuadraticActionOut={}));var EaseQuadraticActionInOut;!function(EaseQuadraticActionInOut){EaseQuadraticActionInOut.create=cc.easeQuadraticActionInOut}(EaseQuadraticActionInOut=cc.EaseQuadraticActionInOut||(cc.EaseQuadraticActionInOut={}));var EaseCubicActionIn;!function(EaseCubicActionIn){EaseCubicActionIn.create=cc.easeCubicActionIn}(EaseCubicActionIn=cc.EaseCubicActionIn||(cc.EaseCubicActionIn={}));var EaseCubicActionOut;!function(EaseCubicActionOut){EaseCubicActionOut.create=cc.easeCubicActionOut}(EaseCubicActionOut=cc.EaseCubicActionOut||(cc.EaseCubicActionOut={}));var EaseCubicInOut;!function(EaseCubicInOut){EaseCubicInOut.create=cc.easeCubicActionInOut}(EaseCubicInOut=cc.EaseCubicInOut||(cc.EaseCubicInOut={}));var EaseQuarticActionIn;!function(EaseQuarticActionIn){EaseQuarticActionIn.create=cc.easeQuarticlActionIn}(EaseQuarticActionIn=cc.EaseQuarticActionIn||(cc.EaseQuarticActionIn={}));var EaseQuarticActionOut;!function(EaseQuarticActionOut){EaseQuarticActionOut.create=cc.easeQuarticActionOut}(EaseQuarticActionOut=cc.EaseQuarticActionOut||(cc.EaseQuarticActionOut={}));var EaseQuarticActionInOut;!function(EaseQuarticActionInOut){EaseQuarticActionInOut.create=cc.easeQuarticActionInOut}(EaseQuarticActionInOut=cc.EaseQuarticActionInOut||(cc.EaseQuarticActionInOut={}));var EaseQuinticActionIn;!function(EaseQuinticActionIn){EaseQuinticActionIn.create=cc.easeQuinticActionIn}(EaseQuinticActionIn=cc.EaseQuinticActionIn||(cc.EaseQuinticActionIn={}));var EaseQuinticActionOut;!function(EaseQuinticActionOut){EaseQuinticActionOut.create=cc.easeQuinticActionOut}(EaseQuinticActionOut=cc.EaseQuinticActionOut||(cc.EaseQuinticActionOut={}));var EaseQuinticActionInOut;!function(EaseQuinticActionInOut){EaseQuinticActionInOut.create=cc.easeQuinticActionInOut}(EaseQuinticActionInOut=cc.EaseQuinticActionInOut||(cc.EaseQuinticActionInOut={}));var CallFunc;!function(CallFunc){CallFunc.create=cc.callFunc}(CallFunc=cc.CallFunc||(cc.CallFunc={}));var Animate;!function(Animate){Animate.create=cc.animate}(Animate=cc.Animate||(cc.Animate={}));var Show;!function(Show){Show.create=cc.show}(Show=cc.Show||(cc.Show={}));var Hide;!function(Hide){Hide.create=cc.hide}(Hide=cc.Hide||(cc.Hide={}));var Place;!function(Place){Place.create=cc.place}(Place=cc.Place||(cc.Place={}));var ToggleVisibility;!function(ToggleVisibility){ToggleVisibility.create=cc.toggleVisibility}(ToggleVisibility=cc.ToggleVisibility||(cc.ToggleVisibility={}));var JumpTo;!function(JumpTo){JumpTo.create=cc.jumpTo}(JumpTo=cc.JumpTo||(cc.JumpTo={}));var JumpBy;!function(JumpBy){JumpBy.create=cc.jumpBy}(JumpBy=cc.JumpBy||(cc.JumpBy={}));var Blink;!function(Blink){Blink.create=cc.blink}(Blink=cc.Blink||(cc.Blink={}))}(cc||(cc={}));var cc;!function(cc){function rect(x,y,w,h){return new cc.math.Rectangle(x,y,w,h)}function p(x,y){return new Vector(x,y)}function size(w,h){return new cc.math.Dimension(w,h)}function c3b(r,g,b){return new cc.math.Color(r/255,g/255,b/255)}function c4b(r,g,b,a){return new cc.math.Color(r/255,g/255,b/255,a/255)}function color(r,g,b,a){return"undefined"==typeof r?Color.BLACK:"string"==typeof r?Color.fromStringToColor(r):"object"==typeof r?Color.createFromRGBA(r):("undefined"==typeof a&&(a=255),new Color(r/255,g/255,b/255,a/255))}function scene(){return new cc.node.Scene}function animation(){return new cc.node.sprite.Animation}function sprite(p){return new cc.node.Sprite(p)}function layer(){return new cc.node.Node}function Animation(frames,duration){var animation=new cc.node.sprite.Animation;return animation.addFrames(frames),animation.setDelayPerUnit(duration),animation}function clampf(value,min_inclusive,max_inclusive){if(min_inclusive>max_inclusive){var temp=min_inclusive;min_inclusive=max_inclusive,max_inclusive=temp}return min_inclusive>value?min_inclusive:max_inclusive>value?value:max_inclusive}function pClamp(p,min_inclusive,max_inclusive){return cc.p(cc.clampf(p.x,min_inclusive.x,max_inclusive.x),cc.clampf(p.y,min_inclusive.y,max_inclusive.y))}function rectIntersectsRect(r0,r1){return r0.intersectsWith(r1)}var Color=cc.math.Color,Vector=cc.math.Vector;cc.rect=rect,cc.p=p,cc.size=size,cc.c3b=c3b,cc.c4b=c4b,cc.color=color;var Director;!function(Director){function getInstance(){return null===directorInstance&&(directorInstance=new cc.node.Director),directorInstance}var directorInstance=null;Director.getInstance=getInstance}(Director=cc.Director||(cc.Director={})),cc.director=null,cc.scene=scene,cc.Scene=cc.node.Scene,cc.animation=animation,cc.sprite=sprite,cc.Sprite=cc.node.Sprite,cc.SpriteBatchNode=cc.node.SpriteBatchNode,cc.layer=layer,cc.Layer=cc.node.Node,cc.Node=cc.node.Node,cc.LabelBMFont=cc.widget.Label,cc.LabelTTF=cc.widget.LabelTTF,cc.Animation=Animation,Animation.create=cc.animation,cc.TransitionSlideInL=function(time_in_secs,scene){return new cc.transition.TransitionSlideInL(1e3*time_in_secs,scene)},cc.TransitionSlideInR=function(time_in_secs,scene){return new cc.transition.TransitionSlideInR(1e3*time_in_secs,scene)},cc.TransitionSlideInT=function(time_in_secs,scene){return new cc.transition.TransitionSlideInT(1e3*time_in_secs,scene)},cc.TransitionSlideInB=function(time_in_secs,scene){return new cc.transition.TransitionSlideInB(1e3*time_in_secs,scene)},cc.TransitionFade=function(time_in_secs,scene){return new cc.transition.TransitionFade(1e3*time_in_secs,scene)},cc.TEXT_ALIGNMENT_LEFT=0,cc.TEXT_ALIGNMENT_CENTER=1,cc.TEXT_ALIGNMENT_RIGHT=2,cc.VERTICAL_TEXT_ALIGNMENT_TOP=0,cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1,cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2,cc.pAdd=cc.math.Vector.add,cc.clampf=clampf,cc.pClamp=pClamp,cc.audioEngine=function(){var ae=new cc.plugin.audio.AudioManager;
return{playMusic:function(url){ae.setMusic(url,!0)},stopMusic:function(){ae.stopMusic()},stopAllEffects:function(){ae.stopEffects()},playEffect:function(name){var r=cc.plugin.asset.AssetManager._resources[name];r&&ae.playEffect(r)},setMusicVolume:function(vol){ae.setMusicVolume(vol)}}}(),cc.rectIntersectsRect=rectIntersectsRect,cc.KEY=cc.input.KEYS,cc.ONE=1,cc.ZERO=0,cc.SRC_ALPHA=770,cc.SRC_ALPHA_SATURATE=776,cc.SRC_COLOR=768,cc.DST_ALPHA=772,cc.DST_COLOR=774,cc.ONE_MINUS_SRC_ALPHA=771,cc.ONE_MINUS_SRC_COLOR=769,cc.ONE_MINUS_DST_ALPHA=773,cc.ONE_MINUS_DST_COLOR=775,cc.ONE_MINUS_CONSTANT_ALPHA=32772,cc.ONE_MINUS_CONSTANT_COLOR=32770}(cc||(cc={}));var cc;!function(cc){function getResource(id){var res=cc.plugin.asset.AssetManager._resources;return res[id]}var path={join:function(){for(var l=arguments.length,result="",i=0;l>i;i++)result=(result+(""==result?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return result},extname:function(pathStr){var temp=/(\.[^\.\/\?\\]*)(\?.*)?$/.exec(pathStr);return temp?temp[1]:null},mainFileName:function(fileName){if(fileName){var idx=fileName.lastIndexOf(".");if(-1!==idx)return fileName.substring(0,idx)}return fileName},basename:function(pathStr,extname){var index=pathStr.indexOf("?");index>0&&(pathStr=pathStr.substring(0,index));var reg=/(\/|\\\\)([^(\/|\\\\)]+)$/g,result=reg.exec(pathStr.replace(/(\/|\\\\)$/,""));if(!result)return null;var baseName=result[2];return extname&&pathStr.substring(pathStr.length-extname.length).toLowerCase()==extname.toLowerCase()?baseName.substring(0,baseName.length-extname.length):baseName},dirname:function(pathStr){return pathStr.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(pathStr,extname){extname=extname||"";var index=pathStr.indexOf("?"),tempStr="";return index>0&&(tempStr=pathStr.substring(index),pathStr=pathStr.substring(0,index)),index=pathStr.lastIndexOf("."),0>index?pathStr+extname+tempStr:pathStr.substring(0,index)+extname+tempStr},changeBasename:function(pathStr,basename,isSameExt){if(0==basename.indexOf("."))return this.changeExtname(pathStr,basename);var index=pathStr.indexOf("?"),tempStr="",ext=isSameExt?this.extname(pathStr):"";return index>0&&(tempStr=pathStr.substring(index),pathStr=pathStr.substring(0,index)),index=pathStr.lastIndexOf("/"),index=0>=index?0:index+1,pathStr.substring(0,index)+basename+ext+tempStr}},spriteFrameCache=function(){function spriteFrameCache(){}return spriteFrameCache.addSpriteFrames=function(plist_url_file){var plist=getResource(plist_url_file),imageName=plist[0].metadata.realTextureFileName,imageResFile=path.changeBasename(plist_url_file,imageName||".png",!1),resource=cc.plugin.asset.AssetManager._resources[imageResFile];cc.plugin.asset.AssetManager.addImage(resource,imageResFile),cc.director._renderer.prepareTexture(cc.plugin.asset.AssetManager.getTexture(imageResFile)),cc.plugin.asset.AssetManager.addSpriteFramesFromFrameWithPLIST(imageResFile,plist)},spriteFrameCache.getSpriteFrame=function(name){return cc.plugin.asset.AssetManager.getSpriteFrame(name)},spriteFrameCache}();cc.spriteFrameCache=spriteFrameCache;var textureCache=function(){function textureCache(){}return textureCache.addImage=function(name){var image=getResource(name),texture=cc.plugin.asset.AssetManager.addImage(image,name);return cc.director._renderer.prepareTexture(texture),texture},textureCache}();cc.textureCache=textureCache;var animationCache=function(){function animationCache(){}return animationCache.addAnimation=function(animation,name){cc.plugin.asset.AssetManager.addAnimation(animation,name)},animationCache.getAnimation=function(name){return cc.plugin.asset.AssetManager.getAnimationById(name)},animationCache}();cc.animationCache=animationCache}(cc||(cc={}));var cc;!function(cc){var initializing=!1,_Class=function(){};_Class.extend=function(extendingProt){var _super=this.prototype;initializing=!0;var prototype=new this;initializing=!1;var CCClass=function(){initializing||"undefined"==typeof this.ctor||this.ctor.apply(this,arguments)};CCClass.prototype=prototype,CCClass.prototype.constructor=CCClass,CCClass.superclass=_super,CCClass.extend=_Class.extend,CCClass.__CLASS=name,extendingProt="function"==typeof extendingProt?extendingProt():extendingProt;for(var fname in extendingProt){var isFunc="function"==typeof extendingProt[fname],overrideIsFunc="function"==typeof prototype[fname];prototype[fname]="ctor"===fname?function(name,fn,superconstructor){return function(){var tmp=this._super;this._super=function(){superconstructor.apply(this,arguments)};var ret=fn.apply(this,arguments);return this._super=tmp,ret}}(fname,extendingProt[fname],this):isFunc&&overrideIsFunc&&/\b_super\b/.test(extendingProt[fname])?function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);return this._super=tmp,ret}}(fname,extendingProt[fname]):extendingProt[fname]}return CCClass},cc.node.Node.extend=_Class.extend,cc.node.Sprite.extend=_Class.extend,cc.node.SpriteBatchNode.extend=_Class.extend,cc.node.Scene.extend=_Class.extend,cc.action.Action.extend=_Class.extend,cc.Class=_Class}(cc||(cc={}));
//# sourceMappingURL=all.min.js.map