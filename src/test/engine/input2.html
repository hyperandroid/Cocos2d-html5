<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Cocos2d-html5 Basic input control</title>

    <link rel="stylesheet" href="../css/genericons.css">
    <link rel="stylesheet" href="demos.css">
    <link rel="stylesheet" href="../css/templatestyles.css">
    <link rel="stylesheet" href="../stylesheets/pygment_trac.css">
    <link rel="stylesheet" id="open-sans-css"
          href="//fonts.googleapis.com/css?family=Open+Sans%3A300italic%2C400italic%2C600italic%2C300%2C400%2C600&amp;subset=latin%2Clatin-ext&amp;ver=4.1.1"
          type="text/css" media="all">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-17485141-5', 'auto');
      ga('send', 'pageview');

    </script>
    <style>

        .pressed {
            background: rgba(128,128,255,.5);
            border: 1px dotted #000;
        }

        .notpressed {
            background: rgba(255,255,255,.7);
            border: 1px solid #000;
        }

        .cursor {
            position:absolute;
            width:50px;
            height:50px;
            display:block;
        }

        .cursorup {
            left:70px;
            top:10px;
        }

        .cursordown {
            left:70px;
            top:70px;
        }

        .cursorleft {
            left: 10px;
            top:37px;
        }

        .cursorright {
            left: 130px;
            top:37px;
        }
    </style>
</head>
<body>

<button class="toggle" id="menutoggle">
</button>
<div class="wrapper">
<header>

    <div class="site-title">
        <div class="site-title-info">
            <h1>Cocos2d-html5</h1>
        </div>
        <div id="menu" class="site-menu">
            <div id="menuclose" class="close-button"><span class="icon-close"></span></div>
            <p class="demos-menu-title">Demos list</p>
            <ul id="site-menu" >

            </ul>
        </div>
    </div>
</header>

    <section>
        <div style="position:relative">
            <canvas id="c"></canvas>
            <div id="cursorUp" class="cursor notpressed cursorup"></div>
            <div id="cursorDown" class="cursor notpressed cursordown"></div>
            <div id="cursorLeft" class="cursor notpressed cursorleft"></div>
            <div id="cursorRight" class="cursor notpressed cursorright"></div>
        </div>
        <div>
            <div style="margin-left:10px;">
                <p>
                    This demo showcases input system, mouse, touch and keyboard.
                </p>

                <p>
                <li>Press 'a' twice to change scene color.</li>
                <li>Touch one sprite to make it react.</li>
                <li>Move the mouse over the sprites to see them react.</li>
                <li>Use WSDA cursor to move.</li>
                <li>Enter the code, Solid (up up down down left right left right b a).</li>
                </p>
            </div>
        </div>
    </section>
    <footer>
        <p>This project is maintained by <a href="https://github.com/hyperandroid">hyperandroid</a></p>
    </footer>
</div>
    <script src="../../../javascripts/scale.fix.js"></script>
    <script src="menu.js"></script>
    <script src="../../../dist/all.js"></script>

<script>
    (function() {
        document.getElementById("menutoggle").addEventListener("click", function(e) {
            e.preventDefault();
            document.getElementById("menu").style["display"]="block";
        }, false );
        document.getElementById("menuclose").addEventListener("click", function(e) {
            e.preventDefault();
            document.getElementById("menu").style["display"]="none";
        }, false );

        function setClass( node, nclass ) {
            var cl= node.className;

            cl= cl.replace("notpressed", "");
            cl= cl.replace("pressed", "");

            cl= cl.trim()+" "+nclass;

            node.className= cl;
        }

        var AssetManager= cc.plugin.asset.AssetManager;

        function loadResources() {
            AssetManager.load(
                    {
                        prefix : "../res/",
                        resources: ["dude.png@dude"] },
                    function onEnd(resources) {
                        initialize(resources);
                    }
            );
        }

        /**
         *
         * @param resources {Array<cc.plugin.loader.Resource}
         */
        function initialize( resources ) {

            var W=700;
            var H=600;

            AssetManager.addImage( resources['dude'], 'dude' );

            // the renderer will setup pre-loaded textures for the renderer type.
            // it will also create necessary SpriteFrames for each texture, in this case a frame for the image dude.png
            var renderer= new cc.render.WebGLRenderer(W,H,document.getElementById("c"));

            // director is the main Cocos Node, and must exist.
            var director= new cc.node.Director().
                    setRenderer( renderer );

            // scenes run in directors, and are the main displayable element.
            var scene= director.createScene().setColor(1,0,0);

            // register a sequence of keys for the konami code
            // had this event listener been registered for keyup, it would have been fired when the 'a' key was up instead.
            director.getInputManager().addEventListener(
                    "keydown",
                    function() {
                        alert("I hereby recognize you as one of us.")
                    },
                    "up up down down left right left right b a");

            // register a sequence of keys of 'a' and 'a' fired on keyup of the last 'a' pressed.
            director.getInputManager().addEventListener(
                    "keyup",
                    function() {
                        scene.setColor(.5+Math.random(),.5+Math.random(),.5+Math.random());
                    },
                    "a a");

            // register a cursor for wsad or cursor keys
            director.getInputManager().registerCursor(
                    {
                        up:     "w up c",
                        down:   "s down",
                        left:   "a left",
                        right:  "d right"
                    },
                    function( keyName, isDown ) {
                        if (keyName==="up")     { setClass(cursorUp, isDown ? "pressed" : "notpressed"); }
                        if (keyName==="down")   { setClass(cursorDown, isDown ? "pressed" : "notpressed"); }
                        if (keyName==="left")   { setClass(cursorLeft, isDown ? "pressed" : "notpressed"); }
                        if (keyName==="right")  { setClass(cursorRight, isDown ? "pressed" : "notpressed"); }
                    }
            );

            // create sprite frames for 21x7 array.
            AssetManager.addSpriteFrames( AssetManager.getSpriteFrame("dude").createSubSpriteFrames(21,7) );

            var sampleFrame= cc.plugin.asset.AssetManager.getSpriteFrame("dude0");

            var rows= (H/sampleFrame.getHeight())|0;
            var cols= (W/sampleFrame.getWidth())|0;
            var offsetX= (W - cols*sampleFrame.getWidth())/2;
            var offsetY= (H - rows*sampleFrame.getHeight())/2;

            for( var i=0; i<rows; i++ ) {
                for( var j=0; j<cols; j++ ) {

                    var sprite= new cc.node.Sprite( { frame: cc.plugin.asset.AssetManager.getSpriteFrame("dude"+(j+i*cols)) }).
                            setPosition( offsetX + j*sampleFrame.getWidth(), offsetY + i*sampleFrame.getHeight() );

                    var fn= function(e) {

                        e.target.stopAllActions();
                        e.target.startActionChain().
                                actionRotate().
                                    from(0).
                                    to(360).
                                    setDuration(1).
                                actionScale().
                                    from( {x:1, y:1}).
                                    to( {x:2, y:2}).
                                    setDuration(1000).
                                    setInterpolator( cc.action.Interpolator.EaseInOut(3,false,true) );
                    };

                    sprite.addEventListener( "mousemove", fn);
                    sprite.addEventListener( "touchend", fn );

                    scene.addChild( sprite );
                    sprite.enableEvents(true );
                }
            }

            // run the scene.
            director.runScene( scene );
        }

        window.addEventListener("DOMContentLoaded", loadResources, false);

    })();
</script>


</body>
</html>