<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Cocos2d-html5 Sprite Text</title>

    <link rel="stylesheet" href="../css/genericons.css">
    <link rel="stylesheet" href="../css/templatestyles.css">
    <link rel="stylesheet" href="../stylesheets/pygment_trac.css">
    <link rel="stylesheet" id="open-sans-css"
          href="//fonts.googleapis.com/css?family=Open+Sans%3A300italic%2C400italic%2C600italic%2C300%2C400%2C600&amp;subset=latin%2Clatin-ext&amp;ver=4.1.1"
          type="text/css" media="all">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>

<button class="toggle" id="menutoggle">
</button>
<div class="wrapper">
<header>

    <div class="site-title">
        <div class="site-title-info">
            <h1>Cocos2d-html5</h1>
        </div>
        <div id="menu" class="site-menu">
            <div id="menuclose" class="close-button"><span class="icon-close"></span></div>
            <p class="demos-menu-title">Demos list</p>
            <ul id="site-menu" >

            </ul>
        </div>
    </div>
</header>

    <section>
        <div><canvas id="c"></canvas></div>
    </section>
    <footer>
        <p>This project is maintained by <a href="https://github.com/hyperandroid">hyperandroid</a></p>
    </footer>
</div>
<script src="../../../javascripts/scale.fix.js"></script>
<script src="menu.js"></script>
<script src="../../../dist/all.js"></script>
<script>
    (function() {


        document.getElementById("menutoggle").addEventListener("click", function (e) {
            e.preventDefault();
            document.getElementById("menu").style["display"] = "block";
        }, false);
        document.getElementById("menuclose").addEventListener("click", function (e) {
            e.preventDefault();
            document.getElementById("menu").style["display"] = "none";
        }, false);


        var W=700;
        var H=600;
        var AssetManager= cc.plugin.asset.AssetManager;

        function loadResources() {
            AssetManager.load(
                    {
                        prefix : "../res/",
                        resources: [
                            "arial-14.png@arial",
                            "arial-14.fnt@arialfnt"
                        ]
                    },
                    function onEnd(resources) {
                        initialize(resources);
                    }
            );
        }

        /**
         *
         * @param resources {object}
         */
        function initialize( resources ) {

            AssetManager.addImage( resources['arial'], 'arial' );

            // the renderer will setup pre-loaded textures for the renderer type.
            // it will also create necessary SpriteFrames for each texture, in this case a frame for the image dude.png
            var renderer= new cc.render.WebGLRenderer(W,H,document.getElementById("c"));

            // director is the main Cocos Node, and must exist.
            var director= new cc.node.Director().
                    setRenderer( renderer );

            // scenes run in directors, and are the main displayable element.
            var scene= director.createScene().setColor(.5,.5,1);

            // create a font from the moonwarrior game.
            AssetManager.createSpriteFontFromGlypthDesigner( "arial14", "arial", resources['arialfnt'] );
            var font= AssetManager.getSpriteFont("arial14");

            var rowData= [];
            var COLData= [];

            for( var i=-50; i<H+50; i+=font._height ) {

                var row= { chars: [], x:0 };
                rowData.push( row );
                var x=-50;
                while( x<W+50 ) {
                    var char= String.fromCharCode( (65+28*Math.random())>>0 );
                    var w= font.getStringWidth(char);
                    row.chars.push( {
                        char: char,
                        x : x,
                        y : i,
                        w : w
                    });

                    x+= w;
                }

                row.x= x;
            }

            scene.update= function( delta ) {
                for( var i=0; i<rowData.length; i++ ) {
                    var row= rowData[i];
                    var rowInc= 300*Math.sin( (1+i)/rowData.length * Math.PI   )*delta;
                    for( var j=0; j<row.chars.length; j++ ) {
                        var char= row.chars[j];
                        char.x-= rowInc;
                        if ( char.x < -50 ) {
                            char.x= row.x + (char.x + 50);
                        }
                    }
                }
            };

            scene.scheduleUpdate();

            scene.draw= function( ctx ) {
                for( var i=0; i<rowData.length; i++ ) {
                    var row= rowData[i];
                    for( var j=0; j<row.chars.length; j++ ) {
                        var char= row.chars[j];
                        font.drawTextLine( ctx, char.char, char.x, char. y );
                    }
                }

            };

            // run the scene.
            director.runScene( scene );
        }

        window.addEventListener("DOMContentLoaded", loadResources, false);


    })();
</script>
</body>
</html>